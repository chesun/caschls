-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/build/sample
> /parentdemographics.smcl
  log type:  smcl
 opened on:  19 Dec 2024, 19:12:40

. 
. /* The following block of code rename child's grade to be consistent across d
> atasets. THis creates temp datasets to build
> demographics datasets from in the following block of code */
. local runparentname = 0 //a macro toggle for rename variables

. if `runparentname' == 1 {
.   use $clndtadir/parent/parent1415, clear
.   gen childgr = q6
.   label var childgr "grade of the child"
.   label define childgr 1 "kindergarten" 2 "grade 1" 3 "grade 2" 4 "grade 3" 5
>  "grade 4" 6 "grade 5" ///
>   7 "grade 6" 8 "grade 7" 9 "grade 8" 10 "grade 9" 11 "grade 10" 12 "grade 11
> " 13 "grade 12" 14 "other" 15 "ungraded"
.   label values childgr childgr //assign value label
.   save $projdir/dta/demographics/temp/parent/parent1415temp, replace
. 
.   use $clndtadir/parent/parent1516, clear
.   gen childgr = p7
.   label var childgr "grade of the child"
.   label define childgr 1 "kindergarten" 2 "grade 1" 3 "grade 2" 4 "grade 3" 5
>  "grade 4" 6 "grade 5" ///
>   7 "grade 6" 8 "grade 7" 9 "grade 8" 10 "grade 9" 11 "grade 10" 12 "grade 11
> " 13 "grade 12" 14 "other" 15 "ungraded"
.   label values childgr childgr //assign value label
.   save $projdir/dta/demographics/temp/parent/parent1516temp, replace
. 
.   use $clndtadir/parent/parent1617, clear
.   gen childgr = p7
.   label var childgr "grade of the child"
.   label define childgr 1 "kindergarten" 2 "grade 1" 3 "grade 2" 4 "grade 3" 5
>  "grade 4" 6 "grade 5" ///
>   7 "grade 6" 8 "grade 7" 9 "grade 8" 10 "grade 9" 11 "grade 10" 12 "grade 11
> " 13 "grade 12" 14 "other" 15 "ungraded"
.   label values childgr childgr //assign value label
.   save $projdir/dta/demographics/temp/parent/parent1617temp, replace
. 
.   use $clndtadir/parent/parent1718, clear
.   gen childgr = p7
.   label var childgr "grade of the child"
.   label define childgr 1 "kindergarten" 2 "grade 1" 3 "grade 2" 4 "grade 3" 5
>  "grade 4" 6 "grade 5" ///
>   7 "grade 6" 8 "grade 7" 9 "grade 8" 10 "grade 9" 11 "grade 10" 12 "grade 11
> " 13 "grade 12" 14 "other" 15 "ungraded"
.   label values childgr childgr //assign value label
.   save $projdir/dta/demographics/temp/parent/parent1718temp, replace
. 
.   use $clndtadir/parent/parent1819, clear
.   gen childgr = p7
.   label var childgr "grade of the child"
.   label define childgr 1 "kindergarten" 2 "grade 1" 3 "grade 2" 4 "grade 3" 5
>  "grade 4" 6 "grade 5" ///
>   7 "grade 6" 8 "grade 7" 9 "grade 8" 10 "grade 9" 11 "grade 10" 12 "grade 11
> " 13 "grade 12" 14 "other" 15 "ungraded"
.   label values childgr childgr //assign value label
.   save $projdir/dta/demographics/temp/parent/parent1819temp, replace
. }

. 
. /* The following block of code builds parent survey demographics dataset and 
> merges with enrollment dataset */
. 
. local years `" "1415" "1516" "1617" "1718" "1819" "' //local macro for datase
> t years

. 
.  foreach year of local years {
  2.    use $projdir/dta/demographics/temp/parent/parent`year'temp, clear
  3. 
.    //generate indicator variables for kids in each grade
.    gen byte grk = 0 //dummy for whether kid is in kindergarten
  4.    gen byte gr1 = 0
  5.    gen byte gr2 = 0
  6.    gen byte gr3 = 0
  7.    gen byte gr4 = 0
  8.    gen byte gr5 = 0
  9.    gen byte gr6 = 0
 10.    gen byte gr7 = 0
 11.    gen byte gr8 = 0
 12.    gen byte gr9 = 0
 13.    gen byte gr10 = 0
 14.    gen byte gr11 = 0
 15.    gen byte gr12 = 0
 16. 
.    replace grk = 1 if childgr == 1
 17.    replace gr1 = 1 if childgr == 2
 18.    replace gr2 = 1 if childgr == 3
 19.    replace gr3 = 1 if childgr == 4
 20.    replace gr4 = 1 if childgr == 5
 21.    replace gr5 = 1 if childgr == 6
 22.    replace gr6 = 1 if childgr == 7
 23.    replace gr7 = 1 if childgr == 8
 24.    replace gr8 = 1 if childgr == 9
 25.    replace gr9 = 1 if childgr ==10
 26.    replace gr10 = 1 if childgr == 11
 27.    replace gr11 = 1 if childgr == 12
 28.    replace gr12 = 1 if childgr == 13
 29. 
.    collapse (sum) grk gr1 gr2 gr3 gr4 gr5 gr6 gr7 gr8 gr9 gr10 gr11 gr12, by(
> cdscode)
 30. 
.    local grades `" "k" "1" "2" "3" "4" "5" "6" "7" "8" "9" "10" "11" "12" "' 
> //local macro for kids' grades in parent survey
 31.    foreach i of local grades {
 32.      rename gr`i' svygr`i'
 33.      label var svygr`i' "number of households with child in grade `i'"
 34.    }
 35.    label var svygrk "number of households with child in kindergarten" //re
> label for kindergarten
 36. 
.    drop if missing(cdscode) //drop observations with missing cdscode
 37. 
.    merge 1:1 cdscode using $projdir/dta/enrollment/schoollevel/enr`year' //me
> rge with frequency dataset (number of surveys for each school)
 38.    drop if _merge != 3 //drop all observations that are not matched
 39.    drop _merge
 40. 
.    compress //compress dataset to save memory
 41.    save $projdir/dta/demographics/parent/parentdemo`year', replace
 42. 
.    }
( )
(3,080 real changes made)
(3,183 real changes made)
(3,257 real changes made)
(3,346 real changes made)
(3,457 real changes made)
(6,658 real changes made)
(3,022 real changes made)
(0 real changes made)
(2,042 real changes made)
(2,410 real changes made)
(2,273 real changes made)
(2,168 real changes made)
(1,513 real changes made)
(0 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,808
        from master                       124  (_merge==1)
        from using                      9,684  (_merge==2)

    Matched                               735  (_merge==3)
    -----------------------------------------
(9,808 observations deleted)
  variable gr1noethnicenr was int now byte
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2noethnicenr was int now byte
  variable gr2asianenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3noethnicenr was int now byte
  variable gr3asianenr was int now byte
  variable gr4noethnicenr was int now byte
  variable gr4asianenr was int now byte
  variable gr5noethnicenr was int now byte
  variable gr5asianenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9noethnicenr was int now byte
  variable gr12noethnicenr was int now byte
  variable svygrk was double now int
  variable svygr1 was double now byte
  variable svygr2 was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svygr7 was double now byte
  variable svygr8 was double now int
  variable svygr9 was double now int
  variable svygr10 was double now int
  variable svygr11 was double now int
  variable svygr12 was double now byte
  (73,500 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/parent
    > /parentdemo1415.dta saved
(2015-16 Parent CSPS Data)
(4,171 real changes made)
(4,571 real changes made)
(4,884 real changes made)
(5,224 real changes made)
(5,802 real changes made)
(8,030 real changes made)
(5,033 real changes made)
(5,798 real changes made)
(4,635 real changes made)
(5,516 real changes made)
(4,465 real changes made)
(4,946 real changes made)
(3,461 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,684
        from master                       132  (_merge==1)
        from using                      9,552  (_merge==2)

    Matched                               909  (_merge==3)
    -----------------------------------------
(9,684 observations deleted)
  variable gr1femaleenr was int now byte
  variable gr1maleenr was int now byte
  variable gr2maleenr was int now byte
  variable gr3femaleenr was int now byte
  variable gr4maleenr was int now byte
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr1whiteenr was int now byte
  variable gr2blackenr was int now byte
  variable gr2whiteenr was int now byte
  variable gr3asianenr was int now byte
  variable gr3blackenr was int now byte
  variable gr4asianenr was int now byte
  variable gr5asianenr was int now byte
  variable gr5blackenr was int now byte
  variable gr6noethnicenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7noethnicenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr8noethnicenr was int now byte
  variable gr8filipinoenr was int now byte
  variable svygrk was double now int
  variable svygr1 was double now int
  variable svygr2 was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svygr7 was double now int
  variable svygr8 was double now int
  variable svygr9 was double now int
  variable svygr10 was double now int
  variable svygr11 was double now int
  variable svygr12 was double now int
  (90,900 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/parent
    > /parentdemo1516.dta saved
(2016-17 Parent CSPS Data)
(11,911 real changes made)
(10,017 real changes made)
(9,655 real changes made)
(10,720 real changes made)
(11,571 real changes made)
(9,602 real changes made)
(7,498 real changes made)
(7,780 real changes made)
(6,660 real changes made)
(7,261 real changes made)
(6,556 real changes made)
(7,455 real changes made)
(5,628 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,561
        from master                       176  (_merge==1)
        from using                      9,385  (_merge==2)

    Matched                             1,098  (_merge==3)
    -----------------------------------------
(9,561 observations deleted)
  variable gr1noethnicenr was int now byte
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2asianenr was int now byte
  variable gr2blackenr was int now byte
  variable gr2whiteenr was int now byte
  variable gr3asianenr was int now byte
  variable gr3blackenr was int now byte
  variable gr3whiteenr was int now byte
  variable gr4asianenr was int now byte
  variable gr4whiteenr was int now byte
  variable gr5asianenr was int now byte
  variable gr5blackenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr8filipinoenr was int now byte
  variable svygrk was double now int
  variable svygr1 was double now int
  variable svygr2 was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svygr7 was double now int
  variable svygr8 was double now int
  variable svygr9 was double now int
  variable svygr10 was double now int
  variable svygr11 was double now int
  variable svygr12 was double now int
  (104,310 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/parent
    > /parentdemo1617.dta saved
(2017-18 Parent CSPS Data)
(11,404 real changes made)
(11,590 real changes made)
(11,475 real changes made)
(12,120 real changes made)
(12,928 real changes made)
(13,989 real changes made)
(10,404 real changes made)
(10,916 real changes made)
(9,300 real changes made)
(10,302 real changes made)
(9,154 real changes made)
(9,928 real changes made)
(8,096 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,254
        from master                       278  (_merge==1)
        from using                      8,976  (_merge==2)

    Matched                             1,499  (_merge==3)
    -----------------------------------------
(9,254 observations deleted)
  variable gr2femaleenr was int now byte
  variable gr2maleenr was int now byte
  variable gr1noethnicenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2asianenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3asianenr was int now byte
  variable gr3blackenr was int now byte
  variable gr5asianenr was int now byte
  variable gr6noethnicenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8noethnicenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr10noethnicenr was int now byte
  variable gr11noethnicenr was int now byte
  variable svygrk was double now int
  variable svygr1 was double now int
  variable svygr2 was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svygr7 was double now int
  variable svygr8 was double now int
  variable svygr9 was double now int
  variable svygr10 was double now int
  variable svygr11 was double now int
  variable svygr12 was double now int
  (145,403 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/parent
    > /parentdemo1718.dta saved
(2018-19 Parent CSPS Data)
(12,442 real changes made)
(12,056 real changes made)
(12,512 real changes made)
(13,536 real changes made)
(13,554 real changes made)
(16,602 real changes made)
(11,770 real changes made)
(12,568 real changes made)
(9,940 real changes made)
(10,899 real changes made)
(9,417 real changes made)
(10,262 real changes made)
(8,332 real changes made)
(0 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,325
        from master                       240  (_merge==1)
        from using                      9,085  (_merge==2)

    Matched                             1,436  (_merge==3)
    -----------------------------------------
(9,325 observations deleted)
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3asianenr was int now byte
  variable gr4asianenr was int now byte
  variable gr5asianenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable svygrk was double now int
  variable svygr1 was double now int
  variable svygr2 was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svygr7 was double now int
  variable svygr8 was double now int
  variable svygr9 was double now int
  variable svygr10 was double now int
  variable svygr11 was double now int
  variable svygr12 was double now int
  (129,240 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/parent
    > /parentdemo1819.dta saved

. 
.    log close
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/build/sample
> /parentdemographics.smcl
  log type:  smcl
 closed on:  19 Dec 2024, 19:12:42
-------------------------------------------------------------------------------
