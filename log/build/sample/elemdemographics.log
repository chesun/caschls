-------------------------------------------------------------------------------
      name:  elemdemographics
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/build/sample
> /elemdemographics.smcl
  log type:  smcl
 opened on:   7 Apr 2022, 14:53:24

. 
. /* The following block of code rename sex and self reported grade variables t
> o be consistent across datasets. THis creates temp datasets to build
> demographics datasets from in the following block of code */
. local runelemrename = 0 //a macro toggle for renamign variables

. if `runelemrename' == 1 {
.   use $clndtadir/elementary/elem1415, clear
.   rename ele3 sex
.   label var sex "Sex of student"
.   rename ele4 selfreportgrade
.   label var selfreportgrade "Self-reported grade"
.   save $projdir/dta/demographics/temp/elementary/elem1415temp, replace
. 
.   use $clndtadir/elementary/elem1516, clear
.   rename ele3 sex
.   label var sex "Sex of student"
.   rename ele4 selfreportgrade
.   label var selfreportgrade "Self-reported grade"
.   save $projdir/dta/demographics/temp/elementary/elem1516temp, replace
. 
.   use $clndtadir/elementary/elem1617, clear
.   rename ele2 sex
.   label var sex "Sex of student"
.   rename ele3 selfreportgrade
.   label var selfreportgrade "Self-reported grade"
.   save $projdir/dta/demographics/temp/elementary/elem1617temp, replace
. 
.   use $clndtadir/elementary/elem1718, clear
.   rename ele2 sex
.   label var sex "Sex of student"
.   rename ele3 selfreportgrade
.   label var selfreportgrade "Self-reported grade"
.   save $projdir/dta/demographics/temp/elementary/elem1718temp, replace
. 
.   use $clndtadir/elementary/elem1819, clear
.   rename ele2 sex
.   label var sex "Sex of student"
.   rename ele3 selfreportgrade
.   label var selfreportgrade "Self-reported grade"
.   save $projdir/dta/demographics/temp/elementary/elem1819temp, replace
. 
. }

. 
. 
. /* The following block of code builds elementary survey demographics dataset 
> and merges with enrollment dataset */
. 
. local years `" "1415" "1516" "1617" "1718" "1819" "' //local macro for datase
> t years

. 
.  foreach i of local years {
  2.    use $projdir/dta/demographics/temp/elementary/elem`i'temp, clear
  3. 
.    /* gaenerate variables indicating the sex of each student */
.    // Note: in elementary datasets the var sex = 1 if female and 2 if male
. 
.    gen byte female = 0
  4.    replace female = 1 if sex == 1
  5. 
.    gen byte male = 0
  6.    replace male = 1 if sex == 2
  7. 
.    /* generate variables indicating each grade */
.    gen byte gr3 = 0
  8.    gen byte gr4 = 0
  9.    gen byte gr5 = 0
 10.    gen byte gr6 = 0
 11. 
.    replace gr3 = 1 if grade == 3 //note: the grade variable here is adjusted 
> by CBEDS enrollment
 12.    replace gr4 = 1 if grade == 4
 13.    replace gr5 = 1 if grade == 5
 14.    replace gr6 = 1 if grade == 6
 15. 
.    /* generate vars for number of female and male students in each grade */
.    gen byte femalegr3 = 0
 16.    replace femalegr3 = 1 if female == 1 & gr3 == 1
 17.    gen byte femalegr4 = 0
 18.    replace femalegr4 = 1 if female == 1 & gr4 == 1
 19.    gen byte femalegr5 = 0
 20.    replace femalegr5 = 1 if female == 1 & gr5 == 1
 21.    gen byte femalegr6 = 0
 22.    replace femalegr6 = 1 if female == 1 & gr6 == 1
 23. 
.    gen byte malegr3 = 0
 24.    replace malegr3 = 1 if male == 1 & gr3 == 1
 25.    gen byte malegr4 = 0
 26.    replace malegr4 = 1 if male == 1 & gr4 == 1
 27.    gen byte malegr5 = 0
 28.    replace malegr5 = 1 if male == 1 & gr5 == 1
 29.    gen byte malegr6 = 0
 30.    replace malegr6 = 1 if male == 1 & gr6 == 1
 31. 
. 
.    collapse (sum) female male gr3 gr4 gr5 gr6 femalegr3 femalegr4 femalegr5 f
> emalegr6 malegr3 malegr4 malegr5 malegr6, by(cdscode)
 32. 
.    rename female svyfemale
 33.    label var svyfemale "number of female students in the survey"
 34.    rename male svymale
 35.    label var svymale "number of male students in the survey"
 36. 
.    rename gr3 svygr3
 37.    rename gr4 svygr4
 38.    rename gr5 svygr5
 39.    rename gr6 svygr6
 40. 
.    label var svygr3 "number of students in grade 3 in survey"
 41.    label var svygr4 "number of students in grade 4 in survey"
 42.    label var svygr5 "number of students in grade 5 in survey"
 43.    label var svygr6 "number of students in grade 6 in survey"
 44. 
.    rename femalegr3 svyfemalegr3
 45.    rename femalegr4 svyfemalegr4
 46.    rename femalegr5 svyfemalegr5
 47.    rename femalegr6 svyfemalegr6
 48. 
.    label var svyfemalegr3 "number of female students in grade 3 in survey"
 49.    label var svyfemalegr4 "number of female students in grade 4 in survey"
 50.    label var svyfemalegr5 "number of female students in grade 5 in survey"
 51.    label var svyfemalegr6 "number of female students in grade 6 in survey"
 52. 
.    rename malegr3 svymalegr3
 53.    rename malegr4 svymalegr4
 54.    rename malegr5 svymalegr5
 55.    rename malegr6 svymalegr6
 56. 
.    label var svymalegr3 "number of male students in grade 3 in survey"
 57.    label var svymalegr4 "number of male students in grade 4 in survey"
 58.    label var svymalegr5 "number of male students in grade 5 in survey"
 59.    label var svymalegr6 "number of male students in grade 6 in survey"
 60. 
. 
.    drop if missing(cdscode) //drop observations with missing cdscode
 61. 
.    merge 1:1 cdscode using $projdir/dta/enrollment/schoollevel/enr`i' //merge
>  with frequency dataset (number of surveys for each school)
 62.    drop if _merge != 3 //drop all observations that are not matched
 63.    drop _merge
 64. 
.    compress //compress dataset to save memory
 65.    save $projdir/dta/demographics/elementary/elemdemo`i', replace
 66. 
.  }
(34,711 real changes made)
(32,860 real changes made)
(378 real changes made)
(2,505 real changes made)
(65,660 real changes made)
(1,960 real changes made)
(149 real changes made)
(1,198 real changes made)
(32,190 real changes made)
(951 real changes made)
(159 real changes made)
(1,141 real changes made)
(30,186 real changes made)
(995 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,514
        from master                       128  (_merge==1)
        from using                      9,386  (_merge==2)

    Matched                             1,033  (_merge==3)
    -----------------------------------------
(9,514 observations deleted)
  variable gr9femaleenr was int now byte
  variable gr9maleenr was int now byte
  variable gr10femaleenr was int now byte
  variable gr10maleenr was int now byte
  variable gr11femaleenr was int now byte
  variable gr11maleenr was int now byte
  variable gr12femaleenr was int now byte
  variable gr12maleenr was int now byte
  variable gr1noethnicenr was int now byte
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2noethnicenr was int now byte
  variable gr2asianenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3noethnicenr was int now byte
  variable gr4noethnicenr was int now byte
  variable gr5noethnicenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7asianenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9noethnicenr was int now byte
  variable gr9asianenr was int now byte
  variable gr9filipinoenr was int now byte
  variable gr9hispanicenr was int now byte
  variable gr9blackenr was int now byte
  variable gr9whiteenr was int now byte
  variable gr10asianenr was int now byte
  variable gr10filipinoenr was int now byte
  variable gr10hispanicenr was int now byte
  variable gr10blackenr was int now byte
  variable gr10whiteenr was int now byte
  variable gr11asianenr was int now byte
  variable gr11filipinoenr was int now byte
  variable gr11hispanicenr was int now byte
  variable gr11blackenr was int now byte
  variable gr11whiteenr was int now byte
  variable gr12noethnicenr was int now byte
  variable gr12asianenr was int now byte
  variable gr12filipinoenr was int now byte
  variable gr12hispanicenr was int now byte
  variable gr12blackenr was int now byte
  variable gr12whiteenr was int now byte
  variable svyfemale was double now int
  variable svymale was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svyfemalegr3 was double now byte
  variable svyfemalegr4 was double now byte
  variable svyfemalegr5 was double now int
  variable svyfemalegr6 was double now int
  variable svymalegr3 was double now byte
  variable svymalegr4 was double now byte
  variable svymalegr5 was double now byte
  variable svymalegr6 was double now byte
  (140,488 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/elemen
    > tary/elemdemo1415.dta saved
(53,585 real changes made)
(51,054 real changes made)
(339 real changes made)
(2,615 real changes made)
(99,763 real changes made)
(5,129 real changes made)
(131 real changes made)
(1,152 real changes made)
(49,227 real changes made)
(2,640 real changes made)
(124 real changes made)
(1,140 real changes made)
(46,836 real changes made)
(2,445 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,068
        from master                       215  (_merge==1)
        from using                      8,853  (_merge==2)

    Matched                             1,608  (_merge==3)
    -----------------------------------------
(9,068 observations deleted)
  variable gr1femaleenr was int now byte
  variable gr9femaleenr was int now byte
  variable gr10femaleenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2blackenr was int now byte
  variable gr2whiteenr was int now byte
  variable gr3blackenr was int now byte
  variable gr5blackenr was int now byte
  variable gr6noethnicenr was int now byte
  variable gr6asianenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7noethnicenr was int now byte
  variable gr7asianenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8noethnicenr was int now byte
  variable gr8asianenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9noethnicenr was int now byte
  variable gr9asianenr was int now byte
  variable gr9filipinoenr was int now byte
  variable gr9blackenr was int now byte
  variable gr9whiteenr was int now byte
  variable gr10asianenr was int now byte
  variable gr10filipinoenr was int now byte
  variable gr10blackenr was int now byte
  variable gr10whiteenr was int now byte
  variable gr11asianenr was int now byte
  variable gr11filipinoenr was int now byte
  variable gr11blackenr was int now byte
  variable gr11whiteenr was int now byte
  variable gr12asianenr was int now byte
  variable gr12filipinoenr was int now byte
  variable gr12blackenr was int now byte
  variable svyfemale was double now int
  variable svymale was double now int
  variable svygr3 was double now byte
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svyfemalegr3 was double now byte
  variable svyfemalegr4 was double now byte
  variable svyfemalegr5 was double now int
  variable svyfemalegr6 was double now int
  variable svymalegr3 was double now byte
  variable svymalegr4 was double now byte
  variable svymalegr5 was double now int
  variable svymalegr6 was double now int
  (201,000 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/elemen
    > tary/elemdemo1516.dta saved
(2016-17 Elementary CHKS Data)
(47,272 real changes made)
(43,971 real changes made)
(1,238 real changes made)
(2,868 real changes made)
(87,088 real changes made)
(3,459 real changes made)
(609 real changes made)
(1,272 real changes made)
(43,415 real changes made)
(1,793 real changes made)
(561 real changes made)
(1,274 real changes made)
(40,259 real changes made)
(1,646 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,191
        from master                       154  (_merge==1)
        from using                      9,037  (_merge==2)

    Matched                             1,446  (_merge==3)
    -----------------------------------------
(9,191 observations deleted)
  variable gr9femaleenr was int now byte
  variable gr10femaleenr was int now byte
  variable gr11femaleenr was int now byte
  variable gr12femaleenr was int now byte
  variable gr12maleenr was int now byte
  variable gr1noethnicenr was int now byte
  variable gr1asianenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2asianenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3blackenr was int now byte
  variable gr5blackenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7asianenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8asianenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9asianenr was int now byte
  variable gr9filipinoenr was int now byte
  variable gr9blackenr was int now byte
  variable gr9whiteenr was int now byte
  variable gr10noethnicenr was int now byte
  variable gr10asianenr was int now byte
  variable gr10filipinoenr was int now byte
  variable gr10blackenr was int now byte
  variable gr10whiteenr was int now byte
  variable gr11asianenr was int now byte
  variable gr11filipinoenr was int now byte
  variable gr11blackenr was int now byte
  variable gr11whiteenr was int now byte
  variable gr12asianenr was int now byte
  variable gr12filipinoenr was int now byte
  variable gr12hispanicenr was int now byte
  variable gr12blackenr was int now byte
  variable gr12whiteenr was int now byte
  variable svyfemale was double now int
  variable svymale was double now int
  variable svygr3 was double now byte
  variable svygr4 was double now byte
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svyfemalegr3 was double now byte
  variable svyfemalegr4 was double now byte
  variable svyfemalegr5 was double now byte
  variable svyfemalegr6 was double now byte
  variable svymalegr3 was double now byte
  variable svymalegr4 was double now byte
  variable svymalegr5 was double now int
  variable svymalegr6 was double now byte
  (189,426 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/elemen
    > tary/elemdemo1617.dta saved
(2017-18 Elementary CHKS Data)
(64,503 real changes made)
(61,054 real changes made)
(2,342 real changes made)
(4,364 real changes made)
(120,198 real changes made)
(6,608 real changes made)
(1,193 real changes made)
(1,974 real changes made)
(57,579 real changes made)
(3,320 real changes made)
(1,044 real changes made)
(1,990 real changes made)
(54,340 real changes made)
(3,233 real changes made)
(1 observation deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         8,665
        from master                       292  (_merge==1)
        from using                      8,373  (_merge==2)

    Matched                             2,102  (_merge==3)
    -----------------------------------------
(8,665 observations deleted)
  variable gr10maleenr was int now byte
  variable gr1noethnicenr was int now byte
  variable gr1blackenr was int now byte
  variable gr2blackenr was int now byte
  variable gr3blackenr was int now byte
  variable gr6noethnicenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7noethnicenr was int now byte
  variable gr7asianenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8noethnicenr was int now byte
  variable gr8asianenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9noethnicenr was int now byte
  variable gr9asianenr was int now byte
  variable gr9filipinoenr was int now byte
  variable gr9blackenr was int now byte
  variable gr9whiteenr was int now byte
  variable gr10noethnicenr was int now byte
  variable gr10asianenr was int now byte
  variable gr10filipinoenr was int now byte
  variable gr10blackenr was int now byte
  variable gr10whiteenr was int now byte
  variable gr11noethnicenr was int now byte
  variable gr11asianenr was int now byte
  variable gr11filipinoenr was int now byte
  variable gr11blackenr was int now byte
  variable gr11whiteenr was int now byte
  variable gr12noethnicenr was int now byte
  variable gr12asianenr was int now byte
  variable gr12filipinoenr was int now byte
  variable gr12blackenr was int now byte
  variable svyfemale was double now int
  variable svymale was double now int
  variable svygr3 was double now byte
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svyfemalegr3 was double now byte
  variable svyfemalegr4 was double now byte
  variable svyfemalegr5 was double now byte
  variable svyfemalegr6 was double now int
  variable svymalegr3 was double now byte
  variable svymalegr4 was double now byte
  variable svymalegr5 was double now byte
  variable svymalegr6 was double now int
  (264,852 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/elemen
    > tary/elemdemo1718.dta saved
(2018-19 Elementary CHKS Data)
(47,667 real changes made)
(45,223 real changes made)
(1,308 real changes made)
(2,803 real changes made)
(93,564 real changes made)
(3,815 real changes made)
(657 real changes made)
(1,214 real changes made)
(43,813 real changes made)
(1,970 real changes made)
(631 real changes made)
(1,195 real changes made)
(41,577 real changes made)
(1,814 real changes made)
(0 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                         9,033
        from master                       155  (_merge==1)
        from using                      8,878  (_merge==2)

    Matched                             1,643  (_merge==3)
    -----------------------------------------
(9,033 observations deleted)
  variable gr1blackenr was int now byte
  variable gr2blackenr was int now byte
  variable gr6filipinoenr was int now byte
  variable gr6blackenr was int now byte
  variable gr7filipinoenr was int now byte
  variable gr7blackenr was int now byte
  variable gr8filipinoenr was int now byte
  variable gr8blackenr was int now byte
  variable gr9noethnicenr was int now byte
  variable gr9asianenr was int now byte
  variable gr9filipinoenr was int now byte
  variable gr9blackenr was int now byte
  variable gr10noethnicenr was int now byte
  variable gr10asianenr was int now byte
  variable gr10filipinoenr was int now byte
  variable gr10blackenr was int now byte
  variable gr11noethnicenr was int now byte
  variable gr11asianenr was int now byte
  variable gr11filipinoenr was int now byte
  variable gr11blackenr was int now byte
  variable gr12noethnicenr was int now byte
  variable gr12asianenr was int now byte
  variable gr12filipinoenr was int now byte
  variable gr12hispanicenr was int now byte
  variable gr12blackenr was int now byte
  variable gr12whiteenr was int now byte
  variable svyfemale was double now int
  variable svymale was double now int
  variable svygr3 was double now int
  variable svygr4 was double now int
  variable svygr5 was double now int
  variable svygr6 was double now int
  variable svyfemalegr3 was double now byte
  variable svyfemalegr4 was double now byte
  variable svyfemalegr5 was double now byte
  variable svyfemalegr6 was double now int
  variable svymalegr3 was double now byte
  variable svymalegr4 was double now byte
  variable svymalegr5 was double now byte
  variable svymalegr6 was double now int
  (190,588 bytes saved)
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/demographics/elemen
    > tary/elemdemo1819.dta saved

. 
.  log close elemdemographics
      name:  elemdemographics
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/build/sample
> /elemdemographics.smcl
  log type:  smcl
 closed on:   7 Apr 2022, 14:53:26
-------------------------------------------------------------------------------
