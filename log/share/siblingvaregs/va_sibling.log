-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/share/siblin
> gvaregs/va_sibling.smcl
  log type:  smcl
 opened on:   9 Apr 2022, 03:42:51

. 
. //run the do helper file to set the local macros
. include `vaprojdofiles'/sbac/macros_va.doh

. #delimit ;
delimiter now ;
. *** file paths
> local home $vaprojdir ;
. local ca_ed_lab "/home/research/ca_ed_lab" ;

. local k12_test_scores "$vaprojdir/data/restricted_access/clean/k12_test_score
> s" ;

. local public_access "$vaprojdir/data/public_access" ;

. local k12_public_schools "$vaprojdir/data/public_access/clean/k12_public_scho
> ols" ;

. local k12_test_scores_public "$vaprojdir/data/public_access/clean/k12_test_sc
> ores" ;

. **** Dates ;
. local test_score_min_year
>         2015
>         ;

. local test_score_max_year
>         2018
>         ;

. local star_min_year
>         2003
>         ;

. local star_max_year
>         2013
>         ;

. local caaspp_min_year
>         2015
>         ;

. local caaspp_max_year
>         2019
>         ;

. local outcome_min_year
>         2015
>         ;

. local outcome_max_year
>         2018
>         ;

. **** Outcome Strings ;
. local ela_str
>         "ELA"
>         ;

. local math_str
>         "Math"
>         ;

. local enr_str
>         "Enrolled On Time"
>         ;

. local enr_2year_str
>         "Enrolled On Time 2-Year"
>         ;

. local enr_4year_str
>         "Enrolled On Time 4-Year"
>         ;

. **** Value Added ;
. local school_controls
>         /*cohort_size*/
>         ;

. local demographic_controls
>         age
>         i.male
>         i.eth_asian i.eth_hispanic i.eth_black i.eth_other
>         i.econ_disadvantage
>         i.limited_eng_prof
>         i.disabled
>         ;

. local peer_demographic_controls
>         peer_age
>         peer_male
>         peer_eth_asian peer_eth_hispanic peer_eth_black peer_eth_other
>         peer_econ_disadvantage
>         peer_limited_eng_prof
>         peer_disabled
>         ;

. local ela_score_controls
>         i.year#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_z_score
> )
>         ;

. local peer_ela_score_controls
>         i.year#(c.peer_prior_ela_z_score##c.peer_prior_ela_z_score##c.peer_pr
> ior_ela_z_score)
>         ;

. local math_score_controls
>         i.year#(c.prior_math_z_score##c.prior_math_z_score##c.prior_math_z_sc
> ore)
>         ;

. local peer_math_score_controls
>         i.year#(c.peer_prior_math_z_score##c.peer_prior_math_z_score##c.peer_
> prior_math_z_score)
>         ;

. local va_control_vars "`school_controls' `demographic_controls'" ;

. local va_control_vars : subinstr local va_control_vars "i." "", all ;

. local va_control_vars : list uniq va_control_vars ;

. local census_grade
>         6
>         ;

. local census_controls
>         /*eth_white_pct*/ eth_asian_pct eth_hispanic_pct eth_black_pct /*eth_
> other_pct*/
>         educ_hs_dropout_prop /*educ_deg_2year_prop*/ educ_deg_4year_plus_prop
>         pov_fam_child_lt18_pct
>         inc_median_hh
>         ;

. **** School Characteristics ;
. local sch_chars
>         fte_teach_pc fte_pupil_pc /*fte_admin_pc*/
>         /*eng_learner_staff_pc*/
>         new_teacher_prop
>         /*educ_grad_sch_prop educ_associate_prop*/
>         /*status_tenured_prop*/
>         credential_full_prop
>         /*authorization_stem_prop authorization_ela_prop*/
>         c.male_prop##c.enr_male_prop
>         c.eth_minority_prop##c.enr_minority_prop
>         enr_total
>         ;

. local sch_char_vars "`sch_chars'" ;

. local sch_char_vars : subinstr local sch_char_vars "i." "", all ;

. local sch_char_vars : subinstr local sch_char_vars "c." "", all ;

. local sch_char_vars : subinstr local sch_char_vars "##" " ", all ;

. local sch_char_vars : subinstr local sch_char_vars "#" " ", all ;

. local sch_char_vars : list uniq sch_char_vars ;

. local dem_chars
>         enr_male_prop
>         enr_minority_prop
>         frpm_prop el_prop
>         enr_total
>         ;

. local dem_char_vars "`dem_chars'" ;

. local dem_char_vars : list uniq dem_char_vars ;

. local expenditures
>         expenditures_instr_pc
>         expenditures3000_pc
>         expenditures4000_pc
>         expenditures_other_pc
>         expenditures7000_pc
>         ;

. local expenditure_vars "`expenditures'" ;

. local expenditure_vars : list uniq expenditure_vars ;

. local sch_char_control_vars : list sch_char_vars | dem_char_vars ;

. local sch_char_control_vars : list sch_char_control_vars | expenditure_vars ;

. #delimit cr
delimiter now cr
. 
. 
. #delimit ;
delimiter now ;
. #delimit cr
delimiter now cr
. macro list
vaprojxwalks:   /home/research/ca_ed_lab/projects/common_core_va/data/restricte
                > d_access/clean/crosswalks
mattxwalks:     /home/research/ca_ed_lab/users/msnaven/data/restricted_access/c
                > lean/crosswalks
nscdtadir_oldformat:
                /home/research/ca_ed_lab/data/restricted_access/clean/cde_nsc/o
                > ldformat
nscdtadir:      /home/research/ca_ed_lab/data/restricted_access/clean/cde_nsc
cstdtadir:      /home/research/ca_ed_lab/data/restricted_access/clean//cde/cst
vadtadir:       /home/research/ca_ed_lab/projects/common_core_va/data/sbac
vaprojdir:      /home/research/ca_ed_lab/projects/common_core_va
projdir:        /home/research/ca_ed_lab/users/chesun/gsr/caschls
clndtadir:      /home/research/ca_ed_lab/data/restricted_access/clean/calschls
rawdtadir:      /home/research/ca_ed_lab/data/restricted_access/raw/calschls/st
                > ata
rawcsvdir:      /home/research/ca_ed_lab/data/restricted_access/raw/calschls/cs
                > v
T_gm_fix_span:  0
S_6:            .7097029923018954
S_5:            4
S_4:            .379339567907114
ReS_jv2:        __000006 __000007 __000008 __000009 __00000A __00000B __00000C
                __00000D __00000E __00000F __00000G __00000H __00000I __00000J
                __00000K
dropv:          _cdscode_x
n_offset:       0
sort:           0
dots:           nois _dots 5 0
dotss:          nois _dots 0, title(Survey results being calculated)
S_3:            .0104764158075594
ReS_Call:       version 16.1:
S_level:        95
F1:             help advice;
F2:             describe;
F7:             save
F8:             use
S_ADO:          BASE;SITE;.;PERSONAL;PLUS;OLDPLACE
S_StataMP:      MP
S_StataSE:      SE
S_CONSOLE:      console
S_OS:           Unix
S_MACH:         PC (64-bit x86-64)
_sch_char_control_vars:
                fte_teach_pc fte_pupil_pc new_teacher_prop credential_full_prop
                male_prop enr_male_prop eth_minority_prop enr_minority_prop
                enr_total frpm_prop el_prop expenditures_instr_pc
                expenditures3000_pc expenditures4000_pc expenditures_other_pc
                expenditures7000_pc
_expenditure_vars:
                expenditures_instr_pc expenditures3000_pc expenditures4000_pc
                expenditures_other_pc expenditures7000_pc
_expenditures:  expenditures_instr_pc expenditures3000_pc expenditures4000_pc
                expenditures_other_pc expenditures7000_pc
_dem_char_vars: enr_male_prop enr_minority_prop frpm_prop el_prop enr_total
_dem_chars:     enr_male_prop enr_minority_prop frpm_prop el_prop enr_total
_sch_char_vars: fte_teach_pc fte_pupil_pc new_teacher_prop credential_full_prop
                male_prop enr_male_prop eth_minority_prop enr_minority_prop
                enr_total
_sch_chars:     fte_teach_pc fte_pupil_pc new_teacher_prop credential_full_prop
                c.male_prop##c.enr_male_prop
                c.eth_minority_prop##c.enr_minority_prop enr_total
_census_controls:
                eth_asian_pct eth_hispanic_pct eth_black_pct
                educ_hs_dropout_prop educ_deg_4year_plus_prop
                pov_fam_child_lt18_pct inc_median_hh
_census_grade:  6
_va_control_vars:
                age male eth_asian eth_hispanic eth_black eth_other
                econ_disadvantage limited_eng_prof disabled
_peer_math_score_controls:
                i.year#(c.peer_prior_math_z_score##c.peer_prior_math_z_score##c
                > .peer_prior_math_z_score)
_math_score_controls:
                i.year#(c.prior_math_z_score##c.prior_math_z_score##c.prior_mat
                > h_z_score)
_peer_ela_score_controls:
                i.year#(c.peer_prior_ela_z_score##c.peer_prior_ela_z_score##c.p
                > eer_prior_ela_z_score)
_ela_score_controls:
                i.year#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_z
                > _score)
_peer_demographic_controls:
                peer_age peer_male peer_eth_asian peer_eth_hispanic
                peer_eth_black peer_eth_other peer_econ_disadvantage
                peer_limited_eng_prof peer_disabled
_demographic_controls:
                age i.male i.eth_asian i.eth_hispanic i.eth_black i.eth_other
                i.econ_disadvantage i.limited_eng_prof i.disabled
_enr_4year_str: Enrolled On Time 4-Year
_enr_2year_str: Enrolled On Time 2-Year
_enr_str:       Enrolled On Time
_math_str:      Math
_ela_str:       ELA
_outcome_max_year:
                2018
_outcome_min_year:
                2015
_caaspp_max_year:
                2019
_caaspp_min_year:
                2015
_star_max_year: 2013
_star_min_year: 2003
_test_score_max_year:
                2018
_test_score_min_year:
                2015
_k12_test_scores_public:
                /home/research/ca_ed_lab/projects/common_core_va/data/public_ac
                > cess/clean/k12_test_scores
_k12_public_schools:
                /home/research/ca_ed_lab/projects/common_core_va/data/public_ac
                > cess/clean/k12_public_schools
_public_access: /home/research/ca_ed_lab/projects/common_core_va/data/public_ac
                > cess
_k12_test_scores:
                /home/research/ca_ed_lab/projects/common_core_va/data/restricte
                > d_access/clean/k12_test_scores
_ca_ed_lab:     /home/research/ca_ed_lab
_sibling_out_xwalk:
                /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/siblingxw
                > alk/sibling_out_xwalk
_k12_postsecondary_out_merge:
                /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_co
                > re_va/k12_postsecondary_out_merge
_ufamilyxwalk:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/siblingxw
                > alk/ufamilyxwalk
_siblingxwalk:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/siblingxw
                > alk/siblingpairxwalk
_va_g11_out_dataset:
                /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_co
                > re_va/va_g11_out_dataset
_va_g11_dataset:
                /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_co
                > re_va/va_g11_dataset
_va_dataset:    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_co
                > re_va/va_dataset
_vaprojdofiles: /home/research/ca_ed_lab/projects/common_core_va/do_files
_setlimit:      0
_1:             0
_0:             0

. 
. 
. timer on 1

. 
. *****************************************************************************
> ***
. 
. 
. //load the VA grade 11 sample
. use `va_g11_dataset', clear
(CST/SBAC Student Test Score Samples)

. 
. //merge on to sibling outcomes crosswalk to get sibling enrollment controls
. merge m:1 state_student_id using `sibling_out_xwalk', nogen keep(1 3)
       =void resultlist(string scalar macname)
       =        string rowvector    src
       =        string colvector    res
       =        real scalar    i
       =string scalar result(string scalar result)
       =        real scalar    l
       =void resulttext(string scalar macroname, real scalar i)
       =        string scalar    toret
       =void map_mtype(string scalar macname)
       =        string scalar    input, toret
       =void fullfilename(string scalar forstatamac, string scalar fullnamemac,
>  string scalar macname)
       =        string scalar    fullname, path, filename
       =        real scalar    l
       -------------------------------------------------------- begin merge ---
03     - version 11
03     - gettoken mtype 0 : 0, parse(" ,")
03     - if (!strpos("`mtype'", ":") & "`mtype'"!="") {
       = if (!strpos("m:1", ":") & "m:1"!="") {
03       if (_caller()>=11) {
03       di as smcl as txt "{p}"
03       di as smcl "(you are using old"
03       di as smcl "{bf:merge} syntax; see"
03       di as smcl "{bf:{help merge:[D] merge}} for new syntax)"
03       di as smcl "{p_end}"
03       }
03       merge_10 `mtype' `0'
03       exit
03       }
03     - local origmtype `"`mtype'"'
       = local origmtype `"m:1"'
03     - mata: map_mtype(`"mtype"')
03     - gettoken token : 0, parse(" ,")
03     - if ("`token'"=="_n") {
       = if ("state_student_id"=="_n") {
03       if ("`mtype'"!="1:1") {
03       error_seq_not11 "`mtype'" "`origmtype'"
03       }
03       gettoken token 0 : 0, parse(" ,")
03       local mtype "_n"
03       }
03     - syntax [varlist(default=none)] using/ [, ASSERT(string) DEBUG GENerate
> (name) FORCE KEEP(string) KEEPUSing(string) noLabels NOGENerate noNOTEs REPLA
> CE noREPort SORTED UPDATE ]
03     - if ("`mtype'"!="_n") {
       = if ("m:1"!="_n") {
03     - local origmtype `"`mtype'"'
       = local origmtype `"m:1"'
03     - mata: map_mtype(`"mtype"')
03     - if ("`varlist'"=="") {
       = if ("state_student_id"=="") {
03       error_mat_varlist "`mtype'" "`origmtype'"
03       }
03     - }
03     - else {
03       if ("`mtype'"=="_n") {
03       if ("`varlist'"!="") {
03       error_seq_varlist
03       }
03       }
03       }
03     - mata: fullfilename("using", "usingfull", "using")
03     - mata: resultlist("assert")
03     - mata: resultlist("keep")
03     - if ("`generate'"!="") {
       = if (""!="") {
03       if ("`nogenerate'"!="") {
03       di as smcl err "{p}"
03       di as smcl "options -generate()- and -nogenerate-"
03       di as smcl "may not be specified together."
03       di as smcl err "{p_end}"
03       }
03       confirm new var `generate'
03       }
03     - if ("`replace'"!="") {
       = if (""!="") {
03       if ("`update'"=="") {
03       error_replace
03       }
03       }
03     - if ("`sorted'"=="" & "`mtype'"!="_n") {
       = if (""=="" & "m:1"!="_n") {
03     - local sortedby : sortedby
03     - checksort "`sortedby'" "`varlist'"
       = checksort "" "state_student_id"
03     - if (!r(sorted)) {
03     - sort `varlist'
       = sort state_student_id
03     - }
03     - quietly describe using "`using'", varlist short
       = quietly describe using "/home/research/ca_ed_lab/users/chesun/gsr/casc
> hls/dta/siblingxwalk/sibling_out_xwalk.dta", varlist short
03     - local sortedby "`r(sortlist)'"
       = local sortedby "ufamilyid birth_order"
03     - checksort "`sortedby'" "`varlist'"
       = checksort "ufamilyid birth_order" "state_student_id"
03     - if (!r(sorted)) {
03     - preserve
03     - qui use "`using'", clear
       = qui use "/home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/sibling
> xwalk/sibling_out_xwalk.dta", clear
03     - sort `varlist'
       = sort state_student_id
03     - tempfile using
03     - qui save "`using'", replace
       = qui save "/home/tmp/St192370.000002", replace
03     - restore
03     - }
03     - }
03     - if ("`nogenerate'"!="") {
       = if ("nogenerate"!="") {
03     - tempvar mergevar
03     - local mergevaristemp 1
03     - }
03     - else {
03       local mergevar = cond("`generate'"!="", "`generate'", "_merge")
03       local mergevaristemp 0
03       }
03     - local options `update' `replace' `notes' `labels' _merge(`mergevar') `
> force'
       = local options     _merge(__000000) 
03     - if (bsubstr("`mtype'", 1, 1)=="1") {
       = if (bsubstr("m:1", 1, 1)=="1") {
03       local options `options' uniqmaster
03       }
03     - if (bsubstr("`mtype'", 3, 1)=="1") {
       = if (bsubstr("m:1", 3, 1)=="1") {
03     - local options `options' uniqusing
       = local options _merge(__000000) uniqusing
03     - }
03     - if ("`keepusing'"!="") {
       = if (""!="") {
03       local options `options' keep(`keepusing')
03       }
03     - if ("`keep'" !="" & !strpos("`keep'" , "2")) {
       = if ("1 3" !="" & !strpos("1 3" , "2")) {
03     - local options `options' nokeep
       = local options _merge(__000000) uniqusing nokeep
03     - }
03     - if (_caller() > 15) {
03     - local version : di "version " string(_caller()) ": "
03     - }
03     - local _merge `"`version'_merge `varlist' using "`using'", nowarn"'
       = local _merge `"version 17: _merge state_student_id using "/home/tmp/St
> 192370.000002", nowarn"'
03     - local _merge `"`_merge' `options' tabulate(mresults)"'
       = local _merge `"version 17: _merge state_student_id using "/home/tmp/St
> 192370.000002", nowarn _merge(__000000) uniqusing nokeep tabulate(mresults)"'
03     - if ("`debug'"!="") {
       = if (""!="") {
03       di as txt _n "command is"
03       di `"`_merge'"' _n
03       }
03     - `_merge'
       = version 17: _merge state_student_id using "/home/tmp/St192370.000002",
>  nowarn _merge(__000000) uniqusing nokeep tabulate(mresults)
03     - if (!`mergevaristemp') {
       = if (!1) {
03       capture label list _merge
03       if (_rc) {
03       label define _merge 1 "Master only (1)" 2 "Using only (2)" 3 "Matched 
> (3)" 4 "Missing updated (4)" 5 "Nonmissing conflict (5)"
03       }
03       label values `mergevar' _merge
03       label variable `mergevar' "Matching result from merge"
03       }
03     - if ("`assert'"!="") {
       = if (""!="") {
03       if (_caller() < 13) {
03       buildexpr expr : `mergevar' "`assert'"
03       capture assert `expr'
03       if (_rc) {
03       error_assert `mergevar' "`assert'"
03       }
03       }
03       else {
03       capture checkmresults "`mresults'" "`assert'"
03       if (_rc) {
03       error_assert `mergevar' "`assert'"
03       }
03       }
03       }
03     - if ("`keep'"!="") {
       = if ("1 3"!="") {
03     - buildexpr expr : `mergevar' "`keep'"
       = buildexpr expr : __000000 "1 3"
03     - quietly keep if `expr'
       = quietly keep if (__000000==1 | __000000==3)
03     - }
03     - if ("`mtype'"=="1:1") {
       = if ("m:1"=="1:1") {
03       qui count if `mergevar'==2
03       if (r(N)==0) {
03       sort `varlist'
03       }
03       }
03     - if (c(noisily) & "`report'"=="") {
       = if (c(noisily) & ""=="") {
03     - local isupdate = ("`replace'"!="" | "`update'"!="")
       = local isupdate = (""!="" | ""!="")
03     - present_table `isupdate' `mergevar' `mergevaristemp'
       = present_table 0 __000000 1

    Result                      Number of obs
    -----------------------------------------
    Not matched                       884,570
        from master                   884,570  
        from using                          0  

    Matched                           900,294  
    -----------------------------------------
03     - }
       ---------------------------------------------------------- end merge ---

. 
. drop if mi(has_older_sibling_enr_2year)
(884,570 observations deleted)

. drop if mi(has_older_sibling_enr_4year)
(0 observations deleted)

. 
. compress
  variable age was float now int
  (1,800,588 bytes saved)

. tempfile va_g11_sibling_dataset

. save `va_g11_sibling_dataset'
file /home/tmp/St192370.000001 saved as .dta format

. 
. 
. 
. 
. *****************************************************************************
> ***
. *********** VA estimates for VA samples matched to siblings sample
. *****************************************************************************
> ***
. 
. 
. if `setlimit' == 0 {
.   local drift_limit = max(`test_score_max_year' - `test_score_min_year' - 1, 
> 1)
. }

. else {
.   local drift_limit = `setlimit'
. }

. 
. foreach subject in ela math {
  2. 
. 
.     /* load the VA g11 subject sample with siblings outcome sample
>      (those who have at least one older sibling matched to the postsecondary
>    outcomes) */
.     use `va_g11_sibling_dataset' if touse_g11_`subject'==1 & sibling_out_samp
> le == 1, clear
  3. 
.     *************************************************************************
> *****
.     ************ Value added estimation with no peer controls ***************
> *****
.     ****** No TFX, without sibling college going controls
.     vam sbac_`subject'_z_score ///
>       , teacher(school_id) year(year) class(school_id) ///
>       controls( ///
>         i.year ///
>         `school_controls' ///
>         `demographic_controls' ///
>         `ela_score_controls' ///
>         `math_score_controls' ///
>       ) ///
>       data(merge tv score_r) ///
>       driftlimit(`drift_limit') ///
>       estimates($vaprojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`su
> bject'_nosibctrl.ster, replace)
  4. 
.     //rename the first time to make sure indep var names for spec test are al
> l the same
.     rename tv va_cfr_g11_`subject'
  5.         rename score_r sbac_g11_`subject'_r
  6. 
. 
.     ************ specification test: regressing score residuals on VA estimat
> es
.     ******* No peer controls
.     ******** sibling sample without sibling controls
.     reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
  7.     //save to my personal folder
.     estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr_
> g11_`subject'_sibling_nocontrol.ster, replace
  8.     //save to VA project folder
.     estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_va
> _cfr_g11_`subject'_sibling_nocontrol.ster, replace
  9. 
.     //rename again to distinguish between nocontrol and with control va estim
> ates
.     rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
 10.     rename sbac_g11_`subject'_r sbac_g11_`subject'_r_nosibctrl
 11.     label var va_cfr_g11_`subject'_nosibctrl "`subject' VA with family FE 
> without TFX without sibling control"
 12.     label var sbac_g11_`subject'_r_nosibctrl "`subject' score residual wit
> h family FE without TFX without sibling control"
 13. 
.     ****** No TFX (teacher fixed effects), include sibling controls
.     vam sbac_`subject'_z_score ///
>                 , teacher(school_id) year(year) class(school_id) ///
>                 controls( ///
>                         i.year ///
>         i.has_older_sibling_enr_2year ///
>         i.has_older_sibling_enr_4year ///
>                         `school_controls' ///
>                         `demographic_controls' ///
>                         `ela_score_controls' ///
>                         `math_score_controls' ///
>                 ) ///
>                 data(merge tv score_r) ///
>                 driftlimit(`drift_limit') ///
>       estimates($vaprojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`su
> bject'.ster, replace)
 14. 
. 
.     rename tv va_cfr_g11_`subject'
 15.         rename score_r sbac_g11_`subject'_r
 16. 
.     ************ specification test: regressing score residuals on VA estimat
> es
.     ******* No peer controls
.     ******** sibling sample with sibling controls
.     reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
 17.     //save to my personal folder
.     estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr_
> g11_`subject'_sibling.ster, replace
 18.     //save to VA project folder
.     estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_va
> _cfr_g11_`subject'_sibling.ster, replace
 19. 
. 
. 
.     label var va_cfr_g11_`subject' "`subject' VA with family FE without TFX"
 20.     label var sbac_g11_`subject'_r "`subject' score residual with family F
> E without TFX"
 21. 
. /*
>     ****** With TFX, and TFX is added back in the the VA estimates
>     vam sbac_`subject'_z_score ///
>       , teacher(school_id) year(year) class(school_id) ///
>       controls( ///
>         i.year ///
>         i.has_older_sibling_enr_2year ///
>         i.has_older_sibling_enr_4year ///
>         `school_controls' ///
>         `demographic_controls' ///
>         `ela_score_controls' ///
>         `math_score_controls' ///
>       ) ///
>       tfx_resid(school_id) ///
>       data(merge tv score_r) ///
>       driftlimit(`drift_limit')
>     rename tv va_tfx_g11_`subject'
>     drop score_r
>     label var va_tfx_g11_`subject' "`subject' VA with family FE with TFX"
> 
> 
>  */
. 
. 
. 
. 
. 
. 
. 
.     *************************************************************************
> *****
.     ************ Value added estimation with peer controls ******************
> **
.     ****** No TFX (teacher fixed effects)
.     /* vam sbac_`subject'_z_score ///
>       , teacher(school_id) year(year) class(school_id) ///
>       controls( ///
>         i.year ///
>         i.has_older_sibling_enr_2year ///
>         i.has_older_sibling_enr_4year ///
>         `school_controls' ///
>         `demographic_controls' ///
>         `ela_score_controls' ///
>         `math_score_controls' ///
>         `peer_demographic_controls' ///
>         `peer_ela_score_controls' ///
>         `peer_math_score_controls' ///
>       ) ///
>       data(merge tv score_r) ///
>       driftlimit(`drift_limit')
>     rename tv va_cfr_g11_`subject'_peer
>     rename score_r sbac_g11_`subject'_r_peer
>     label var va_cfr_g11_`subject'_peer "`subject' VA with family FE with TFX
> "
>     label var sbac_g11_`subject'_r_peer "`subject' score residual with family
>  FE with TFX"
> 
> 
>     ****** With TFX
>     vam sbac_`subject'_z_score ///
>       , teacher(school_id) year(year) class(school_id) ///
>       controls( ///
>         i.year ///
>         i.has_older_sibling_enr_2year ///
>         i.has_older_sibling_enr_4year ///
>         `school_controls' ///
>         `demographic_controls' ///
>         `ela_score_controls' ///
>         `math_score_controls' ///
>         `peer_demographic_controls' ///
>         `peer_ela_score_controls' ///
>         `peer_math_score_controls' ///
>       ) ///
>       tfx_resid(school_id) ///
>       data(merge tv score_r) ///
>       driftlimit(`drift_limit')
>     rename tv va_tfx_g11_`subject'_peer
>     drop score_r */
. 
. 
.     *************************************************************************
> *****
.     ************ specification test: regressing score residuals on VA estimat
> es
. 
.     /* ******* With peer controls
>     reg sbac_g11_`subject'_r_peer va_cfr_g11_`subject'_peer, cluster(school_i
> d)
>     estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr_
> g11_`subject'_peer_sibling.ster, replace */
. 
. 
. 
. 
.     *************************************************************************
> *****
.     /* CFR Forecast Bias Test */
.     ***** leave out variable is sibling controls
.     **no peer controls
.     gen sbac_g11_`subject'_r_d = sbac_g11_`subject'_r_nosibctrl - sbac_g11_`s
> ubject'_r
 22.     //var rename gymnastics to make sure the indep var names are all the s
> ame when making tables later
.     rename va_cfr_g11_`subject' va_cfr_g11_`subject'_temp
 23.     rename va_cfr_g11_`subject'_nosibctrl va_cfr_g11_`subject'
 24. 
.     reg sbac_g11_`subject'_r_d va_cfr_g11_`subject',    cluster(school_id)
 25.     //save to my personal folder
.     estimates save $projdir/est/siblingvaregs/test_score_va/fb_test_va_cfr_g1
> 1_`subject'_sibling.ster, replace
 26.     //save to VA project folder
.     estimates save $vaprojdir/estimates/sibling_va/test_score_va/fb_test_va_c
> fr_g11_`subject'_sibling.ster, replace
 27. 
.     //roll back the rename gymnastics to restore original var names
.     rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
 28.     rename va_cfr_g11_`subject'_temp va_cfr_g11_`subject'
 29. 
. 
.     **************** Save Value Added Estimates
.     collapse (firstnm) va_* ///
>                 (mean) sbac_*_r* ///
>                 (sum) n_g11_`subject' = touse_g11_`subject' ///
>       if sibling_full_sample == 1 & sibling_out_sample == 1 ///
>                 , by(school_id cdscode grade year)
 30.     //save to my personal folder
.         save $projdir/dta/common_core_va/test_score_va/va_g11_`subject'_sibli
> ng.dta, replace
 31.     //save to VA project folder
.     save $vaprojdir/data/sibling_va/test_score_va/va_g11_`subject'_sibling.dt
> a, replace
 32. 
. 
. }
02   - foreach subject in ela math {
02   - use `va_g11_sibling_dataset' if touse_g11_`subject'==1 & sibling_out_sam
> ple == 1, clear
     = use /home/tmp/St192370.000001 if touse_g11_ela==1 & sibling_out_sample =
> = 1, clear
(CST/SBAC Student Test Score Samples)
02   - vam sbac_`subject'_z_score , teacher(school_id) year(year) class(school_
> id) controls( i.year `school_controls' `demographic_controls' `ela_score_cont
> rols' `math_score_controls' ) data(merge tv score_r) driftlimit(`drift_limit'
> ) estimates($vaprojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`subjec
> t'_nosibctrl.ster, replace)
     = vam sbac_ela_z_score , teacher(school_id) year(year) class(school_id) co
> ntrols( i.year  age         i.male         i.eth_asian i.eth_hispanic i.eth_b
> lack i.eth_other         i.econ_disadvantage         i.limited_eng_prof      
>    i.disabled i.year#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_z
> _score) i.year#(c.prior_math_z_score##c.prior_math_z_score##c.prior_math_z_sc
> ore) ) data(merge tv score_r) driftlimit(2) estimates(/home/research/ca_ed_la
> b/projects/common_core_va/estimates/sibling_va/test_score_va/vam_cfr_g11_ela_
> nosibctrl.ster, replace)
       ---------------------------------------------------------- begin vam ---
03     - version 10.1
03     - set more off
03     - syntax varname(ts fv) [aweight/], teacher(varname) year(varname) class
> (varname) [ by(varlist) controls(varlist ts fv) absorb(varname) tfx_resid(var
> name) data(string) output(string) output_addvars(varlist) driftlimit(integer 
> -1) QUASIexperiment CONStant noseed varclasszero estimates(string asis)]
03     - local depvar `varlist'
       = local depvar sbac_ela_z_score
03     - capture confirm variable score_r, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named score_r."
03       exit 110
03       }
03     - capture confirm variable tv, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv."
03       exit 110
03       }
03     - if ("`quasiexperiment'"!="") {
       = if (""!="") {
03       capture confirm variable tv_2yr_l, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_l."
03       exit 110
03       }
03       capture confirm variable tv_2yr_f, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_f."
03       exit 110
03       }
03       capture confirm variable tv_ss, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_ss."
03       exit 110
03       }
03       }
03     - local merge_tv=0
03     - local merge_resid=0
03     - if ("`data'"=="") local data="preserve"
       = if ("merge tv score_r"=="") local data="preserve"
03     - else {
03     - if !inlist("`data'","preserve","tv","merge tv","merge score_r","merge 
> tv score_r","merge score_r tv","variance") {
       = if !inlist("merge tv score_r","preserve","tv","merge tv","merge score_
> r","merge tv score_r","merge score_r tv","variance") {
03       di as error "Not a valid argument for data. Choose either 'preserve', 
> 'tv', 'merge [tv AND/OR score_r]', or 'variance'."
03       exit 198
03       }
03     - else {
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if ("`1'")=="merge" {
       = if ("merge")=="merge" {
03     - if ("`2'"=="tv") | ("`3'"=="tv") local merge_tv=1
       = if ("tv"=="tv") | ("score_r"=="tv") local merge_tv=1
03     - if ("`2'"=="score_r") | ("`3'"=="score_r") local merge_resid=1
       = if ("tv"=="score_r") | ("score_r"=="score_r") local merge_resid=1
03     - }
03     - }
03     - }
03     - if "`tfx_resid'"!="" & "`absorb'"!="" {
       = if ""!="" & ""!="" {
03       di as error "Cannot specify an absorb variable and a tfx_resid variabl
> e simultaneously."
03       exit 198
03       }
03     - if `"`output'"'=="" {
       = if `""'=="" {
03     - tempfile output
03     - local nooutput=1
03     - }
03     - else local nooutput=0
03     - if ("`by'"!="") {
       = if (""!="") {
03       tempvar byvar
03       egen `byvar'=group(`by'), label
03       sum `byvar', meanonly
03       local by_vals=`r(max)'
03       }
03     - else local by_vals=1
03     - if "`weight'"!="" {
       = if ""!="" {
03       local ind_weight "`weight'"
03       macro drop _weight
03       local ind_exp "`exp'"
03       macro drop _exp
03       local times_exp "* `exp'"
03       }
03     - preserve
03     - local firstloop=1
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - if (`firstloop'!=1) restore, preserve
       = if (1!=1) restore, preserve
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabel : label `byvar' `l', strict
03       di "{bf:-> by variables:} `by' = `bylabel'"
03       }
03     - qui drop if missing(`teacher',`year',`class')
       = qui drop if missing(school_id,year,school_id)
03     - if ("`by'"!="") qui keep if `byvar'==`l'
       = if (""!="") qui keep if ==1
03     - if "`absorb'"!="" | "`tfx_resid'"!="" {
       = if ""!="" | ""!="" {
03       if "`ind_weight'"=="" {
03       noisily areg `depvar' `controls' , absorb(`absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       else if "`ind_weight'"!="" {
03       noisily areg `depvar' `controls' [`ind_weight' = `ind_exp'] , absorb(`
> absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       }
03     - else {
03     - if "`ind_weight'"=="" {
       = if ""=="" {
03     - version 11 : noisily reg `depvar' `controls'
       = version 11 : noisily reg sbac_ela_z_score i.year age i.male i.eth_asia
> n i.eth_hispanic i.eth_black i.eth_other i.econ_disadvantage i.limited_eng_pr
> of i.disabled i.year#c.prior_ela_z_score i.year#c.prior_ela_z_score#c.prior_e
> la_z_score i.year#c.prior_ela_z_score#c.prior_ela_z_score#c.prior_ela_z_score
>  i.year#c.prior_math_z_score i.year#c.prior_math_z_score#c.prior_math_z_score
>  i.year#c.prior_math_z_score#c.prior_math_z_score#c.prior_math_z_score

      Source |       SS           df       MS      Number of obs   =   677,254
-------------+----------------------------------   F(36, 677217)   =  28471.16
       Model |  329901.804        36  9163.93899   Prob > F        =    0.0000
    Residual |  217974.086   677,217  .321867416   R-squared       =    0.6021
-------------+----------------------------------   Adj R-squared   =    0.6021
       Total |  547875.889   677,253  .808967829   Root MSE        =    .56733

------------------------------------------------------------------------------
sbac_ela_z~e | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |
       2016  |   .0499644   .0027484    18.18   0.000     .0445776    .0553512
       2017  |   .0676601   .0027356    24.73   0.000     .0622985    .0730217
       2018  |  -.0710576   .0027417   -25.92   0.000    -.0764313    -.065684
             |
         age |  -.0003426   4.88e-06   -70.14   0.000    -.0003522    -.000333
             |
        male |
       Male  |  -.0902902   .0014094   -64.06   0.000    -.0930527   -.0875278
 1.eth_asian |   .1036863    .002264    45.80   0.000     .0992489    .1081236
1.eth_hisp~c |  -.0050762   .0019297    -2.63   0.009    -.0088584    -.001294
 1.eth_black |  -.1444525   .0037981   -38.03   0.000    -.1518967   -.1370083
 1.eth_other |   .0043308   .0042032     1.03   0.303    -.0039074    .0125689
             |
econ_disad~e |
Economic ..  |  -.0366117   .0016359   -22.38   0.000     -.039818   -.0334053
             |
limited_en~f |
Limited E..  |  -.2115924   .0036819   -57.47   0.000    -.2188087    -.204376
             |
    disabled |
   Disabled  |  -.1861937   .0037187   -50.07   0.000    -.1934822   -.1789052
             |
        year#|
          c. |
prior_ela_~e |
       2015  |   .6117768   .0027977   218.67   0.000     .6062934    .6172602
       2016  |    .593261   .0027254   217.68   0.000     .5879193    .5986027
       2017  |   .5819387   .0028658   203.07   0.000     .5763219    .5875555
       2018  |   .5727827   .0034906   164.09   0.000     .5659413    .5796241
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |   .0002419   .0014746     0.16   0.870    -.0026483    .0031321
       2016  |  -.0138144   .0014878    -9.29   0.000    -.0167304   -.0108984
       2017  |  -.0132171   .0014998    -8.81   0.000    -.0161566   -.0102775
       2018  |   .0110561   .0015063     7.34   0.000     .0081038    .0140084
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |  -.0275553   .0006825   -40.37   0.000    -.0288931   -.0262176
       2016  |  -.0226716   .0006239   -36.34   0.000    -.0238944   -.0214489
       2017  |  -.0236694   .0006071   -38.99   0.000    -.0248592   -.0224796
       2018  |  -.0294713   .0009879   -29.83   0.000    -.0314076    -.027535
             |
        year#|
          c. |
prior_math~e |
       2015  |   .1695626    .002779    61.01   0.000     .1641157    .1750094
       2016  |   .1896512   .0028265    67.10   0.000     .1841112    .1951911
       2017  |   .1889889   .0029484    64.10   0.000     .1832101    .1947678
       2018  |   .2478465   .0035318    70.18   0.000     .2409242    .2547687
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0045974   .0018502    -2.48   0.013    -.0082238   -.0009711
       2016  |  -.0127122   .0018014    -7.06   0.000    -.0162428   -.0091815
       2017  |  -.0071678   .0018429    -3.89   0.000    -.0107798   -.0035559
       2018  |   .0042888   .0014656     2.93   0.003     .0014163    .0071613
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0031236   .0007616    -4.10   0.000    -.0046164   -.0016309
       2016  |  -.0035752   .0008052    -4.44   0.000    -.0051535    -.001997
       2017  |  -.0066743   .0007956    -8.39   0.000    -.0082336   -.0051149
       2018  |   -.005854   .0009793    -5.98   0.000    -.0077734   -.0039346
             |
       _cons |   2.270121   .0299192    75.88   0.000      2.21148    2.328761
------------------------------------------------------------------------------
03     - if `"`estimates'"'!="" {
       = if `"/home/research/ca_ed_lab/projects/common_core_va/estimates/siblin
> g_va/test_score_va/vam_cfr_g11_ela_nosibctrl.ster, replace"'!="" {
03     - estimates save `estimates'
       = estimates save /home/research/ca_ed_lab/projects/common_core_va/estima
> tes/sibling_va/test_score_va/vam_cfr_g11_ela_nosibctrl.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/vam_cfr_g11_ela_nosibctrl.ster saved
03     - }
03     - }
03     - else if "`ind_weight'"!="" {
       = else if ""!="" {
03       version 11 : noisily reg `depvar' `controls' [`ind_weight' = `ind_exp'
> ]
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03     - }
03     - if "`tfx_resid'"=="" {
       = if ""=="" {
03     - qui predict score_r if e(sample),r
03     - if "`constant'"!="" {
       = if ""!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03     - }
03     - else {
03       qui predict score_r if e(sample), dresiduals
03       if "`constant'"!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03       }
03     - if "`ind_weight'"!="" {
       = if ""!="" {
03       tempvar tot_ind_weight class_ind_weight
03       qui egen `tot_ind_weight' = total(`ind_exp') if !mi(score_r)
03       qui egen `class_ind_weight' = total(`ind_exp') if !mi(score_r), by(`te
> acher' `year' `group' `class')
03       }
03     - if `merge_resid'==1 {
       = if 1==1 {
03     - tempfile resid_data_`l'
       = tempfile resid_data_1
03     - qui save `"`resid_data_`l''"', replace
       = qui save `"/home/tmp/St192370.000004"', replace
03     - }
03     - tempname num_obs num_par
03     - scalar `num_obs' = e(N)
       = scalar __000000 = e(N)
03     - if "`absorb'"!="" {
       = if ""!="" {
03       scalar `num_par' = e(df_m) + e(df_a) + 1
03       }
03     - else {
03     - scalar `num_par' = e(df_m) + 1
       = scalar __000001 = e(df_m) + 1
03     - }
03     - tempvar n_tested
03     - qui bys `teacher' `year' `group' `class': egen `n_tested' = count(scor
> e_r)
       = qui bys school_id year  school_id: egen __000002 = count(score_r)
03     - tempvar class_mean index
03     - qui by `teacher' `year' `group' `class': egen `class_mean' = mean(scor
> e_r)
       = qui by school_id year  school_id: egen __000003 = mean(score_r)
03     - qui by `teacher' `year' `group' `class': g `index' = _n
       = qui by school_id year  school_id: g __000004 = _n
03     - tempname var_total
03     - qui sum score_r
03     - scalar `var_total' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_par'))
       = scalar __000005 = r(Var)*((__000000 - 1)/(__000000 - __000001))
03     - tempname num_class var_ind var_class
03     - tempvar individual_dev_from_class
03     - qui gen `individual_dev_from_class' = score_r - `class_mean'
       = qui gen __000009 = score_r - __000003
03     - qui count if `index'==1 & `n_tested'!=0
       = qui count if __000004==1 & __000002!=0
03     - scalar `num_class' = r(N)
       = scalar __000006 = r(N)
03     - qui sum `individual_dev_from_class'
       = qui sum __000009
03     - scalar `var_ind' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_class' - 
> `num_par' + 1))
       = scalar __000007 = r(Var)*((__000000 - 1)/(__000000 - __000006 - __0000
> 01 + 1))
03     - qui by `teacher' `year' `group' `class': keep if _n==1
       = qui by school_id year  school_id: keep if _n==1
03     - if "`seed'"=="" {
       = if ""=="" {
03     - set seed 9827496
03     - }
03     - tempvar rand classnum
03     - g `rand'=uniform()
       = g __00000A=uniform()
03     - bys `teacher' `year' (`rand'): gen `classnum'=_n
       = bys school_id year (__00000A): gen __00000B=_n
03     - tempname cov_sameyear corr_sameyear obs_sameyear
03     - qui sum `classnum'
       = qui sum __00000B
03     - if (r(max)==1) {
03     - local missing_sameyear=1
03     - scalar `cov_sameyear'=0
       = scalar __00000C=0
03     - }
03     - else {
03       local missing_sameyear=0
03       tempvar identifier
03       egen `identifier'=group(`teacher' `year')
03       qui tsset `identifier' `classnum'
03       qui corr `class_mean' f.`class_mean' [aw=`n_tested'+f.`n_tested'], cov
03       scalar `cov_sameyear'=r(cov_12)
03       scalar `corr_sameyear'=r(cov_12) / ( sqrt(r(Var_1)) * sqrt(r(Var_2)) )
03       scalar `obs_sameyear'=r(N)
03       }
03     - scalar `var_class' = `var_total' - `var_ind' - `cov_sameyear'
       = scalar __000008 = __000005 - __000007 - __00000C
03     - if (`var_class'<0) {
       = if (__000008<0) {
03       if ("`varclasszero'"!="varclasszero") {
03       di as error "Note: var_class has been computed as being less than 0."
03       di "var_class is defined as = var_total - var_ind - cov_sameyear."
03       di "Computed variances: var_total, var_ind, cov_sameyear, var_class"
03       di `var_total',`var_ind',`cov_sameyear',`var_class'
03       di "This negative variance can occur because cov_sameyear is calculate
> d using only the subsample of observations that teach multiple classes per ye
> ar (in the same by-group)."
03       }
03       else if ("`varclasszero'"=="varclasszero") {
03       scalar `var_class' = 0
03       }
03       }
03     - tempvar weight
03     - qui g `weight'=1/(`var_class' + `var_ind'/`n_tested')
       = qui g __00000F=1/(__000008 + __000007/__000002)
03     - tempvar excess_weight
03     - qui gen `excess_weight'=(missing(`weight'))
       = qui gen __00000G=(missing(__00000F))
03     - qui replace `weight'=1 if missing(`weight')
       = qui replace __00000F=1 if missing(__00000F)
03     - collapse (mean) `class_mean' (rawsum) `weight' `n_tested' `excess_weig
> ht' [aw=`weight'], by(`teacher' `year' `by') fast
       = collapse (mean) __000003 (rawsum) __00000F __000002 __00000G [aw=__000
> 00F], by(school_id year ) fast
03     - qui replace `weight'=`weight'-`excess_weight'
       = qui replace __00000F=__00000F-__00000G
03     - qui tsset `teacher' `year'
       = qui tsset school_id year
03     - tempvar minyear maxyear diff validyear minvalidyear maxvalidyear diffv
> alid
03     - qui bys `teacher': egen `minyear'=min(`year')
       = qui bys school_id: egen __00000H=min(year)
03     - qui by `teacher': egen `maxyear'=max(`year')
       = qui by school_id: egen __00000I=max(year)
03     - qui g `diff'=`maxyear'-`minyear'
       = qui g __00000J=__00000I-__00000H
03     - qui sum `diff'
       = qui sum __00000J
03     - local maxspan=`r(max)'
       = local maxspan=3
03     - qui gen `validyear'=`year' if !missing(`class_mean')
       = qui gen __00000K=year if !missing(__000003)
03     - qui by `teacher': egen `minvalidyear'=min(`validyear')
       = qui by school_id: egen __00000L=min(__00000K)
03     - qui by `teacher': egen `maxvalidyear'=max(`validyear')
       = qui by school_id: egen __00000M=max(__00000K)
03     - qui g `diffvalid'=`maxvalidyear'-`minvalidyear'
       = qui g __00000N=__00000M-__00000L
03     - qui sum `diffvalid'
       = qui sum __00000N
03     - local maxscorespan=`r(max)'
       = local maxscorespan=3
03     - if (`maxscorespan'<`maxspan') & (`driftlimit'<=0) {
       = if (3<3) & (2<=0) {
03       di as error _n "error: The maximum lags of teacher data is `maxspan', 
> but the maximum lags of teacher data with class scores is `maxscorespan'."
03       di as error "       You must either set driftlimit() <= `maxscorespan'
> , or drop observations so that the spans are no longer mismatched."
03       exit 499
03       }
03     - if (`driftlimit'>`maxscorespan') {
       = if (2>3) {
03       di as error "error: driftlimit(`driftlimit') was specified, which is g
> reater than the number of lags (`maxscorespan') in the data."
03       exit 499
03       }
03     - mata:CC=compute_cov_corr("`class_mean'","`n_tested'",`maxscorespan',"`
> teacher'")
       = mata:CC=compute_cov_corr("__000003","__000002",3,"school_id")
03     - if (`driftlimit'>0) mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyea
> r'"),`maxspan',`driftlimit')
       = if (2>0) mata:m=create_m(CC[.,1],st_numscalar("__00000C"),3,2)
03     - else mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyear'"))
       = else mata:m=create_m(CC[.,1],st_numscalar("__00000C"))
03     - di "Standard deviations: total, classes, students, teachers same year"
Standard deviations: total, classes, students, teachers same year
03     - if (`missing_sameyear'==0) di sqrt(`var_total'),sqrt(`var_class'),sqrt
> (`var_ind'),sqrt(`cov_sameyear')
       = if (1==0) di sqrt(__000005),sqrt(__000008),sqrt(__000007),sqrt(__00000
> C)
03     - else di sqrt(`var_total'),sqrt(`var_class'),sqrt(`var_ind'),.
       = else di sqrt(__000005),sqrt(__000008),sqrt(__000007),.
.5673336 .18211037 .53731111 .
03     - di "Covariances (left), correlations (middle), observations (right).  
> Row i indicates the relation between year t and t+i:"
Covariances (left), correlations (middle), observations (right).  Row i indicat
> es the relation between year t and t+i:
03     - mata:CC[.,1..3]
                 1             2             3
    +-------------------------------------------+
  1 |  .0199303169   .5743741184          3541  |
  2 |  .0151232796   .4358772714          2299  |
  3 |  .0085328264   .2388976851          1105  |
    +-------------------------------------------+
03     - if (`driftlimit'>0) {
       = if (2>0) {
03     - di "Drift limit specified:"
Drift limit specified:
03     - di `driftlimit'
       = di 2
2
03     - di "Covariances used for VA computations:"
Covariances used for VA computations:
03     - mata: m[2..length(m)]'
                 1
    +---------------+
  1 |  .0199303169  |
  2 |  .0151232796  |
  3 |  .0151232796  |
    +---------------+
03     - }
03     - mata:check_m_nomissing(m)
03     - if (`firstloop'==1) {
       = if (1==1) {
03     - mata:cov_lag_accum= CC[.,1]
03     - mata:corr_lag_accum= CC[.,2]
03     - mata:obs_lag_accum= CC[.,3]
03     - mata:cov_se_lag_accum= CC[.,4]
03     - mata:var_total_accum= st_numscalar("`var_total'")
       = mata:var_total_accum= st_numscalar("__000005")
03     - mata:var_class_accum= st_numscalar("`var_class'")
       = mata:var_class_accum= st_numscalar("__000008")
03     - mata:var_ind_accum= st_numscalar("`var_ind'")
       = mata:var_ind_accum= st_numscalar("__000007")
03     - if (`missing_sameyear'==1) {
       = if (1==1) {
03     - mata:cov_sameyear_accum=.
03     - mata:corr_sameyear_accum=.
03     - mata:obs_sameyear_accum=0
03     - }
03     - else {
03       mata:cov_sameyear_accum=st_numscalar("`cov_sameyear'")
03       mata:corr_sameyear_accum=st_numscalar("`corr_sameyear'")
03       mata:obs_sameyear_accum=st_numscalar("`obs_sameyear'")
03       }
03     - }
03     - else {
03       mata:cov_lag_accum= rightAppendMatrices(cov_lag_accum,CC[.,1])
03       mata:corr_lag_accum= rightAppendMatrices(corr_lag_accum,CC[.,2])
03       mata:obs_lag_accum= rightAppendMatrices(obs_lag_accum,CC[.,3])
03       mata:cov_se_lag_accum= rightAppendMatrices(cov_se_lag_accum,CC[.,4])
03       mata:var_total_accum= var_total_accum,st_numscalar("`var_total'")
03       mata:var_class_accum= var_class_accum,st_numscalar("`var_class'")
03       mata:var_ind_accum= var_ind_accum,st_numscalar("`var_ind'")
03       if (`missing_sameyear'==1) {
03       mata:cov_sameyear_accum= cov_sameyear_accum,.
03       mata:corr_sameyear_accum= corr_sameyear_accum,.
03       mata:obs_sameyear_accum= obs_sameyear_accum,.
03       }
03       else {
03       mata:cov_sameyear_accum=cov_sameyear_accum,st_numscalar("`cov_sameyear
> '")
03       mata:corr_sameyear_accum=corr_sameyear_accum,st_numscalar("`corr_samey
> ear'")
03       mata:obs_sameyear_accum=obs_sameyear_accum,st_numscalar("`obs_sameyear
> '")
03       }
03       }
03     - sort `teacher' `year'
       = sort school_id year
03     - tempvar obs_teacher
03     - by `teacher': egen `obs_teacher'=count(`teacher')
       = by school_id: egen __00000O=count(school_id)
03     - qui gen float tv=.
03     - if "`quasiexperiment'"!="" {
       = if ""!="" {
03       qui gen float tv_2yr_l=.
03       qui gen float tv_2yr_f=.
03       qui gen float tv_ss=.
03       mata: driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", "`cl
> ass_mean'", "`weight'", "`obs_teacher'", "tv", "tv_2yr_l", "tv_2yr_f", "tv_ss
> ")
03       }
03     - else mata:driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", 
> "`class_mean'", "`weight'", "`obs_teacher'", "tv")
       = else mata:driftcalclist(vectorToStripeDiag(m), "school_id", "year", "_
> _000003", "__00000F", "__00000O", "tv")
03     - if ("`quasiexperiment'"=="") keep `teacher' `year' `by' tv
       = if (""=="") keep school_id year  tv
03     - else keep `teacher' `year' `by' tv tv_2yr_l tv_2yr_f tv_ss
       = else keep school_id year  tv tv_2yr_l tv_2yr_f tv_ss
03     - if (`firstloop'!=1) append using `"`output'"', nolabel
       = if (1!=1) append using `"/home/tmp/St192370.000002"', nolabel
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - local firstloop=0
03     - }
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if "`output_addvars'"!="" quietly {
       = if ""!="" quietly {
03       restore, preserve
03       keep `teacher' `year' `by' `output_addvars'
03       bys `teacher' `year' `by' `output_addvars': keep if _n==1
03       merge m:1 `teacher' `year' `by' using `"`output'"', nogen nolabel
03       }
03     - sort `teacher' `year' `by'
       = sort school_id year 
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabels=""
03       forvalues i=1/`by_vals' {
03       local bylabel : label `byvar' `i', strict
03       local bylabel=subinstr("`bylabel'"," ","_",.)
03       local bylabels `bylabels' _`bylabel'
03       }
03       mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_lag_acc
> um, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, cov_sa
> meyear_accum, corr_sameyear_accum, obs_sameyear_accum, tokens(st_local("bylab
> els")))
03       }
03     - else mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_la
> g_accum, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, c
> ov_sameyear_accum, corr_sameyear_accum, obs_sameyear_accum, "")
03     - if (`nooutput'!=1) qui outsheet using `"`output'_variance.csv"', comma
>  replace
       = if (1!=1) qui outsheet using `"/home/tmp/St192370.000002_variance.csv"
> ', comma replace
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if inlist("`1'","preserve","merge") {
       = if inlist("merge","preserve","merge") {
03     - restore
03     - if (`merge_resid'==1) {
       = if (1==1) {
03     - if ("`byvar'"!="") qui keep if missing(`teacher',`year',`class',`byvar
> ')
       = if (""!="") qui keep if missing(school_id,year,school_id,)
03     - else qui keep if missing(`teacher',`year',`class')
       = else qui keep if missing(school_id,year,school_id)
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - append using `"`resid_data_`l''"', nolabel
       = append using `"/home/tmp/St192370.000004"', nolabel
03     - }
03     - }
03     - if (`merge_tv'==1) qui merge m:1 `teacher' `year' `by' `output_addvars
> ' using `"`output'"', nogen nolabel
       = if (1==1) qui merge m:1 school_id year   using `"/home/tmp/St192370.00
> 0002"', nogen nolabel
03     - }
03     - else {
03       restore, not
03       if ("`data'"=="tv") use `"`output'"', clear
03       }
       ------------------------------------------------------------ end vam ---
02   - rename tv va_cfr_g11_`subject'
     = rename tv va_cfr_g11_ela
       =struct rename_peldf {
       =        string scalar        element
       =        real scalar  elementtype
       =        real scalar            arg
       =        real scalar            match
       =struct rename_patterndf {
       =        real scalar  patterntype
       =        string scalar            original
       =        struct rename_peldf rowvector          ellist
       =        real rowvector            n_of
       =        string rowvector            varnames
       =        string matrix            pieces
       =struct rename_optiondf {
       =        real scalar       isrecase
       =        real scalar       isrecase_upper, isrecase_lower, isrecase_prop
> er
       =        real scalar       isdryrun
       =        real scalar       isrenumber, isaddnumber
       =        real scalar            from
       =        real scalar       issort
       =        real scalar       isdebug
       =        real scalar       istest
       =        real scalar       isr
       =void rename_optiondf_init(struct rename_optiondf scalar option)
       =        option.isrecase = option.isdryrun = 0
       =                                option.isrecase_proper = 0
       =        option.isrenumber = option.isaddnumber = 0
       =        option.issort     = 0
       =        option.isdebug    = 0
       =        option.istest     = 0
       =        option.isr        = 0
       =struct rename_renamedf {
       =        struct rename_patterndf rowvector      oldplist
       =        struct rename_patterndf rowvector      newplist
       =        struct rename_optiondf scalar       option
       =void rename_cmd(string scalar thirdarg)
       =        string scalar    input
       =real scalar can_do_fast(string scalar input)
       =        string rowvector    token
       =        real scalar    rc
       =        if (length(token)!=2) return(0)
       =        if (!st_isname(token[1])) return(0)
       =        if (!st_isname(token[2])) return(0)
       =        if (token[1] == token[2]) return(0)
       =        return(1)
       =void rename_cmd_u(string scalar input)
       =        struct rename_renamedf scalar       ren
       =                dump_pattern(ren.oldplist, "old after parsing", 0)
       =                dump_pattern(ren.newplist, "new after parsing", 0)
       =void xeq_old_to_new(struct rename_renamedf scalar ren)
       =                dump_pattern(ren.oldplist, "old after linkage", 0)
       =                dump_pattern(ren.newplist, "new after linkage", 0)
       =                dump_pattern(ren.oldplist, "old final", 1)
       =                dump_pattern(ren.newplist, "new final", 1)
       =void xeq_recase(struct rename_renamedf scalar ren)
       =        fillin_old_varnames(ren.oldplist, ren.newplist, 0)
       =                dump_pattern(ren.oldplist, "old final", 1)
       =                dump_pattern(ren.newplist, "new final", 1)
       =void parse_cmd(struct rename_renamedf scalar ren, string scalar input)
       =        real scalar            c
       =        string scalar            lhs, ops
       =        string scalar            oldnames, newnames
       =        parse_cmd_pat_els(ren.oldplist, oldnames, 0)
       =                parse_cmd_pat_els(ren.newplist, newnames, 1)
       =real scalar parse_cmd_commaloc(string scalar s)
       =        real scalar    i, L
       =        real scalar    nestlev
       =        string scalar    c
       =void getarg(string scalar input, string scalar arg, string scalar rest)
       =        real scalar    L, npar, i
       =        string scalar    c
       =void parse_cmd_options(struct rename_optiondf scalar option, string sca
> lar ops)
       =        string scalar            token
       =        transmorphic      t
       =        rename_optiondf_init(option)
       =void confirm_options_consistent(struct rename_optiondf scalar option)
       =        string rowvector    list
       =void parse_cmd_options_u(struct rename_optiondf scalar option, string s
> calar token, transmorphic t)
       =real scalar parse_cmd_options_u_std(struct rename_optiondf scalar optio
> n, string scalar source)
       =        real scalar    l
       =                option.isdebug = 1
       =                option.isdryrun = 1
       =                option.isrecase = option.isrecase_lower = 1
       =                option.isrecase = option.isrecase_proper= 1
       =                option.isr = 1
       =                option.issort = 1
       =                option.istest = 1
       =                option.isrecase = option.isrecase_upper = 1
       =        else    return(0)
       =        return(1)
       =real scalar parse_cmd_options_u_number(struct rename_optiondf scalar op
> tion, string scalar source,
       =                                                                transmo
> rphic t)
       =        string scalar            token
       =        real scalar            from
       =        real scalar            l
       =        string scalar            op
       =        if (option.isrenumber | option.isaddnumber)  return(0)
       =                option.isrenumber = 1
       =                option.isaddnumber = 1
       =                return(1)
       =        return(1)
       =void parse_cmd_pat_els(struct rename_patterndf rowvector pat, string sc
> alar toparse, real pattype)
       =        string scalar            token, curlist
       =        transmorphic      t
       =        real scalar       first
       =        first   = 1
       =                                first    = 1
       =                                first   = 0
       =void parse_cmd_pat_el(struct rename_patterndf rowvector pat, string sca
> lar token, real pattype)
       =        string scalar            mytoken
       =        struct rename_patterndf scalar      mypat
       =        real scalar            i, j
       =        real matrix            found
       =        mypat.n_of        = J(1, (8), 0)
       =        confirm_not_empty(mytoken, pattype==0 ?
       =                if (i=strpos(mytoken, "*")) found = (found \ (i, (3)))
       =                if (i=strpos(mytoken, "?")) found = (found \ (i, (4) ))
       =                if (i=strpos(mytoken, "#")) found = (found \ (i, (5)))
       =                if (i=strpos(mytoken, "(")) found = (found \ (i, (6)))
       =                if (i=strpos(mytoken, "=")) found = (found \ (i, (7)))
       =                if (i=strpos(mytoken, ".")) found = (found \ (i, (8)))
       =                        if (i==(3)) {
       =                        else if (i==(4)) {
       =                        else if (i==(5)) {
       =                        else if (i==(6)) {
       =                        else if (i==(7)) {
       =                        else if (i==(8)) {
       =string scalar set_subscript(struct rename_patterndf scalar pat, string 
> scalar token, real pt)
       =        real scalar    i
       =        string scalar    c
       =        if (pt != 1) {
       =        if (pt != 1)              return(token)
       =void set_pat_ETstrlist(struct rename_patterndf scalar pat, string scala
> r token)
       =        struct rename_peldf scalar          el
       =        el.elementtype = (1)
       =        pat.n_of[(1)] = pat.n_of[(1)] + 1
       =string scalar set_pat_str(struct rename_patterndf scalar pat, string sc
> alar token)
       =        struct rename_peldf scalar          el
       =        el.elementtype = (2)
       =string scalar set_pat_ETstar(struct rename_patterndf scalar pat, string
>  scalar token, real scalar loc)
       =        struct rename_peldf scalar          el
       =        if (pat.patterntype == 0 && length(pat.ellist)) {
       =                if (pat.ellist[length(pat.ellist)].elementtype == (3)) 
> {
       =        el.elementtype = (3)
       =string scalar set_pat_ETnum_v(struct rename_patterndf scalar pat, strin
> g scalar token, real scalar loc)
       =        struct rename_peldf scalar          el
       =        if (pat.patterntype == 0 && length(pat.ellist)) {
       =                if (pat.ellist[length(pat.ellist)].elementtype == (5)) 
> {
       =        el.elementtype = (5)
       =string scalar set_pat_ETeq(struct rename_patterndf scalar pat, string s
> calar token, real scalar loc)
       =        struct rename_peldf scalar  el
       =        if (pat.patterntype == 0) {
       =        el.elementtype = (7)
       =string scalar set_pat_ETodot(struct rename_patterndf scalar pat, string
>  scalar token, real scalar loc)
       =        struct rename_peldf scalar  el
       =        if (pat.patterntype == 0) {
       =        el.elementtype = (8)
       =string scalar set_pat_ETqm(struct rename_patterndf scalar pat, string s
> calar token, real scalar loc)
       =        struct rename_peldf scalar  el
       =        el.elementtype = (4)
       =string scalar set_pat_ETnum_f(struct rename_patterndf scalar pat, strin
> g scalar token, real scalar loc)
       =        struct rename_peldf scalar          el
       =        real scalar            j
       =        el.elementtype = (6)
       =        if (el.arg > 10) {
       =void make_patternlist_lengths_equal(struct rename_renamedf scalar ren)
       =void build_recase_newpattern(struct rename_renamedf scalar ren)
       =        real scalar    i
       =        ren.newplist = rename_patterndf(length(ren.oldplist))
       =                ren.newplist[i].n_of        = J(1, (8), 0)
       =void link_patterns(struct rename_renamedf scalar ren)
       =        real scalar    i, jn
       =real scalar check_and_fix_ETnum(struct rename_patterndf scalar newp, st
> ruct rename_optiondf scalar option)
       =        real scalar            n, j, jn
       =        real scalar  tt
       =                if (tt==(5) | tt==(6)) {
       =                                (tt==(5) ? (9) : (10))
       =struct rename_linklocdf {
       =        real scalar    j_old, last_sequential_j_old
       =        real scalar    j_new
       =        real scalar    jn
       =        real rowvector    mapsub
       =void rename_linklocdf_init(struct rename_linklocdf scalar ll, real scal
> ar jn)
       =void rename_linklocdf_next(struct rename_linklocdf scalar ll, struct re
> name_patterndf scalar oldp, struct rename_patterndf scalar newp)
       =        real scalar subscr
       =real scalar map_subscript(real scalar subscr, real rowvector mapsub, st
> ruct rename_patterndf scalar oldp, struct rename_patterndf scalar newp)
       =void link_patterns_u(struct rename_patterndf scalar oldp, struct rename
> _patterndf scalar newp, real scalar jn)
       =        struct rename_linklocdf scalar      ll
       =        rename_linklocdf_init(ll, jn)
       =        rename_linklocdf_next(ll, oldp, newp)
       =                rename_linklocdf_next(ll, oldp, newp)
       =real rowvector pelidx_of_wcidx(struct rename_patterndf scalar oldp)
       =        real rowvector            toret
       =        real scalar            i
       =        real scalar  tt
       =                if (tt!=(1) & tt!=(2)) toret = (toret, i)
       =void confirm_wildcards_link(struct rename_patterndf scalar oldp, real s
> calar j_old,
       =                            struct rename_patterndf scalar newp, real s
> calar j_new)
       =        real scalar  tt_old, tt_new
       =        if (tt_new == (3)) return
       =        if (tt_new == (8))  return
       =        if (tt_new == (4)) {
       =                if (tt_old == (4)) return
       =        if (tt_new==(5) | tt_new==(6)) {
       =                if (tt_old==(5) | tt_old==(6)) return
       =string scalar printable_wildcard(struct rename_peldf scalar el)
       =        real scalar  tt
       =        if (tt == (3))  return("*")
       =        if (tt == (4))    return("?")
       =        if (tt == (8))  return(".")
       =        if (tt == (5)) return("#")
       =        if (tt == (6)) return("(" + el.arg*"*" + ")")
       =real scalar count_wildcards(struct rename_patterndf scalar pat)
       =        return(pat.n_of[(3)]  +
       =               pat.n_of[(4)]    +
       =               pat.n_of[(5)] +
       =               pat.n_of[(6)] +
       =               pat.n_of[(8)])
       =real scalar is_wildcard(real scalar tt)
       =        return( tt == (3)  |
       =                tt == (4)    |
       =                tt == (5) |
       =                tt == (6) |
       =                tt == (9) |
       =                tt == (10) |
       =                tt == (8)  )
       =real scalar find_next_wildcard(struct rename_peldf rowvector d, real sc
> alar j0)
       =        real scalar    j
       =void fillin_old_varnames(struct rename_patterndf rowvector oldplist, st
> ruct rename_patterndf rowvector newplist,
       =                                                        real scalar iss
> ort)
       =        real scalar    i
       =        string scalar    tmpname
       =void fillin_old_varnames_u(struct rename_patterndf scalar oldp, struct 
> rename_patterndf scalar newp,
       =                                        real scalar issort, string scal
> ar tmpname)
       =        string rowvector            varnames, piece
       =        real scalar            i, n, nvars, nels
       =        string matrix            pieces
       =        real scalar  tt
       =        real scalar       filter_varlist, fillin_pieces
       =        filter_varlist = (oldp.n_of[(5)] + oldp.n_of[(6)] != 0)
       =        fillin_pieces  = (newp.n_of[(5)] + newp.n_of[(6)] +
       =                          newp.n_of[(3)]  + newp.n_of[(4)]    != 0)
       =        if (issort) fillin_pieces = 1
       =                        if (tt==(3) | tt==(4)) {
       =string scalar varlistpattern(struct rename_peldf rowvector ellist)
       =        real scalar    j
       =        string scalar    result
       =        if (ellist[1].elementtype == (1)) return(ellist[1].element)
       =string scalar varlist_el(struct rename_peldf scalar el)
       =        if (el.elementtype == (2))    return(el.element)
       =        if (el.elementtype == (3))   return("*")
       =        if (el.elementtype == (4))     return("?")
       =        if (el.elementtype == (5))  return("?*")
       =        if (el.elementtype == (6))  return(el.arg*"?")
       =struct rename_matchdf {
       =        real scalar    j0, j1
       =        real scalar    i0, i1
       =        string scalar    name
       =        string rowvector    pieces
       =real scalar matchvarname(string rowvector pieces, struct rename_peldf r
> owvector ellist, string scalar name)
       =        struct rename_matchdf scalar        m
       =                if (ellist[1].elementtype==(1)) {
       =                        return(1)
       =        if (!match_step(m, ellist)) return(0)
       =        return(1)
       =void match_setup(struct rename_matchdf scalar m, struct rename_peldf ro
> wvector ellist, string scalar name)
       =real scalar match_step(struct rename_matchdf scalar m, struct rename_pe
> ldf rowvector ellist)
       =        real scalar            lefttomatch
       =        real scalar      mr
       =        real scalar     r
       =                if ((r=match_query_done(m))!=(-1)) return(r)
       =                if (match_simplification(m, ellist)==-1) return(0)
       =                if ((r=match_query_done(m))!=(-1)) return(r)
       =                        if (match_step_1(m, ellist)==-1) return(0)
       =                        if ((r=match_query_done(m))!=(-1)) return(r)
       =                        return(0)
       =                        if (mr==-1 | mr==0) return(0)
       =                        if (mr==-1 | mr==0) return(0)
       =real scalar match_step_1(struct rename_matchdf scalar m, struct rename_
> peldf rowvector ellist)
       =        if (ellist[m.j0].elementtype==(5)) {
       =                return(match_ETnum_v(m, ellist, 1))
       =        if (ellist[m.j0].elementtype==(3)) {
       =        return(-1)
       =real scalar match_step_2(struct rename_matchdf scalar m, struct rename_
> peldf rowvector ellist)
       =        if (ellist[m.j0].elementtype==(5)) {
       =                return(match_ETnum_v(m, ellist, 1))
       =        if (ellist[m.j0+1].elementtype==(5)) {
       =                return(match_ETnum_v(m, ellist, 0))
       =        return(-1)
       =real scalar match_step_3p(struct rename_matchdf scalar m, struct rename
> _peldf rowvector ellist)
       =        real scalar    j
       =        if (ellist[m.j0].elementtype==(3)) {
       =                if (ellist[j].elementtype==(3)) {
       =                if (ellist[j].elementtype==(5)) {
       =                        return(match_ETnum_v(m, ellist, 0))
       =        if (ellist[m.j0].elementtype==(5)) {
       =                return(match_ETnum_v(m, ellist, 1))
       =        return(-1)
       =real scalar match_query_done(struct rename_matchdf scalar m)
       =                if (m.i0 < m.i1) return(0)
       =                return(1)
       =        return((-1))
       =real scalar match_simplification(struct rename_matchdf scalar m, struct
>  rename_peldf rowvector ellist)
       =        real scalar      mr
       =        while ((m.i1 >m.i0 & m.j1> m.j0)) {
       =                mr = match_fixed(m, ellist, 1)
       =                if (mr==-1) return(-1)
       =                if (mr==0)   break
       =        while ((m.i1 >m.i0 & m.j1> m.j0)) {
       =                mr = match_fixed(m, ellist, 0)
       =                if (mr==-1) return(-1)
       =                if (mr==0)   break
       =real scalar match_fixed(struct rename_matchdf scalar m, struct rename_p
> eldf rowvector ellist, real scalar s)
       =        real scalar    j
       =        j = (s==1 ? m.j0 : m.j1-1)
       =        if (ellist[j].elementtype==(2))   return(match_ETstr(m, ellist,
>  s))
       =        if (ellist[j].elementtype==(6)) return(match_ETnum_f(m, ellist,
>  s))
       =        if (ellist[j].elementtype==(4))    return(match_ETqm(m, ellist,
>  s))
       =        return(0)
       =real scalar match_ETstr(struct rename_matchdf scalar m, struct rename_p
> eldf rowvector ellist, real scalar s)
       =        real scalar    j, len
       =        j = (s==1 ? m.j0 : m.j1-1)
       =        if (ellist[j].elementtype != (2)) return(0)
       =        if ((s==1 ?  usubstr(m.name, m.i0, len) :
       =                return(-1)
       =        return(1)
       =real scalar match_ETnum_f(struct rename_matchdf scalar m, struct rename
> _peldf rowvector ellist, real scalar s)
       =        real scalar    j, i, len
       =        string scalar    str, c
       =        j = (s==1 ? m.j0 : m.j1-1)
       =        if (ellist[j].elementtype != (6)) return(0)
       =        str = (s==1 ?  usubstr(m.name, m.i0, len) : usubstr(m.name, -le
> n, .))
       =        if (ustrlen(str)!=len) return(-1)
       =                if (c<"0" | c>"9") return(-1)
       =        return(1)
       =real scalar match_ETqm(struct rename_matchdf scalar m, struct rename_pe
> ldf rowvector ellist, real scalar s)
       =        if (ellist[s==1 ? m.j0 : m.j1-1].elementtype != (4)) {
       =                return(0)
       =        if (m.i0==m.i1) return(-1)
       =        return(1)
       =real scalar match_ETnum_v(struct rename_matchdf scalar m, struct rename
> _peldf rowvector ellist, real scalar s)
       =        real scalar            j, i0, i1, len
       =        string scalar            c
       =        string scalar            c1
       =        struct rename_matchdf scalar        hold
       =        j = (s==1 ? m.j0 : m.j1-1)
       =        if (ellist[j].elementtype != (5)) return(0)
       =        if (s==1) {
       =                if (match_step(m, ellist)==1) return(1)
       =        return(-1)
       =real scalar match_ETstar_left(struct rename_matchdf scalar m, struct re
> name_peldf rowvector ellist)
       =        real scalar            len, newlen
       =        struct rename_matchdf scalar        hold
       =        real scalar       next_is_ETnum_v
       =        if (ellist[m.j0].elementtype != (3)) return(0)
       =                post_match_piece(m, 1, len)
       =                return(1)
       =        next_is_ETnum_v = (ellist[m.j0+1].elementtype==(5))
       =                post_match_piece(m, 1, len)
       =                if (match_step(m, ellist)==1) {
       =                                        post_match_piece(m, 1, newlen)
       =                        return(1)
       =        return(-1)
       =real scalar mstargiveback(string scalar s)
       =        real scalar    l
       =        string scalar    c
       =        string scalar    c1
       =void post_match_piece(struct rename_matchdf scalar m, real scalar s, re
> al scalar len)
       =        if (s==1) {
       =void sort_old_varnames(struct rename_renamedf scalar ren)
       =        real scalar i
       =void sort_appropriate_field(struct rename_patterndf rowvector oldplist,
>  struct rename_patterndf rowvector newplist)
       =        real scalar            i
       =        real scalar            j
       =real scalar j_of_renumber(struct rename_patterndf scalar plist)
       =        real scalar            j
       =        real scalar  tt
       =                if (tt==(9) | tt==(10)) return(j)
       =real scalar j_of_number(struct rename_patterndf scalar plist)
       =        real scalar            j, jtoret
       =        real scalar  tt
       =                if (tt==(3) | tt==(4) | tt==(5) | tt==(6)) {
       =void sort_on_field(struct rename_patterndf scalar plist, real scalar j)
       =        real scalar  tt
       =        real colvector            o
       =        string colvector            vc
       =                if (tt==(5) | tt==(6)) {
       =void fillin_new_varnames_recase(struct rename_renamedf scalar ren)
       =        real scalar    i
       =void fillin_new_varnames(struct rename_patterndf rowvector oldplist, st
> ruct rename_patterndf rowvector newplist, real scalar from)
       =        real scalar    i
       =void fillin_new_varnames_u(struct rename_patterndf scalar oldp, struct 
> rename_patterndf scalar newp, real scalar from)
       =        real scalar    i
       =        if (newp.ellist[1].elementtype==(1)) {
       =void fillin_new_varnames_u_u(struct rename_patterndf scalar oldp, struc
> t rename_patterndf scalar newp, real scalar from, real scalar i)
       =        real scalar            j
       =        string scalar            name
       =        real scalar  tt
       =                if (tt==(2)) {
       =                else if (tt==(3)) {
       =                else if (tt==(4)) {
       =                else if (tt==(5)) {
       =                else if (tt==(6)) {
       =                else if (tt==(7)) {
       =                else if (tt==(9)) {
       =                else if (tt==(10)) {
       =                else if (tt != (8)) {
       =string scalar fmt_ETnum_f(struct rename_patterndf scalar oldp, struct r
> ename_patterndf scalar newp, real scalar i, real scalar j)
       =        real scalar    n, len
       =        string scalar    res, orig
       =string scalar fmt_ETnum_f_r(struct rename_patterndf scalar oldp, struct
>  rename_patterndf scalar newp, real scalar j, real scalar from)
       =        real scalar    n, len
       =        string scalar res
       =string matrix build_toren(struct rename_patterndf rowvector oldplist, s
> truct rename_patterndf rowvector newplist)
       =        string matrix    toren
       =        real scalar    i, N, n, k, k2
       =        real colvector    toselect
       =        string rowvector    lastrow, newrow
       =        real scalar hasomissions
       =                                hasomissions = 1
       =void perform_renames(string matrix toren, struct rename_optiondf scalar
>  option)
       =        real scalar       use_intermediary
       =        string matrix            toren_nonulls
       =                        perform_dryrun(toren, toren_nonulls, 0)
       =void confirm_newnames_new(string matrix toren)
       =        real scalar    i
       =        real rowvector    varnum
       =        string rowvector    tocheck, badvar
       =void perform_set_r(string matrix toren)
       =void perform_test(string matrix toren, real scalar use_intermediary)
       =        real scalar    i
       =void perform_rename_straight(string matrix toren)
       =        real scalar    i
       =        real scalar    breakstatus
       =void perform_rename_intermediary(string matrix toren)
       =        real scalar    i
       =        real scalar    breakstatus
       =        string rowvector    tmpname
       =void perform_dryrun(string matrix toren, string matrix toren_nonulls, r
> eal scalar use_intermediary)
       =        real scalar    i
       =        real scalar    maxlen
       =        string scalar    sfmt, sfmtit
       =void dryrun_note1(string matrix toren, string matrix toren_nonulls)
       =        real scalar    i
       =        real scalar    nulls
       =void dryrun_note2(string matrix toren, real scalar use_intermediary)
       =        string colvector    dupnames, newname, oldname
       =real scalar names_not_jointly_unique(string matrix toren)
       =        real scalar    n0, n1
       =        string colvector    fulllist
       =void confirm_names_unique(string matrix toren)
       =void confirm_names_unique_1(string matrix toren, real scalar j)
       =        string colvector    names, corresponding
       =        string scalar    s
       =        real scalar    n
       =string colvector corresponding_names(string matrix toren, string scalar
>  name, real scalar js, real scalar jd)
       =        real scalar    i
       =        string colvector    dups
       =void confirm_new_varnames_valid(string matrix toren)
       =        real scalar    i, n
       =        real colvector    bad
       =void confirm_not_empty(string scalar str, string scalar expected)
       =void errprint_bf_list(string vector list , |real scalar USER_MAXEL)
       =        real scalar            MAXEL
       =        real scalar            i, top
       =        real scalar       chopped
       =                        chopped = 1
       =                        chopped = 0
       =void errprint_bf_string(string scalar user_s, |real scalar USER_MAXLEN)
       =        real scalar            MAXLEN
       =        real scalar            len_last, target_last
       =        real scalar            len_remaining
       =        real scalar            i
       =        string rowvector            els
       =        string scalar            s, first, last
       =        real scalar       cont
       =        cont = 1
       =                else            cont   = 0
       =        string scalar    indent
       =void error_preceding_dash( pattype)
       =                        (pattype==0 ? "oldname" : "newname" ) )
       =void error_following_dash( pattype, string scalar what)
       =                        (pattype==0 ? "oldname" : "newname" ) )
       =void option_not_allowed(string scalar option)
       =void option_number_misspecified(string scalar op)
       =void error_ETnum_f_too_long(real scalar n_digits)
       =        errprintf("the {bf:(###...#)} pattern is %g.\n", 10)
       =void error_patternlengths_unequal(struct rename_patterndf rowvector old
> plist, struct rename_patterndf rowvector newplist)
       =        string scalar    s_old, s_new
       =void error_too_many_renumbers(string scalar op, struct rename_patterndf
>  scalar newp)
       =void error_strlist_length(struct rename_patterndf scalar oldp, struct r
> ename_patterndf scalar newp)
       =        real scalar    n_old, n_new
       =        string scalar    s_old, s_new
       =void error_missing_ETnum(string scalar opname, struct rename_patterndf 
> scalar newp)
       =void error_too_many_wildcards(struct rename_patterndf scalar oldp, stru
> ct rename_patterndf scalar newp,
       =                                                        real scalar isa
> ddnumber)
       =void error_wildcardmatch_qm(struct rename_patterndf scalar oldp, real s
> calar j_old,
       =                            struct rename_patterndf scalar newp, real s
> calar j_new)
       =void error_wildcardmatch_hash(struct rename_patterndf scalar oldp, real
>  scalar j_old,
       =                              struct rename_patterndf scalar newp, real
>  scalar j_new)
       =void error_no_right_bracket(string scalar original)
       =void error_inside_brackets(string scalar original)
       =void error_newnumber_subscripted(struct rename_patterndf scalar oldp, s
> truct rename_patterndf scalar newp)
       =void error_subscript_invalid(struct rename_patterndf scalar oldp, struc
> t rename_patterndf scalar newp, real scalar subscr)
       =void error_subscripts_in_old(struct rename_patterndf scalar pat)
       =void dump_pattern(struct rename_patterndf rowvector pat, string scalar 
> typ, real scalar incl_names)
       =        real scalar    i, j, n
       =        real scalar    nv, k, m
       =                        pat[i].n_of[(2)],
       =                        pat[i].n_of[(3)],
       =                        pat[i].n_of[(4)],
       =                        pat[i].n_of[(5)],
       =                        pat[i].n_of[(6)],
       =                        pat[i].n_of[(7)],
       =                        pat[i].n_of[(8)])
       =string scalar dump_xlate_tt(real scalar t)
       =        if (t==(1))     return("ETstrlist")
       =        if (t==(2))         return("ETstr")
       =        if (t==(3))        return("ETstar")
       =        if (t==(4))          return("ETqm")
       =        if (t==(5))       return("ETnum_v")
       =        if (t==(6))       return("ETnum_f")
       =        if (t==(7))          return("ETeq")
       =        if (t==(8))        return("ETodot")
       =        if (t==(9))     return("ETnum_v_r")
       =        if (t==(10))     return("ETnum_f_r")
       =void dump_options(struct rename_renamedf scalar ren)
       =void match_debug(struct rename_matchdf scalar m, struct rename_peldf ro
> wvector ellist, string scalar msg)
       =string rowvector list_subtract(string rowvector a, string rowvector b)
       =        string rowvector result
       =string rowvector expand_varlist(string scalar pattern, string scalar tm
> pname)
       =        real scalar    rc
       =        string rowvector    result
       =string scalar ordinal_suffix(real scalar i)
       =        real scalar    lastdigit
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename score_r sbac_g11_`subject'_r
     = rename score_r sbac_g11_ela_r
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_ela_r va_cfr_g11_ela, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_ela_r va_cfr_g11_ela, cluster(school_id)

Linear regression                               Number of obs     =    675,586
                                                F(1, 1275)        =    2114.68
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0410
                                                Root MSE          =     .55544

                          (Std. err. adjusted for 1,276 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_e~r | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~a |   .9820442   .0213554    45.99   0.000     .9401486     1.02394
       _cons |  -.0002073   .0012526    -0.17   0.869    -.0026646    .0022501
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr
> _g11_`subject'_sibling_nocontrol.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, rep
> lace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, replace
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, repla
> ce
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_v
> a_cfr_g11_`subject'_sibling_nocontrol.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, r
> eplace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, repla
> ce
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling_nocontrol.ster, rep
> lace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
     = rename va_cfr_g11_ela va_cfr_g11_ela_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename sbac_g11_`subject'_r sbac_g11_`subject'_r_nosibctrl
     = rename sbac_g11_ela_r sbac_g11_ela_r_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - label var va_cfr_g11_`subject'_nosibctrl "`subject' VA with family FE wi
> thout TFX without sibling control"
     = label var va_cfr_g11_ela_nosibctrl "ela VA with family FE without TFX wi
> thout sibling control"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var va_cfr_g11_ela_nosibctrl "ela VA with 
> family FE without TFX without sibling control"
03     - }
       ---------------------------------------------------------- end label ---
02   - label var sbac_g11_`subject'_r_nosibctrl "`subject' score residual with 
> family FE without TFX without sibling control"
     = label var sbac_g11_ela_r_nosibctrl "ela score residual with family FE wi
> thout TFX without sibling control"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var sbac_g11_ela_r_nosibctrl "ela score re
> sidual with family FE without TFX without sibling control"
03     - }
       ---------------------------------------------------------- end label ---
02   - vam sbac_`subject'_z_score , teacher(school_id) year(year) class(school_
> id) controls( i.year i.has_older_sibling_enr_2year i.has_older_sibling_enr_4y
> ear `school_controls' `demographic_controls' `ela_score_controls' `math_score
> _controls' ) data(merge tv score_r) driftlimit(`drift_limit') estimates($vapr
> ojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`subject'.ster, replace)
     = vam sbac_ela_z_score , teacher(school_id) year(year) class(school_id) co
> ntrols( i.year i.has_older_sibling_enr_2year i.has_older_sibling_enr_4year  a
> ge         i.male         i.eth_asian i.eth_hispanic i.eth_black i.eth_other 
>         i.econ_disadvantage         i.limited_eng_prof         i.disabled i.y
> ear#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_z_score) i.year#(c
> .prior_math_z_score##c.prior_math_z_score##c.prior_math_z_score) ) data(merge
>  tv score_r) driftlimit(2) estimates(/home/research/ca_ed_lab/projects/common
> _core_va/estimates/sibling_va/test_score_va/vam_cfr_g11_ela.ster, replace)
       ---------------------------------------------------------- begin vam ---
03     - version 10.1
03     - set more off
03     - syntax varname(ts fv) [aweight/], teacher(varname) year(varname) class
> (varname) [ by(varlist) controls(varlist ts fv) absorb(varname) tfx_resid(var
> name) data(string) output(string) output_addvars(varlist) driftlimit(integer 
> -1) QUASIexperiment CONStant noseed varclasszero estimates(string asis)]
03     - local depvar `varlist'
       = local depvar sbac_ela_z_score
03     - capture confirm variable score_r, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named score_r."
03       exit 110
03       }
03     - capture confirm variable tv, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv."
03       exit 110
03       }
03     - if ("`quasiexperiment'"!="") {
       = if (""!="") {
03       capture confirm variable tv_2yr_l, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_l."
03       exit 110
03       }
03       capture confirm variable tv_2yr_f, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_f."
03       exit 110
03       }
03       capture confirm variable tv_ss, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_ss."
03       exit 110
03       }
03       }
03     - local merge_tv=0
03     - local merge_resid=0
03     - if ("`data'"=="") local data="preserve"
       = if ("merge tv score_r"=="") local data="preserve"
03     - else {
03     - if !inlist("`data'","preserve","tv","merge tv","merge score_r","merge 
> tv score_r","merge score_r tv","variance") {
       = if !inlist("merge tv score_r","preserve","tv","merge tv","merge score_
> r","merge tv score_r","merge score_r tv","variance") {
03       di as error "Not a valid argument for data. Choose either 'preserve', 
> 'tv', 'merge [tv AND/OR score_r]', or 'variance'."
03       exit 198
03       }
03     - else {
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if ("`1'")=="merge" {
       = if ("merge")=="merge" {
03     - if ("`2'"=="tv") | ("`3'"=="tv") local merge_tv=1
       = if ("tv"=="tv") | ("score_r"=="tv") local merge_tv=1
03     - if ("`2'"=="score_r") | ("`3'"=="score_r") local merge_resid=1
       = if ("tv"=="score_r") | ("score_r"=="score_r") local merge_resid=1
03     - }
03     - }
03     - }
03     - if "`tfx_resid'"!="" & "`absorb'"!="" {
       = if ""!="" & ""!="" {
03       di as error "Cannot specify an absorb variable and a tfx_resid variabl
> e simultaneously."
03       exit 198
03       }
03     - if `"`output'"'=="" {
       = if `""'=="" {
03     - tempfile output
03     - local nooutput=1
03     - }
03     - else local nooutput=0
03     - if ("`by'"!="") {
       = if (""!="") {
03       tempvar byvar
03       egen `byvar'=group(`by'), label
03       sum `byvar', meanonly
03       local by_vals=`r(max)'
03       }
03     - else local by_vals=1
03     - if "`weight'"!="" {
       = if ""!="" {
03       local ind_weight "`weight'"
03       macro drop _weight
03       local ind_exp "`exp'"
03       macro drop _exp
03       local times_exp "* `exp'"
03       }
03     - preserve
03     - local firstloop=1
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - if (`firstloop'!=1) restore, preserve
       = if (1!=1) restore, preserve
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabel : label `byvar' `l', strict
03       di "{bf:-> by variables:} `by' = `bylabel'"
03       }
03     - qui drop if missing(`teacher',`year',`class')
       = qui drop if missing(school_id,year,school_id)
03     - if ("`by'"!="") qui keep if `byvar'==`l'
       = if (""!="") qui keep if ==1
03     - if "`absorb'"!="" | "`tfx_resid'"!="" {
       = if ""!="" | ""!="" {
03       if "`ind_weight'"=="" {
03       noisily areg `depvar' `controls' , absorb(`absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       else if "`ind_weight'"!="" {
03       noisily areg `depvar' `controls' [`ind_weight' = `ind_exp'] , absorb(`
> absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       }
03     - else {
03     - if "`ind_weight'"=="" {
       = if ""=="" {
03     - version 11 : noisily reg `depvar' `controls'
       = version 11 : noisily reg sbac_ela_z_score i.year i.has_older_sibling_e
> nr_2year i.has_older_sibling_enr_4year age i.male i.eth_asian i.eth_hispanic 
> i.eth_black i.eth_other i.econ_disadvantage i.limited_eng_prof i.disabled i.y
> ear#c.prior_ela_z_score i.year#c.prior_ela_z_score#c.prior_ela_z_score i.year
> #c.prior_ela_z_score#c.prior_ela_z_score#c.prior_ela_z_score i.year#c.prior_m
> ath_z_score i.year#c.prior_math_z_score#c.prior_math_z_score i.year#c.prior_m
> ath_z_score#c.prior_math_z_score#c.prior_math_z_score

      Source |       SS           df       MS      Number of obs   =   677,254
-------------+----------------------------------   F(38, 677215)   =  26986.67
       Model |  329970.233        38  8683.42718   Prob > F        =    0.0000
    Residual |  217905.656   677,215  .321767321   R-squared       =    0.6023
-------------+----------------------------------   Adj R-squared   =    0.6022
       Total |  547875.889   677,253  .808967829   Root MSE        =    .56725

------------------------------------------------------------------------------
sbac_ela_z~e | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |
       2016  |   .0498498   .0027482    18.14   0.000     .0444634    .0552361
       2017  |   .0673758   .0027359    24.63   0.000     .0620135    .0727382
       2018  |   -.071269   .0027432   -25.98   0.000    -.0766456   -.0658924
             |
1.has_~2year |  -.0175035   .0026999    -6.48   0.000    -.0227952   -.0122119
1.has_~4year |    .039867   .0029653    13.44   0.000      .034055    .0456789
         age |  -.0003419   4.89e-06   -69.98   0.000    -.0003514   -.0003323
             |
        male |
       Male  |  -.0903183   .0014092   -64.09   0.000    -.0930803   -.0875563
 1.eth_asian |   .1032116   .0022649    45.57   0.000     .0987725    .1076507
1.eth_hisp~c |   -.004525   .0019299    -2.34   0.019    -.0083076   -.0007424
 1.eth_black |   -.144409   .0037975   -38.03   0.000     -.151852   -.1369659
 1.eth_other |   .0046592   .0042026     1.11   0.268    -.0035778    .0128962
             |
econ_disad~e |
Economic ..  |  -.0366289    .001636   -22.39   0.000    -.0398356   -.0334223
             |
limited_en~f |
Limited E..  |  -.2114748   .0036813   -57.45   0.000    -.2186901   -.2042595
             |
    disabled |
   Disabled  |  -.1860965   .0037182   -50.05   0.000    -.1933841   -.1788088
             |
        year#|
          c. |
prior_ela_~e |
       2015  |   .6114396   .0027974   218.57   0.000     .6059567    .6169225
       2016  |   .5929491   .0027252   217.58   0.000     .5876078    .5982904
       2017  |   .5815692   .0028657   202.94   0.000     .5759525    .5871858
       2018  |   .5722926   .0034902   163.97   0.000     .5654519    .5791333
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |     .00022   .0014744     0.15   0.881    -.0026698    .0031099
       2016  |   -.013837   .0014876    -9.30   0.000    -.0167526   -.0109213
       2017  |  -.0132133   .0014996    -8.81   0.000    -.0161525   -.0102741
       2018  |   .0110797   .0015061     7.36   0.000     .0081278    .0140316
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |  -.0275112   .0006824   -40.31   0.000    -.0288488   -.0261737
       2016  |  -.0226352   .0006238   -36.29   0.000    -.0238577   -.0214126
       2017  |  -.0236356    .000607   -38.94   0.000    -.0248252   -.0224459
       2018  |  -.0293958   .0009878   -29.76   0.000    -.0313318   -.0274597
             |
        year#|
          c. |
prior_math~e |
       2015  |   .1690369   .0027789    60.83   0.000     .1635904    .1744833
       2016  |    .188978   .0028265    66.86   0.000     .1834381    .1945179
       2017  |   .1883251   .0029483    63.87   0.000     .1825465    .1941038
       2018  |   .2470745   .0035317    69.96   0.000     .2401525    .2539964
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0046344   .0018499    -2.51   0.012    -.0082602   -.0010085
       2016  |  -.0127756   .0018011    -7.09   0.000    -.0163057   -.0092454
       2017  |  -.0071923   .0018426    -3.90   0.000    -.0108037   -.0035809
       2018  |   .0041748   .0014655     2.85   0.004     .0013025    .0070471
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0030776   .0007615    -4.04   0.000    -.0045702   -.0015851
       2016  |  -.0035084   .0008051    -4.36   0.000    -.0050865   -.0019304
       2017  |  -.0066265   .0007955    -8.33   0.000    -.0081856   -.0050673
       2018  |  -.0057665   .0009792    -5.89   0.000    -.0076857   -.0038473
             |
       _cons |    2.26474   .0299302    75.67   0.000     2.206078    2.323403
------------------------------------------------------------------------------
03     - if `"`estimates'"'!="" {
       = if `"/home/research/ca_ed_lab/projects/common_core_va/estimates/siblin
> g_va/test_score_va/vam_cfr_g11_ela.ster, replace"'!="" {
03     - estimates save `estimates'
       = estimates save /home/research/ca_ed_lab/projects/common_core_va/estima
> tes/sibling_va/test_score_va/vam_cfr_g11_ela.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/vam_cfr_g11_ela.ster saved
03     - }
03     - }
03     - else if "`ind_weight'"!="" {
       = else if ""!="" {
03       version 11 : noisily reg `depvar' `controls' [`ind_weight' = `ind_exp'
> ]
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03     - }
03     - if "`tfx_resid'"=="" {
       = if ""=="" {
03     - qui predict score_r if e(sample),r
03     - if "`constant'"!="" {
       = if ""!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03     - }
03     - else {
03       qui predict score_r if e(sample), dresiduals
03       if "`constant'"!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03       }
03     - if "`ind_weight'"!="" {
       = if ""!="" {
03       tempvar tot_ind_weight class_ind_weight
03       qui egen `tot_ind_weight' = total(`ind_exp') if !mi(score_r)
03       qui egen `class_ind_weight' = total(`ind_exp') if !mi(score_r), by(`te
> acher' `year' `group' `class')
03       }
03     - if `merge_resid'==1 {
       = if 1==1 {
03     - tempfile resid_data_`l'
       = tempfile resid_data_1
03     - qui save `"`resid_data_`l''"', replace
       = qui save `"/home/tmp/St192370.000004"', replace
03     - }
03     - tempname num_obs num_par
03     - scalar `num_obs' = e(N)
       = scalar __000000 = e(N)
03     - if "`absorb'"!="" {
       = if ""!="" {
03       scalar `num_par' = e(df_m) + e(df_a) + 1
03       }
03     - else {
03     - scalar `num_par' = e(df_m) + 1
       = scalar __000001 = e(df_m) + 1
03     - }
03     - tempvar n_tested
03     - qui bys `teacher' `year' `group' `class': egen `n_tested' = count(scor
> e_r)
       = qui bys school_id year  school_id: egen __000002 = count(score_r)
03     - tempvar class_mean index
03     - qui by `teacher' `year' `group' `class': egen `class_mean' = mean(scor
> e_r)
       = qui by school_id year  school_id: egen __000003 = mean(score_r)
03     - qui by `teacher' `year' `group' `class': g `index' = _n
       = qui by school_id year  school_id: g __000004 = _n
03     - tempname var_total
03     - qui sum score_r
03     - scalar `var_total' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_par'))
       = scalar __000005 = r(Var)*((__000000 - 1)/(__000000 - __000001))
03     - tempname num_class var_ind var_class
03     - tempvar individual_dev_from_class
03     - qui gen `individual_dev_from_class' = score_r - `class_mean'
       = qui gen __000009 = score_r - __000003
03     - qui count if `index'==1 & `n_tested'!=0
       = qui count if __000004==1 & __000002!=0
03     - scalar `num_class' = r(N)
       = scalar __000006 = r(N)
03     - qui sum `individual_dev_from_class'
       = qui sum __000009
03     - scalar `var_ind' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_class' - 
> `num_par' + 1))
       = scalar __000007 = r(Var)*((__000000 - 1)/(__000000 - __000006 - __0000
> 01 + 1))
03     - qui by `teacher' `year' `group' `class': keep if _n==1
       = qui by school_id year  school_id: keep if _n==1
03     - if "`seed'"=="" {
       = if ""=="" {
03     - set seed 9827496
03     - }
03     - tempvar rand classnum
03     - g `rand'=uniform()
       = g __00000A=uniform()
03     - bys `teacher' `year' (`rand'): gen `classnum'=_n
       = bys school_id year (__00000A): gen __00000B=_n
03     - tempname cov_sameyear corr_sameyear obs_sameyear
03     - qui sum `classnum'
       = qui sum __00000B
03     - if (r(max)==1) {
03     - local missing_sameyear=1
03     - scalar `cov_sameyear'=0
       = scalar __00000C=0
03     - }
03     - else {
03       local missing_sameyear=0
03       tempvar identifier
03       egen `identifier'=group(`teacher' `year')
03       qui tsset `identifier' `classnum'
03       qui corr `class_mean' f.`class_mean' [aw=`n_tested'+f.`n_tested'], cov
03       scalar `cov_sameyear'=r(cov_12)
03       scalar `corr_sameyear'=r(cov_12) / ( sqrt(r(Var_1)) * sqrt(r(Var_2)) )
03       scalar `obs_sameyear'=r(N)
03       }
03     - scalar `var_class' = `var_total' - `var_ind' - `cov_sameyear'
       = scalar __000008 = __000005 - __000007 - __00000C
03     - if (`var_class'<0) {
       = if (__000008<0) {
03       if ("`varclasszero'"!="varclasszero") {
03       di as error "Note: var_class has been computed as being less than 0."
03       di "var_class is defined as = var_total - var_ind - cov_sameyear."
03       di "Computed variances: var_total, var_ind, cov_sameyear, var_class"
03       di `var_total',`var_ind',`cov_sameyear',`var_class'
03       di "This negative variance can occur because cov_sameyear is calculate
> d using only the subsample of observations that teach multiple classes per ye
> ar (in the same by-group)."
03       }
03       else if ("`varclasszero'"=="varclasszero") {
03       scalar `var_class' = 0
03       }
03       }
03     - tempvar weight
03     - qui g `weight'=1/(`var_class' + `var_ind'/`n_tested')
       = qui g __00000F=1/(__000008 + __000007/__000002)
03     - tempvar excess_weight
03     - qui gen `excess_weight'=(missing(`weight'))
       = qui gen __00000G=(missing(__00000F))
03     - qui replace `weight'=1 if missing(`weight')
       = qui replace __00000F=1 if missing(__00000F)
03     - collapse (mean) `class_mean' (rawsum) `weight' `n_tested' `excess_weig
> ht' [aw=`weight'], by(`teacher' `year' `by') fast
       = collapse (mean) __000003 (rawsum) __00000F __000002 __00000G [aw=__000
> 00F], by(school_id year ) fast
03     - qui replace `weight'=`weight'-`excess_weight'
       = qui replace __00000F=__00000F-__00000G
03     - qui tsset `teacher' `year'
       = qui tsset school_id year
03     - tempvar minyear maxyear diff validyear minvalidyear maxvalidyear diffv
> alid
03     - qui bys `teacher': egen `minyear'=min(`year')
       = qui bys school_id: egen __00000H=min(year)
03     - qui by `teacher': egen `maxyear'=max(`year')
       = qui by school_id: egen __00000I=max(year)
03     - qui g `diff'=`maxyear'-`minyear'
       = qui g __00000J=__00000I-__00000H
03     - qui sum `diff'
       = qui sum __00000J
03     - local maxspan=`r(max)'
       = local maxspan=3
03     - qui gen `validyear'=`year' if !missing(`class_mean')
       = qui gen __00000K=year if !missing(__000003)
03     - qui by `teacher': egen `minvalidyear'=min(`validyear')
       = qui by school_id: egen __00000L=min(__00000K)
03     - qui by `teacher': egen `maxvalidyear'=max(`validyear')
       = qui by school_id: egen __00000M=max(__00000K)
03     - qui g `diffvalid'=`maxvalidyear'-`minvalidyear'
       = qui g __00000N=__00000M-__00000L
03     - qui sum `diffvalid'
       = qui sum __00000N
03     - local maxscorespan=`r(max)'
       = local maxscorespan=3
03     - if (`maxscorespan'<`maxspan') & (`driftlimit'<=0) {
       = if (3<3) & (2<=0) {
03       di as error _n "error: The maximum lags of teacher data is `maxspan', 
> but the maximum lags of teacher data with class scores is `maxscorespan'."
03       di as error "       You must either set driftlimit() <= `maxscorespan'
> , or drop observations so that the spans are no longer mismatched."
03       exit 499
03       }
03     - if (`driftlimit'>`maxscorespan') {
       = if (2>3) {
03       di as error "error: driftlimit(`driftlimit') was specified, which is g
> reater than the number of lags (`maxscorespan') in the data."
03       exit 499
03       }
03     - mata:CC=compute_cov_corr("`class_mean'","`n_tested'",`maxscorespan',"`
> teacher'")
       = mata:CC=compute_cov_corr("__000003","__000002",3,"school_id")
03     - if (`driftlimit'>0) mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyea
> r'"),`maxspan',`driftlimit')
       = if (2>0) mata:m=create_m(CC[.,1],st_numscalar("__00000C"),3,2)
03     - else mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyear'"))
       = else mata:m=create_m(CC[.,1],st_numscalar("__00000C"))
03     - di "Standard deviations: total, classes, students, teachers same year"
Standard deviations: total, classes, students, teachers same year
03     - if (`missing_sameyear'==0) di sqrt(`var_total'),sqrt(`var_class'),sqrt
> (`var_ind'),sqrt(`cov_sameyear')
       = if (1==0) di sqrt(__000005),sqrt(__000008),sqrt(__000007),sqrt(__00000
> C)
03     - else di sqrt(`var_total'),sqrt(`var_class'),sqrt(`var_ind'),.
       = else di sqrt(__000005),sqrt(__000008),sqrt(__000007),.
.56724538 .18200216 .53725463 .
03     - di "Covariances (left), correlations (middle), observations (right).  
> Row i indicates the relation between year t and t+i:"
Covariances (left), correlations (middle), observations (right).  Row i indicat
> es the relation between year t and t+i:
03     - mata:CC[.,1..3]
                 1             2             3
    +-------------------------------------------+
  1 |  .0198934192   .5739685075          3541  |
  2 |   .015092812   .4354752096          2299  |
  3 |  .0084986285   .2381615671          1105  |
    +-------------------------------------------+
03     - if (`driftlimit'>0) {
       = if (2>0) {
03     - di "Drift limit specified:"
Drift limit specified:
03     - di `driftlimit'
       = di 2
2
03     - di "Covariances used for VA computations:"
Covariances used for VA computations:
03     - mata: m[2..length(m)]'
                 1
    +---------------+
  1 |  .0198934192  |
  2 |   .015092812  |
  3 |   .015092812  |
    +---------------+
03     - }
03     - mata:check_m_nomissing(m)
03     - if (`firstloop'==1) {
       = if (1==1) {
03     - mata:cov_lag_accum= CC[.,1]
03     - mata:corr_lag_accum= CC[.,2]
03     - mata:obs_lag_accum= CC[.,3]
03     - mata:cov_se_lag_accum= CC[.,4]
03     - mata:var_total_accum= st_numscalar("`var_total'")
       = mata:var_total_accum= st_numscalar("__000005")
03     - mata:var_class_accum= st_numscalar("`var_class'")
       = mata:var_class_accum= st_numscalar("__000008")
03     - mata:var_ind_accum= st_numscalar("`var_ind'")
       = mata:var_ind_accum= st_numscalar("__000007")
03     - if (`missing_sameyear'==1) {
       = if (1==1) {
03     - mata:cov_sameyear_accum=.
03     - mata:corr_sameyear_accum=.
03     - mata:obs_sameyear_accum=0
03     - }
03     - else {
03       mata:cov_sameyear_accum=st_numscalar("`cov_sameyear'")
03       mata:corr_sameyear_accum=st_numscalar("`corr_sameyear'")
03       mata:obs_sameyear_accum=st_numscalar("`obs_sameyear'")
03       }
03     - }
03     - else {
03       mata:cov_lag_accum= rightAppendMatrices(cov_lag_accum,CC[.,1])
03       mata:corr_lag_accum= rightAppendMatrices(corr_lag_accum,CC[.,2])
03       mata:obs_lag_accum= rightAppendMatrices(obs_lag_accum,CC[.,3])
03       mata:cov_se_lag_accum= rightAppendMatrices(cov_se_lag_accum,CC[.,4])
03       mata:var_total_accum= var_total_accum,st_numscalar("`var_total'")
03       mata:var_class_accum= var_class_accum,st_numscalar("`var_class'")
03       mata:var_ind_accum= var_ind_accum,st_numscalar("`var_ind'")
03       if (`missing_sameyear'==1) {
03       mata:cov_sameyear_accum= cov_sameyear_accum,.
03       mata:corr_sameyear_accum= corr_sameyear_accum,.
03       mata:obs_sameyear_accum= obs_sameyear_accum,.
03       }
03       else {
03       mata:cov_sameyear_accum=cov_sameyear_accum,st_numscalar("`cov_sameyear
> '")
03       mata:corr_sameyear_accum=corr_sameyear_accum,st_numscalar("`corr_samey
> ear'")
03       mata:obs_sameyear_accum=obs_sameyear_accum,st_numscalar("`obs_sameyear
> '")
03       }
03       }
03     - sort `teacher' `year'
       = sort school_id year
03     - tempvar obs_teacher
03     - by `teacher': egen `obs_teacher'=count(`teacher')
       = by school_id: egen __00000O=count(school_id)
03     - qui gen float tv=.
03     - if "`quasiexperiment'"!="" {
       = if ""!="" {
03       qui gen float tv_2yr_l=.
03       qui gen float tv_2yr_f=.
03       qui gen float tv_ss=.
03       mata: driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", "`cl
> ass_mean'", "`weight'", "`obs_teacher'", "tv", "tv_2yr_l", "tv_2yr_f", "tv_ss
> ")
03       }
03     - else mata:driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", 
> "`class_mean'", "`weight'", "`obs_teacher'", "tv")
       = else mata:driftcalclist(vectorToStripeDiag(m), "school_id", "year", "_
> _000003", "__00000F", "__00000O", "tv")
03     - if ("`quasiexperiment'"=="") keep `teacher' `year' `by' tv
       = if (""=="") keep school_id year  tv
03     - else keep `teacher' `year' `by' tv tv_2yr_l tv_2yr_f tv_ss
       = else keep school_id year  tv tv_2yr_l tv_2yr_f tv_ss
03     - if (`firstloop'!=1) append using `"`output'"', nolabel
       = if (1!=1) append using `"/home/tmp/St192370.000002"', nolabel
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - local firstloop=0
03     - }
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if "`output_addvars'"!="" quietly {
       = if ""!="" quietly {
03       restore, preserve
03       keep `teacher' `year' `by' `output_addvars'
03       bys `teacher' `year' `by' `output_addvars': keep if _n==1
03       merge m:1 `teacher' `year' `by' using `"`output'"', nogen nolabel
03       }
03     - sort `teacher' `year' `by'
       = sort school_id year 
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabels=""
03       forvalues i=1/`by_vals' {
03       local bylabel : label `byvar' `i', strict
03       local bylabel=subinstr("`bylabel'"," ","_",.)
03       local bylabels `bylabels' _`bylabel'
03       }
03       mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_lag_acc
> um, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, cov_sa
> meyear_accum, corr_sameyear_accum, obs_sameyear_accum, tokens(st_local("bylab
> els")))
03       }
03     - else mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_la
> g_accum, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, c
> ov_sameyear_accum, corr_sameyear_accum, obs_sameyear_accum, "")
03     - if (`nooutput'!=1) qui outsheet using `"`output'_variance.csv"', comma
>  replace
       = if (1!=1) qui outsheet using `"/home/tmp/St192370.000002_variance.csv"
> ', comma replace
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if inlist("`1'","preserve","merge") {
       = if inlist("merge","preserve","merge") {
03     - restore
03     - if (`merge_resid'==1) {
       = if (1==1) {
03     - if ("`byvar'"!="") qui keep if missing(`teacher',`year',`class',`byvar
> ')
       = if (""!="") qui keep if missing(school_id,year,school_id,)
03     - else qui keep if missing(`teacher',`year',`class')
       = else qui keep if missing(school_id,year,school_id)
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - append using `"`resid_data_`l''"', nolabel
       = append using `"/home/tmp/St192370.000004"', nolabel
03     - }
03     - }
03     - if (`merge_tv'==1) qui merge m:1 `teacher' `year' `by' `output_addvars
> ' using `"`output'"', nogen nolabel
       = if (1==1) qui merge m:1 school_id year   using `"/home/tmp/St192370.00
> 0002"', nogen nolabel
03     - }
03     - else {
03       restore, not
03       if ("`data'"=="tv") use `"`output'"', clear
03       }
       ------------------------------------------------------------ end vam ---
02   - rename tv va_cfr_g11_`subject'
     = rename tv va_cfr_g11_ela
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename score_r sbac_g11_`subject'_r
     = rename score_r sbac_g11_ela_r
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_ela_r va_cfr_g11_ela, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_ela_r va_cfr_g11_ela, cluster(school_id)

Linear regression                               Number of obs     =    675,586
                                                F(1, 1275)        =    2110.09
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0409
                                                Root MSE          =     .55538

                          (Std. err. adjusted for 1,276 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_e~r | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~a |   .9819345   .0213763    45.94   0.000      .939998    1.023871
       _cons |  -.0002035   .0012535    -0.16   0.871    -.0026626    .0022555
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr
> _g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/spec_test_va_cfr_g11_ela_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_v
> a_cfr_g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/spec_test_va_cfr_g11_ela_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/spec_test_va_cfr_g11_ela_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - label var va_cfr_g11_`subject' "`subject' VA with family FE without TFX"
     = label var va_cfr_g11_ela "ela VA with family FE without TFX"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var va_cfr_g11_ela "ela VA with family FE 
> without TFX"
03     - }
       ---------------------------------------------------------- end label ---
02   - label var sbac_g11_`subject'_r "`subject' score residual with family FE 
> without TFX"
     = label var sbac_g11_ela_r "ela score residual with family FE without TFX"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var sbac_g11_ela_r "ela score residual wit
> h family FE without TFX"
03     - }
       ---------------------------------------------------------- end label ---
02   - gen sbac_g11_`subject'_r_d = sbac_g11_`subject'_r_nosibctrl - sbac_g11_`
> subject'_r
     = gen sbac_g11_ela_r_d = sbac_g11_ela_r_nosibctrl - sbac_g11_ela_r
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_temp
     = rename va_cfr_g11_ela va_cfr_g11_ela_temp
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename va_cfr_g11_`subject'_nosibctrl va_cfr_g11_`subject'
     = rename va_cfr_g11_ela_nosibctrl va_cfr_g11_ela
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r_d va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_ela_r_d va_cfr_g11_ela, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_ela_r_d va_cfr_g11_ela, cluster(school_id)

Linear regression                               Number of obs     =    675,586
                                                F(1, 1275)        =      20.94
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0001
                                                Root MSE          =     .01005

                          (Std. err. adjusted for 1,276 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_e~d | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~a |   .0010195   .0002228     4.58   0.000     .0005824    .0014566
       _cons |  -7.85e-07   .0000279    -0.03   0.978    -.0000556     .000054
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/fb_test_va_cfr_g
> 11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/fb_test_va_cfr_g11_ela_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/fb_test_va_
> cfr_g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/fb_test_va_cfr_g11_ela_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/fb_test_va_cfr_g11_ela_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
     = rename va_cfr_g11_ela va_cfr_g11_ela_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename va_cfr_g11_`subject'_temp va_cfr_g11_`subject'
     = rename va_cfr_g11_ela_temp va_cfr_g11_ela
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - collapse (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_`subject' = touse_g
> 11_`subject' if sibling_full_sample == 1 & sibling_out_sample == 1 , by(schoo
> l_id cdscode grade year)
     = collapse (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_ela = touse_g11_ela
>  if sibling_full_sample == 1 & sibling_out_sample == 1 , by(school_id cdscode
>  grade year)
       ----------------------------------------------------- begin collapse ---
03     - version 8, missing
03     - if _caller() < 5 {
03       collaps4 `0'
03       exit
03       }
03     - collapse_17 `0'
       = collapse_17 (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_ela = touse_g1
> 1_ela if sibling_full_sample == 1 & sibling_out_sample == 1 , by(school_id cd
> scode grade year)
03     - if "`col17_graphbar'" != "" {
       = if "" != "" {
03       c_local `col17_graphbar' "``col17_graphbar''"
03       }
       ------------------------------------------------------- end collapse ---
02   - save $projdir/dta/common_core_va/test_score_va/va_g11_`subject'_sibling.
> dta, replace
     = save /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_core_v
> a/test_score_va/va_g11_ela_sibling.dta, replace
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_core_va/test
    > _score_va/va_g11_ela_sibling.dta saved
02   - save $vaprojdir/data/sibling_va/test_score_va/va_g11_`subject'_sibling.d
> ta, replace
     = save /home/research/ca_ed_lab/projects/common_core_va/data/sibling_va/te
> st_score_va/va_g11_ela_sibling.dta, replace
file
    /home/research/ca_ed_lab/projects/common_core_va/data/sibling_va/test_sco
    > re_va/va_g11_ela_sibling.dta saved
02   - }
02   - use `va_g11_sibling_dataset' if touse_g11_`subject'==1 & sibling_out_sam
> ple == 1, clear
     = use /home/tmp/St192370.000001 if touse_g11_math==1 & sibling_out_sample 
> == 1, clear
(CST/SBAC Student Test Score Samples)
02   - vam sbac_`subject'_z_score , teacher(school_id) year(year) class(school_
> id) controls( i.year `school_controls' `demographic_controls' `ela_score_cont
> rols' `math_score_controls' ) data(merge tv score_r) driftlimit(`drift_limit'
> ) estimates($vaprojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`subjec
> t'_nosibctrl.ster, replace)
     = vam sbac_math_z_score , teacher(school_id) year(year) class(school_id) c
> ontrols( i.year  age         i.male         i.eth_asian i.eth_hispanic i.eth_
> black i.eth_other         i.econ_disadvantage         i.limited_eng_prof     
>     i.disabled i.year#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_
> z_score) i.year#(c.prior_math_z_score##c.prior_math_z_score##c.prior_math_z_s
> core) ) data(merge tv score_r) driftlimit(2) estimates(/home/research/ca_ed_l
> ab/projects/common_core_va/estimates/sibling_va/test_score_va/vam_cfr_g11_mat
> h_nosibctrl.ster, replace)
       ---------------------------------------------------------- begin vam ---
03     - version 10.1
03     - set more off
03     - syntax varname(ts fv) [aweight/], teacher(varname) year(varname) class
> (varname) [ by(varlist) controls(varlist ts fv) absorb(varname) tfx_resid(var
> name) data(string) output(string) output_addvars(varlist) driftlimit(integer 
> -1) QUASIexperiment CONStant noseed varclasszero estimates(string asis)]
03     - local depvar `varlist'
       = local depvar sbac_math_z_score
03     - capture confirm variable score_r, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named score_r."
03       exit 110
03       }
03     - capture confirm variable tv, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv."
03       exit 110
03       }
03     - if ("`quasiexperiment'"!="") {
       = if (""!="") {
03       capture confirm variable tv_2yr_l, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_l."
03       exit 110
03       }
03       capture confirm variable tv_2yr_f, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_f."
03       exit 110
03       }
03       capture confirm variable tv_ss, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_ss."
03       exit 110
03       }
03       }
03     - local merge_tv=0
03     - local merge_resid=0
03     - if ("`data'"=="") local data="preserve"
       = if ("merge tv score_r"=="") local data="preserve"
03     - else {
03     - if !inlist("`data'","preserve","tv","merge tv","merge score_r","merge 
> tv score_r","merge score_r tv","variance") {
       = if !inlist("merge tv score_r","preserve","tv","merge tv","merge score_
> r","merge tv score_r","merge score_r tv","variance") {
03       di as error "Not a valid argument for data. Choose either 'preserve', 
> 'tv', 'merge [tv AND/OR score_r]', or 'variance'."
03       exit 198
03       }
03     - else {
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if ("`1'")=="merge" {
       = if ("merge")=="merge" {
03     - if ("`2'"=="tv") | ("`3'"=="tv") local merge_tv=1
       = if ("tv"=="tv") | ("score_r"=="tv") local merge_tv=1
03     - if ("`2'"=="score_r") | ("`3'"=="score_r") local merge_resid=1
       = if ("tv"=="score_r") | ("score_r"=="score_r") local merge_resid=1
03     - }
03     - }
03     - }
03     - if "`tfx_resid'"!="" & "`absorb'"!="" {
       = if ""!="" & ""!="" {
03       di as error "Cannot specify an absorb variable and a tfx_resid variabl
> e simultaneously."
03       exit 198
03       }
03     - if `"`output'"'=="" {
       = if `""'=="" {
03     - tempfile output
03     - local nooutput=1
03     - }
03     - else local nooutput=0
03     - if ("`by'"!="") {
       = if (""!="") {
03       tempvar byvar
03       egen `byvar'=group(`by'), label
03       sum `byvar', meanonly
03       local by_vals=`r(max)'
03       }
03     - else local by_vals=1
03     - if "`weight'"!="" {
       = if ""!="" {
03       local ind_weight "`weight'"
03       macro drop _weight
03       local ind_exp "`exp'"
03       macro drop _exp
03       local times_exp "* `exp'"
03       }
03     - preserve
03     - local firstloop=1
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - if (`firstloop'!=1) restore, preserve
       = if (1!=1) restore, preserve
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabel : label `byvar' `l', strict
03       di "{bf:-> by variables:} `by' = `bylabel'"
03       }
03     - qui drop if missing(`teacher',`year',`class')
       = qui drop if missing(school_id,year,school_id)
03     - if ("`by'"!="") qui keep if `byvar'==`l'
       = if (""!="") qui keep if ==1
03     - if "`absorb'"!="" | "`tfx_resid'"!="" {
       = if ""!="" | ""!="" {
03       if "`ind_weight'"=="" {
03       noisily areg `depvar' `controls' , absorb(`absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       else if "`ind_weight'"!="" {
03       noisily areg `depvar' `controls' [`ind_weight' = `ind_exp'] , absorb(`
> absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       }
03     - else {
03     - if "`ind_weight'"=="" {
       = if ""=="" {
03     - version 11 : noisily reg `depvar' `controls'
       = version 11 : noisily reg sbac_math_z_score i.year age i.male i.eth_asi
> an i.eth_hispanic i.eth_black i.eth_other i.econ_disadvantage i.limited_eng_p
> rof i.disabled i.year#c.prior_ela_z_score i.year#c.prior_ela_z_score#c.prior_
> ela_z_score i.year#c.prior_ela_z_score#c.prior_ela_z_score#c.prior_ela_z_scor
> e i.year#c.prior_math_z_score i.year#c.prior_math_z_score#c.prior_math_z_scor
> e i.year#c.prior_math_z_score#c.prior_math_z_score#c.prior_math_z_score

      Source |       SS           df       MS      Number of obs   =   674,462
-------------+----------------------------------   F(36, 674425)   =  37012.66
       Model |  400184.449        36  11116.2347   Prob > F        =    0.0000
    Residual |  202554.093   674,425  .300335979   R-squared       =    0.6639
-------------+----------------------------------   Adj R-squared   =    0.6639
       Total |  602738.541   674,461  .893659591   Root MSE        =    .54803

------------------------------------------------------------------------------
sbac_math_~e | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |
       2016  |     .05854   .0026615    22.00   0.000     .0533236    .0637563
       2017  |   .0686921   .0026501    25.92   0.000      .063498    .0738862
       2018  |  -.0883919   .0026544   -33.30   0.000    -.0935944   -.0831894
             |
         age |  -.0003538   4.73e-06   -74.82   0.000    -.0003631   -.0003445
             |
        male |
       Male  |    .052894   .0013642    38.77   0.000     .0502202    .0555679
 1.eth_asian |   .1902327   .0021907    86.83   0.000      .185939    .1945265
1.eth_hisp~c |  -.0668171   .0018686   -35.76   0.000    -.0704794   -.0631548
 1.eth_black |  -.1697084   .0036767   -46.16   0.000    -.1769147   -.1625022
 1.eth_other |   .0057796    .004072     1.42   0.156    -.0022015    .0137606
             |
econ_disad~e |
Economic ..  |  -.0650642   .0015838   -41.08   0.000    -.0681685   -.0619599
             |
limited_en~f |
Limited E..  |  -.0853626   .0035675   -23.93   0.000    -.0923547   -.0783705
             |
    disabled |
   Disabled  |  -.1559783   .0036066   -43.25   0.000    -.1630471   -.1489095
             |
        year#|
          c. |
prior_ela_~e |
       2015  |   .3460793   .0027089   127.76   0.000     .3407699    .3513887
       2016  |   .3328641    .002639   126.13   0.000     .3276918    .3380365
       2017  |   .3021307   .0027744   108.90   0.000     .2966929    .3075685
       2018  |   .1877411   .0033763    55.61   0.000     .1811236    .1943586
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |   .0241664   .0014326    16.87   0.000     .0213586    .0269742
       2016  |   .0056111    .001441     3.89   0.000     .0027867    .0084354
       2017  |   .0197895   .0014526    13.62   0.000     .0169424    .0226366
       2018  |  -.0001293    .001457    -0.09   0.929     -.002985    .0027264
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |  -.0156205   .0006613   -23.62   0.000    -.0169166   -.0143244
       2016  |  -.0104033   .0006037   -17.23   0.000    -.0115865   -.0092201
       2017  |  -.0133383   .0005876   -22.70   0.000      -.01449   -.0121866
       2018  |  -.0065435   .0009548    -6.85   0.000    -.0084149   -.0046721
             |
        year#|
          c. |
prior_math~e |
       2015  |   .4873828   .0026899   181.19   0.000     .4821107    .4926549
       2016  |    .509296   .0027366   186.10   0.000     .5039323    .5146596
       2017  |    .532375   .0028544   186.51   0.000     .5267805    .5379695
       2018  |   .6711163   .0034189   196.29   0.000     .6644153    .6778174
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |   .0240714    .001793    13.43   0.000     .0205572    .0275857
       2016  |   .0046303   .0017438     2.66   0.008     .0012126     .008048
       2017  |  -.0006828   .0017864    -0.38   0.702    -.0041841    .0028184
       2018  |   .0777338   .0014196    54.76   0.000     .0749514    .0805163
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0227705   .0007368   -30.90   0.000    -.0242147   -.0213264
       2016  |  -.0202824   .0007792   -26.03   0.000    -.0218095   -.0187552
       2017  |  -.0213844   .0007705   -27.76   0.000    -.0228945   -.0198743
       2018  |  -.0265723   .0009485   -28.01   0.000    -.0284315   -.0247132
             |
       _cons |   2.248523   .0289643    77.63   0.000     2.191754    2.305292
------------------------------------------------------------------------------
03     - if `"`estimates'"'!="" {
       = if `"/home/research/ca_ed_lab/projects/common_core_va/estimates/siblin
> g_va/test_score_va/vam_cfr_g11_math_nosibctrl.ster, replace"'!="" {
03     - estimates save `estimates'
       = estimates save /home/research/ca_ed_lab/projects/common_core_va/estima
> tes/sibling_va/test_score_va/vam_cfr_g11_math_nosibctrl.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/vam_cfr_g11_math_nosibctrl.ster saved
03     - }
03     - }
03     - else if "`ind_weight'"!="" {
       = else if ""!="" {
03       version 11 : noisily reg `depvar' `controls' [`ind_weight' = `ind_exp'
> ]
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03     - }
03     - if "`tfx_resid'"=="" {
       = if ""=="" {
03     - qui predict score_r if e(sample),r
03     - if "`constant'"!="" {
       = if ""!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03     - }
03     - else {
03       qui predict score_r if e(sample), dresiduals
03       if "`constant'"!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03       }
03     - if "`ind_weight'"!="" {
       = if ""!="" {
03       tempvar tot_ind_weight class_ind_weight
03       qui egen `tot_ind_weight' = total(`ind_exp') if !mi(score_r)
03       qui egen `class_ind_weight' = total(`ind_exp') if !mi(score_r), by(`te
> acher' `year' `group' `class')
03       }
03     - if `merge_resid'==1 {
       = if 1==1 {
03     - tempfile resid_data_`l'
       = tempfile resid_data_1
03     - qui save `"`resid_data_`l''"', replace
       = qui save `"/home/tmp/St192370.000004"', replace
03     - }
03     - tempname num_obs num_par
03     - scalar `num_obs' = e(N)
       = scalar __000000 = e(N)
03     - if "`absorb'"!="" {
       = if ""!="" {
03       scalar `num_par' = e(df_m) + e(df_a) + 1
03       }
03     - else {
03     - scalar `num_par' = e(df_m) + 1
       = scalar __000001 = e(df_m) + 1
03     - }
03     - tempvar n_tested
03     - qui bys `teacher' `year' `group' `class': egen `n_tested' = count(scor
> e_r)
       = qui bys school_id year  school_id: egen __000002 = count(score_r)
03     - tempvar class_mean index
03     - qui by `teacher' `year' `group' `class': egen `class_mean' = mean(scor
> e_r)
       = qui by school_id year  school_id: egen __000003 = mean(score_r)
03     - qui by `teacher' `year' `group' `class': g `index' = _n
       = qui by school_id year  school_id: g __000004 = _n
03     - tempname var_total
03     - qui sum score_r
03     - scalar `var_total' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_par'))
       = scalar __000005 = r(Var)*((__000000 - 1)/(__000000 - __000001))
03     - tempname num_class var_ind var_class
03     - tempvar individual_dev_from_class
03     - qui gen `individual_dev_from_class' = score_r - `class_mean'
       = qui gen __000009 = score_r - __000003
03     - qui count if `index'==1 & `n_tested'!=0
       = qui count if __000004==1 & __000002!=0
03     - scalar `num_class' = r(N)
       = scalar __000006 = r(N)
03     - qui sum `individual_dev_from_class'
       = qui sum __000009
03     - scalar `var_ind' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_class' - 
> `num_par' + 1))
       = scalar __000007 = r(Var)*((__000000 - 1)/(__000000 - __000006 - __0000
> 01 + 1))
03     - qui by `teacher' `year' `group' `class': keep if _n==1
       = qui by school_id year  school_id: keep if _n==1
03     - if "`seed'"=="" {
       = if ""=="" {
03     - set seed 9827496
03     - }
03     - tempvar rand classnum
03     - g `rand'=uniform()
       = g __00000A=uniform()
03     - bys `teacher' `year' (`rand'): gen `classnum'=_n
       = bys school_id year (__00000A): gen __00000B=_n
03     - tempname cov_sameyear corr_sameyear obs_sameyear
03     - qui sum `classnum'
       = qui sum __00000B
03     - if (r(max)==1) {
03     - local missing_sameyear=1
03     - scalar `cov_sameyear'=0
       = scalar __00000C=0
03     - }
03     - else {
03       local missing_sameyear=0
03       tempvar identifier
03       egen `identifier'=group(`teacher' `year')
03       qui tsset `identifier' `classnum'
03       qui corr `class_mean' f.`class_mean' [aw=`n_tested'+f.`n_tested'], cov
03       scalar `cov_sameyear'=r(cov_12)
03       scalar `corr_sameyear'=r(cov_12) / ( sqrt(r(Var_1)) * sqrt(r(Var_2)) )
03       scalar `obs_sameyear'=r(N)
03       }
03     - scalar `var_class' = `var_total' - `var_ind' - `cov_sameyear'
       = scalar __000008 = __000005 - __000007 - __00000C
03     - if (`var_class'<0) {
       = if (__000008<0) {
03       if ("`varclasszero'"!="varclasszero") {
03       di as error "Note: var_class has been computed as being less than 0."
03       di "var_class is defined as = var_total - var_ind - cov_sameyear."
03       di "Computed variances: var_total, var_ind, cov_sameyear, var_class"
03       di `var_total',`var_ind',`cov_sameyear',`var_class'
03       di "This negative variance can occur because cov_sameyear is calculate
> d using only the subsample of observations that teach multiple classes per ye
> ar (in the same by-group)."
03       }
03       else if ("`varclasszero'"=="varclasszero") {
03       scalar `var_class' = 0
03       }
03       }
03     - tempvar weight
03     - qui g `weight'=1/(`var_class' + `var_ind'/`n_tested')
       = qui g __00000F=1/(__000008 + __000007/__000002)
03     - tempvar excess_weight
03     - qui gen `excess_weight'=(missing(`weight'))
       = qui gen __00000G=(missing(__00000F))
03     - qui replace `weight'=1 if missing(`weight')
       = qui replace __00000F=1 if missing(__00000F)
03     - collapse (mean) `class_mean' (rawsum) `weight' `n_tested' `excess_weig
> ht' [aw=`weight'], by(`teacher' `year' `by') fast
       = collapse (mean) __000003 (rawsum) __00000F __000002 __00000G [aw=__000
> 00F], by(school_id year ) fast
03     - qui replace `weight'=`weight'-`excess_weight'
       = qui replace __00000F=__00000F-__00000G
03     - qui tsset `teacher' `year'
       = qui tsset school_id year
03     - tempvar minyear maxyear diff validyear minvalidyear maxvalidyear diffv
> alid
03     - qui bys `teacher': egen `minyear'=min(`year')
       = qui bys school_id: egen __00000H=min(year)
03     - qui by `teacher': egen `maxyear'=max(`year')
       = qui by school_id: egen __00000I=max(year)
03     - qui g `diff'=`maxyear'-`minyear'
       = qui g __00000J=__00000I-__00000H
03     - qui sum `diff'
       = qui sum __00000J
03     - local maxspan=`r(max)'
       = local maxspan=3
03     - qui gen `validyear'=`year' if !missing(`class_mean')
       = qui gen __00000K=year if !missing(__000003)
03     - qui by `teacher': egen `minvalidyear'=min(`validyear')
       = qui by school_id: egen __00000L=min(__00000K)
03     - qui by `teacher': egen `maxvalidyear'=max(`validyear')
       = qui by school_id: egen __00000M=max(__00000K)
03     - qui g `diffvalid'=`maxvalidyear'-`minvalidyear'
       = qui g __00000N=__00000M-__00000L
03     - qui sum `diffvalid'
       = qui sum __00000N
03     - local maxscorespan=`r(max)'
       = local maxscorespan=3
03     - if (`maxscorespan'<`maxspan') & (`driftlimit'<=0) {
       = if (3<3) & (2<=0) {
03       di as error _n "error: The maximum lags of teacher data is `maxspan', 
> but the maximum lags of teacher data with class scores is `maxscorespan'."
03       di as error "       You must either set driftlimit() <= `maxscorespan'
> , or drop observations so that the spans are no longer mismatched."
03       exit 499
03       }
03     - if (`driftlimit'>`maxscorespan') {
       = if (2>3) {
03       di as error "error: driftlimit(`driftlimit') was specified, which is g
> reater than the number of lags (`maxscorespan') in the data."
03       exit 499
03       }
03     - mata:CC=compute_cov_corr("`class_mean'","`n_tested'",`maxscorespan',"`
> teacher'")
       = mata:CC=compute_cov_corr("__000003","__000002",3,"school_id")
03     - if (`driftlimit'>0) mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyea
> r'"),`maxspan',`driftlimit')
       = if (2>0) mata:m=create_m(CC[.,1],st_numscalar("__00000C"),3,2)
03     - else mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyear'"))
       = else mata:m=create_m(CC[.,1],st_numscalar("__00000C"))
03     - di "Standard deviations: total, classes, students, teachers same year"
Standard deviations: total, classes, students, teachers same year
03     - if (`missing_sameyear'==0) di sqrt(`var_total'),sqrt(`var_class'),sqrt
> (`var_ind'),sqrt(`cov_sameyear')
       = if (1==0) di sqrt(__000005),sqrt(__000008),sqrt(__000007),sqrt(__00000
> C)
03     - else di sqrt(`var_total'),sqrt(`var_class'),sqrt(`var_ind'),.
       = else di sqrt(__000005),sqrt(__000008),sqrt(__000007),.
.54802918 .16390201 .52294561 .
03     - di "Covariances (left), correlations (middle), observations (right).  
> Row i indicates the relation between year t and t+i:"
Covariances (left), correlations (middle), observations (right).  Row i indicat
> es the relation between year t and t+i:
03     - mata:CC[.,1..3]
                 1             2             3
    +-------------------------------------------+
  1 |  .0194658737   .6783396224          3534  |
  2 |  .0154052278   .5463185172          2296  |
  3 |  .0098236127   .3639788075          1105  |
    +-------------------------------------------+
03     - if (`driftlimit'>0) {
       = if (2>0) {
03     - di "Drift limit specified:"
Drift limit specified:
03     - di `driftlimit'
       = di 2
2
03     - di "Covariances used for VA computations:"
Covariances used for VA computations:
03     - mata: m[2..length(m)]'
                 1
    +---------------+
  1 |  .0194658737  |
  2 |  .0154052278  |
  3 |  .0154052278  |
    +---------------+
03     - }
03     - mata:check_m_nomissing(m)
03     - if (`firstloop'==1) {
       = if (1==1) {
03     - mata:cov_lag_accum= CC[.,1]
03     - mata:corr_lag_accum= CC[.,2]
03     - mata:obs_lag_accum= CC[.,3]
03     - mata:cov_se_lag_accum= CC[.,4]
03     - mata:var_total_accum= st_numscalar("`var_total'")
       = mata:var_total_accum= st_numscalar("__000005")
03     - mata:var_class_accum= st_numscalar("`var_class'")
       = mata:var_class_accum= st_numscalar("__000008")
03     - mata:var_ind_accum= st_numscalar("`var_ind'")
       = mata:var_ind_accum= st_numscalar("__000007")
03     - if (`missing_sameyear'==1) {
       = if (1==1) {
03     - mata:cov_sameyear_accum=.
03     - mata:corr_sameyear_accum=.
03     - mata:obs_sameyear_accum=0
03     - }
03     - else {
03       mata:cov_sameyear_accum=st_numscalar("`cov_sameyear'")
03       mata:corr_sameyear_accum=st_numscalar("`corr_sameyear'")
03       mata:obs_sameyear_accum=st_numscalar("`obs_sameyear'")
03       }
03     - }
03     - else {
03       mata:cov_lag_accum= rightAppendMatrices(cov_lag_accum,CC[.,1])
03       mata:corr_lag_accum= rightAppendMatrices(corr_lag_accum,CC[.,2])
03       mata:obs_lag_accum= rightAppendMatrices(obs_lag_accum,CC[.,3])
03       mata:cov_se_lag_accum= rightAppendMatrices(cov_se_lag_accum,CC[.,4])
03       mata:var_total_accum= var_total_accum,st_numscalar("`var_total'")
03       mata:var_class_accum= var_class_accum,st_numscalar("`var_class'")
03       mata:var_ind_accum= var_ind_accum,st_numscalar("`var_ind'")
03       if (`missing_sameyear'==1) {
03       mata:cov_sameyear_accum= cov_sameyear_accum,.
03       mata:corr_sameyear_accum= corr_sameyear_accum,.
03       mata:obs_sameyear_accum= obs_sameyear_accum,.
03       }
03       else {
03       mata:cov_sameyear_accum=cov_sameyear_accum,st_numscalar("`cov_sameyear
> '")
03       mata:corr_sameyear_accum=corr_sameyear_accum,st_numscalar("`corr_samey
> ear'")
03       mata:obs_sameyear_accum=obs_sameyear_accum,st_numscalar("`obs_sameyear
> '")
03       }
03       }
03     - sort `teacher' `year'
       = sort school_id year
03     - tempvar obs_teacher
03     - by `teacher': egen `obs_teacher'=count(`teacher')
       = by school_id: egen __00000O=count(school_id)
03     - qui gen float tv=.
03     - if "`quasiexperiment'"!="" {
       = if ""!="" {
03       qui gen float tv_2yr_l=.
03       qui gen float tv_2yr_f=.
03       qui gen float tv_ss=.
03       mata: driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", "`cl
> ass_mean'", "`weight'", "`obs_teacher'", "tv", "tv_2yr_l", "tv_2yr_f", "tv_ss
> ")
03       }
03     - else mata:driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", 
> "`class_mean'", "`weight'", "`obs_teacher'", "tv")
       = else mata:driftcalclist(vectorToStripeDiag(m), "school_id", "year", "_
> _000003", "__00000F", "__00000O", "tv")
03     - if ("`quasiexperiment'"=="") keep `teacher' `year' `by' tv
       = if (""=="") keep school_id year  tv
03     - else keep `teacher' `year' `by' tv tv_2yr_l tv_2yr_f tv_ss
       = else keep school_id year  tv tv_2yr_l tv_2yr_f tv_ss
03     - if (`firstloop'!=1) append using `"`output'"', nolabel
       = if (1!=1) append using `"/home/tmp/St192370.000002"', nolabel
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - local firstloop=0
03     - }
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if "`output_addvars'"!="" quietly {
       = if ""!="" quietly {
03       restore, preserve
03       keep `teacher' `year' `by' `output_addvars'
03       bys `teacher' `year' `by' `output_addvars': keep if _n==1
03       merge m:1 `teacher' `year' `by' using `"`output'"', nogen nolabel
03       }
03     - sort `teacher' `year' `by'
       = sort school_id year 
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabels=""
03       forvalues i=1/`by_vals' {
03       local bylabel : label `byvar' `i', strict
03       local bylabel=subinstr("`bylabel'"," ","_",.)
03       local bylabels `bylabels' _`bylabel'
03       }
03       mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_lag_acc
> um, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, cov_sa
> meyear_accum, corr_sameyear_accum, obs_sameyear_accum, tokens(st_local("bylab
> els")))
03       }
03     - else mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_la
> g_accum, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, c
> ov_sameyear_accum, corr_sameyear_accum, obs_sameyear_accum, "")
03     - if (`nooutput'!=1) qui outsheet using `"`output'_variance.csv"', comma
>  replace
       = if (1!=1) qui outsheet using `"/home/tmp/St192370.000002_variance.csv"
> ', comma replace
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if inlist("`1'","preserve","merge") {
       = if inlist("merge","preserve","merge") {
03     - restore
03     - if (`merge_resid'==1) {
       = if (1==1) {
03     - if ("`byvar'"!="") qui keep if missing(`teacher',`year',`class',`byvar
> ')
       = if (""!="") qui keep if missing(school_id,year,school_id,)
03     - else qui keep if missing(`teacher',`year',`class')
       = else qui keep if missing(school_id,year,school_id)
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - append using `"`resid_data_`l''"', nolabel
       = append using `"/home/tmp/St192370.000004"', nolabel
03     - }
03     - }
03     - if (`merge_tv'==1) qui merge m:1 `teacher' `year' `by' `output_addvars
> ' using `"`output'"', nogen nolabel
       = if (1==1) qui merge m:1 school_id year   using `"/home/tmp/St192370.00
> 0002"', nogen nolabel
03     - }
03     - else {
03       restore, not
03       if ("`data'"=="tv") use `"`output'"', clear
03       }
       ------------------------------------------------------------ end vam ---
02   - rename tv va_cfr_g11_`subject'
     = rename tv va_cfr_g11_math
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename score_r sbac_g11_`subject'_r
     = rename score_r sbac_g11_math_r
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_math_r va_cfr_g11_math, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_math_r va_cfr_g11_math, cluster(school_id)

Linear regression                               Number of obs     =    672,870
                                                F(1, 1273)        =    4237.24
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0479
                                                Root MSE          =     .53469

                          (Std. err. adjusted for 1,274 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_m~r | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~h |   .9690228   .0148865    65.09   0.000      .939818    .9982275
       _cons |   -.000864   .0008938    -0.97   0.334    -.0026175    .0008894
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr
> _g11_`subject'_sibling_nocontrol.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, re
> place
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, replac
> e
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, repl
> ace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_v
> a_cfr_g11_`subject'_sibling_nocontrol.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, 
> replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, repl
> ace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/spec_test_va_cfr_g11_math_sibling_nocontrol.ster, re
> place
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
     = rename va_cfr_g11_math va_cfr_g11_math_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename sbac_g11_`subject'_r sbac_g11_`subject'_r_nosibctrl
     = rename sbac_g11_math_r sbac_g11_math_r_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - label var va_cfr_g11_`subject'_nosibctrl "`subject' VA with family FE wi
> thout TFX without sibling control"
     = label var va_cfr_g11_math_nosibctrl "math VA with family FE without TFX 
> without sibling control"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var va_cfr_g11_math_nosibctrl "math VA wit
> h family FE without TFX without sibling control"
03     - }
       ---------------------------------------------------------- end label ---
02   - label var sbac_g11_`subject'_r_nosibctrl "`subject' score residual with 
> family FE without TFX without sibling control"
     = label var sbac_g11_math_r_nosibctrl "math score residual with family FE 
> without TFX without sibling control"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var sbac_g11_math_r_nosibctrl "math score 
> residual with family FE without TFX without sibling control"
03     - }
       ---------------------------------------------------------- end label ---
02   - vam sbac_`subject'_z_score , teacher(school_id) year(year) class(school_
> id) controls( i.year i.has_older_sibling_enr_2year i.has_older_sibling_enr_4y
> ear `school_controls' `demographic_controls' `ela_score_controls' `math_score
> _controls' ) data(merge tv score_r) driftlimit(`drift_limit') estimates($vapr
> ojdir/estimates/sibling_va/test_score_va/vam_cfr_g11_`subject'.ster, replace)
     = vam sbac_math_z_score , teacher(school_id) year(year) class(school_id) c
> ontrols( i.year i.has_older_sibling_enr_2year i.has_older_sibling_enr_4year  
> age         i.male         i.eth_asian i.eth_hispanic i.eth_black i.eth_other
>          i.econ_disadvantage         i.limited_eng_prof         i.disabled i.
> year#(c.prior_ela_z_score##c.prior_ela_z_score##c.prior_ela_z_score) i.year#(
> c.prior_math_z_score##c.prior_math_z_score##c.prior_math_z_score) ) data(merg
> e tv score_r) driftlimit(2) estimates(/home/research/ca_ed_lab/projects/commo
> n_core_va/estimates/sibling_va/test_score_va/vam_cfr_g11_math.ster, replace)
       ---------------------------------------------------------- begin vam ---
03     - version 10.1
03     - set more off
03     - syntax varname(ts fv) [aweight/], teacher(varname) year(varname) class
> (varname) [ by(varlist) controls(varlist ts fv) absorb(varname) tfx_resid(var
> name) data(string) output(string) output_addvars(varlist) driftlimit(integer 
> -1) QUASIexperiment CONStant noseed varclasszero estimates(string asis)]
03     - local depvar `varlist'
       = local depvar sbac_math_z_score
03     - capture confirm variable score_r, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named score_r."
03       exit 110
03       }
03     - capture confirm variable tv, exact
03     - if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv."
03       exit 110
03       }
03     - if ("`quasiexperiment'"!="") {
       = if (""!="") {
03       capture confirm variable tv_2yr_l, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_l."
03       exit 110
03       }
03       capture confirm variable tv_2yr_f, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_2yr_f."
03       exit 110
03       }
03       capture confirm variable tv_ss, exact
03       if (_rc==0) {
03       di as error "The dataset loaded in memory when vam is run cannot have 
> a variable named tv_ss."
03       exit 110
03       }
03       }
03     - local merge_tv=0
03     - local merge_resid=0
03     - if ("`data'"=="") local data="preserve"
       = if ("merge tv score_r"=="") local data="preserve"
03     - else {
03     - if !inlist("`data'","preserve","tv","merge tv","merge score_r","merge 
> tv score_r","merge score_r tv","variance") {
       = if !inlist("merge tv score_r","preserve","tv","merge tv","merge score_
> r","merge tv score_r","merge score_r tv","variance") {
03       di as error "Not a valid argument for data. Choose either 'preserve', 
> 'tv', 'merge [tv AND/OR score_r]', or 'variance'."
03       exit 198
03       }
03     - else {
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if ("`1'")=="merge" {
       = if ("merge")=="merge" {
03     - if ("`2'"=="tv") | ("`3'"=="tv") local merge_tv=1
       = if ("tv"=="tv") | ("score_r"=="tv") local merge_tv=1
03     - if ("`2'"=="score_r") | ("`3'"=="score_r") local merge_resid=1
       = if ("tv"=="score_r") | ("score_r"=="score_r") local merge_resid=1
03     - }
03     - }
03     - }
03     - if "`tfx_resid'"!="" & "`absorb'"!="" {
       = if ""!="" & ""!="" {
03       di as error "Cannot specify an absorb variable and a tfx_resid variabl
> e simultaneously."
03       exit 198
03       }
03     - if `"`output'"'=="" {
       = if `""'=="" {
03     - tempfile output
03     - local nooutput=1
03     - }
03     - else local nooutput=0
03     - if ("`by'"!="") {
       = if (""!="") {
03       tempvar byvar
03       egen `byvar'=group(`by'), label
03       sum `byvar', meanonly
03       local by_vals=`r(max)'
03       }
03     - else local by_vals=1
03     - if "`weight'"!="" {
       = if ""!="" {
03       local ind_weight "`weight'"
03       macro drop _weight
03       local ind_exp "`exp'"
03       macro drop _exp
03       local times_exp "* `exp'"
03       }
03     - preserve
03     - local firstloop=1
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - if (`firstloop'!=1) restore, preserve
       = if (1!=1) restore, preserve
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabel : label `byvar' `l', strict
03       di "{bf:-> by variables:} `by' = `bylabel'"
03       }
03     - qui drop if missing(`teacher',`year',`class')
       = qui drop if missing(school_id,year,school_id)
03     - if ("`by'"!="") qui keep if `byvar'==`l'
       = if (""!="") qui keep if ==1
03     - if "`absorb'"!="" | "`tfx_resid'"!="" {
       = if ""!="" | ""!="" {
03       if "`ind_weight'"=="" {
03       noisily areg `depvar' `controls' , absorb(`absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       else if "`ind_weight'"!="" {
03       noisily areg `depvar' `controls' [`ind_weight' = `ind_exp'] , absorb(`
> absorb'`tfx_resid')
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03       }
03     - else {
03     - if "`ind_weight'"=="" {
       = if ""=="" {
03     - version 11 : noisily reg `depvar' `controls'
       = version 11 : noisily reg sbac_math_z_score i.year i.has_older_sibling_
> enr_2year i.has_older_sibling_enr_4year age i.male i.eth_asian i.eth_hispanic
>  i.eth_black i.eth_other i.econ_disadvantage i.limited_eng_prof i.disabled i.
> year#c.prior_ela_z_score i.year#c.prior_ela_z_score#c.prior_ela_z_score i.yea
> r#c.prior_ela_z_score#c.prior_ela_z_score#c.prior_ela_z_score i.year#c.prior_
> math_z_score i.year#c.prior_math_z_score#c.prior_math_z_score i.year#c.prior_
> math_z_score#c.prior_math_z_score#c.prior_math_z_score

      Source |       SS           df       MS      Number of obs   =   674,462
-------------+----------------------------------   F(38, 674423)   =  35112.12
       Model |   400366.82        38   10535.969   Prob > F        =    0.0000
    Residual |  202371.721   674,423  .300066459   R-squared       =    0.6642
-------------+----------------------------------   Adj R-squared   =    0.6642
       Total |  602738.541   674,461  .893659591   Root MSE        =    .54778

------------------------------------------------------------------------------
sbac_math_~e | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
        year |
       2016  |   .0583161   .0026605    21.92   0.000     .0531017    .0635305
       2017  |     .06815   .0026497    25.72   0.000     .0629567    .0733433
       2018  |  -.0888705   .0026551   -33.47   0.000    -.0940743   -.0836666
             |
1.has_~2year |  -.0257658    .002612    -9.86   0.000    -.0308854   -.0206463
1.has_~4year |   .0664619   .0028684    23.17   0.000       .06084    .0720837
         age |  -.0003525   4.73e-06   -74.55   0.000    -.0003617   -.0003432
             |
        male |
       Male  |   .0528537   .0013636    38.76   0.000      .050181    .0555263
 1.eth_asian |    .189382    .002191    86.44   0.000     .1850878    .1936762
1.eth_hisp~c |  -.0659531   .0018682   -35.30   0.000    -.0696147   -.0622915
 1.eth_black |  -.1696506   .0036751   -46.16   0.000    -.1768536   -.1624476
 1.eth_other |   .0063197   .0040703     1.55   0.121     -.001658    .0142973
             |
econ_disad~e |
Economic ..  |  -.0651353   .0015835   -41.13   0.000    -.0682389   -.0620317
             |
limited_en~f |
Limited E..  |  -.0851729   .0035659   -23.89   0.000     -.092162   -.0781839
             |
    disabled |
   Disabled  |   -.155758   .0036051   -43.21   0.000    -.1628239   -.1486922
             |
        year#|
          c. |
prior_ela_~e |
       2015  |   .3455483   .0027079   127.61   0.000      .340241    .3508557
       2016  |   .3323749   .0026381   125.99   0.000     .3272044    .3375454
       2017  |   .3015533   .0027736   108.72   0.000     .2961173    .3069894
       2018  |   .1869776    .003375    55.40   0.000     .1803628    .1935925
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |   .0241348    .001432    16.85   0.000     .0213282    .0269415
       2016  |    .005581   .0014404     3.87   0.000     .0027578    .0084042
       2017  |   .0198104    .001452    13.64   0.000     .0169645    .0226563
       2018  |  -.0000811   .0014564    -0.06   0.956    -.0029356    .0027734
             |
        year#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e#|
          c. |
prior_ela_~e |
       2015  |  -.0155503    .000661   -23.53   0.000    -.0168458   -.0142548
       2016  |   -.010345   .0006034   -17.14   0.000    -.0115277   -.0091623
       2017  |  -.0132864   .0005874   -22.62   0.000    -.0144376   -.0121352
       2018  |  -.0064213   .0009544    -6.73   0.000    -.0082918   -.0045507
             |
        year#|
          c. |
prior_math~e |
       2015  |   .4865136   .0026889   180.93   0.000     .4812434    .4917838
       2016  |   .5081895   .0027358   185.76   0.000     .5028275    .5135516
       2017  |   .5312935   .0028535   186.19   0.000     .5257007    .5368862
       2018  |   .6698344   .0034178   195.98   0.000     .6631356    .6765332
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |   .0240231   .0017922    13.40   0.000     .0205104    .0275359
       2016  |   .0045412    .001743     2.61   0.009      .001125    .0079574
       2017  |  -.0007193   .0017856    -0.40   0.687    -.0042191    .0027804
       2018  |   .0775742   .0014191    54.66   0.000     .0747928    .0803556
             |
        year#|
          c. |
prior_math~e#|
          c. |
prior_math~e#|
          c. |
prior_math~e |
       2015  |  -.0226939   .0007365   -30.81   0.000    -.0241375   -.0212504
       2016  |  -.0201758   .0007788   -25.90   0.000    -.0217023   -.0186493
       2017  |  -.0213052   .0007701   -27.66   0.000    -.0228146   -.0197957
       2018  |  -.0264218   .0009481   -27.87   0.000    -.0282801   -.0245634
             |
       _cons |   2.238644   .0289663    77.28   0.000     2.181871    2.295417
------------------------------------------------------------------------------
03     - if `"`estimates'"'!="" {
       = if `"/home/research/ca_ed_lab/projects/common_core_va/estimates/siblin
> g_va/test_score_va/vam_cfr_g11_math.ster, replace"'!="" {
03     - estimates save `estimates'
       = estimates save /home/research/ca_ed_lab/projects/common_core_va/estima
> tes/sibling_va/test_score_va/vam_cfr_g11_math.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/vam_cfr_g11_math.ster saved
03     - }
03     - }
03     - else if "`ind_weight'"!="" {
       = else if ""!="" {
03       version 11 : noisily reg `depvar' `controls' [`ind_weight' = `ind_exp'
> ]
03       if `"`estimates'"'!="" {
03       estimates save `estimates'
03       }
03       }
03     - }
03     - if "`tfx_resid'"=="" {
       = if ""=="" {
03     - qui predict score_r if e(sample),r
03     - if "`constant'"!="" {
       = if ""!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03     - }
03     - else {
03       qui predict score_r if e(sample), dresiduals
03       if "`constant'"!="" {
03       gen b_cons = _b[_cons] if e(sample)
03       }
03       }
03     - if "`ind_weight'"!="" {
       = if ""!="" {
03       tempvar tot_ind_weight class_ind_weight
03       qui egen `tot_ind_weight' = total(`ind_exp') if !mi(score_r)
03       qui egen `class_ind_weight' = total(`ind_exp') if !mi(score_r), by(`te
> acher' `year' `group' `class')
03       }
03     - if `merge_resid'==1 {
       = if 1==1 {
03     - tempfile resid_data_`l'
       = tempfile resid_data_1
03     - qui save `"`resid_data_`l''"', replace
       = qui save `"/home/tmp/St192370.000004"', replace
03     - }
03     - tempname num_obs num_par
03     - scalar `num_obs' = e(N)
       = scalar __000000 = e(N)
03     - if "`absorb'"!="" {
       = if ""!="" {
03       scalar `num_par' = e(df_m) + e(df_a) + 1
03       }
03     - else {
03     - scalar `num_par' = e(df_m) + 1
       = scalar __000001 = e(df_m) + 1
03     - }
03     - tempvar n_tested
03     - qui bys `teacher' `year' `group' `class': egen `n_tested' = count(scor
> e_r)
       = qui bys school_id year  school_id: egen __000002 = count(score_r)
03     - tempvar class_mean index
03     - qui by `teacher' `year' `group' `class': egen `class_mean' = mean(scor
> e_r)
       = qui by school_id year  school_id: egen __000003 = mean(score_r)
03     - qui by `teacher' `year' `group' `class': g `index' = _n
       = qui by school_id year  school_id: g __000004 = _n
03     - tempname var_total
03     - qui sum score_r
03     - scalar `var_total' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_par'))
       = scalar __000005 = r(Var)*((__000000 - 1)/(__000000 - __000001))
03     - tempname num_class var_ind var_class
03     - tempvar individual_dev_from_class
03     - qui gen `individual_dev_from_class' = score_r - `class_mean'
       = qui gen __000009 = score_r - __000003
03     - qui count if `index'==1 & `n_tested'!=0
       = qui count if __000004==1 & __000002!=0
03     - scalar `num_class' = r(N)
       = scalar __000006 = r(N)
03     - qui sum `individual_dev_from_class'
       = qui sum __000009
03     - scalar `var_ind' = r(Var)*((`num_obs' - 1)/(`num_obs' - `num_class' - 
> `num_par' + 1))
       = scalar __000007 = r(Var)*((__000000 - 1)/(__000000 - __000006 - __0000
> 01 + 1))
03     - qui by `teacher' `year' `group' `class': keep if _n==1
       = qui by school_id year  school_id: keep if _n==1
03     - if "`seed'"=="" {
       = if ""=="" {
03     - set seed 9827496
03     - }
03     - tempvar rand classnum
03     - g `rand'=uniform()
       = g __00000A=uniform()
03     - bys `teacher' `year' (`rand'): gen `classnum'=_n
       = bys school_id year (__00000A): gen __00000B=_n
03     - tempname cov_sameyear corr_sameyear obs_sameyear
03     - qui sum `classnum'
       = qui sum __00000B
03     - if (r(max)==1) {
03     - local missing_sameyear=1
03     - scalar `cov_sameyear'=0
       = scalar __00000C=0
03     - }
03     - else {
03       local missing_sameyear=0
03       tempvar identifier
03       egen `identifier'=group(`teacher' `year')
03       qui tsset `identifier' `classnum'
03       qui corr `class_mean' f.`class_mean' [aw=`n_tested'+f.`n_tested'], cov
03       scalar `cov_sameyear'=r(cov_12)
03       scalar `corr_sameyear'=r(cov_12) / ( sqrt(r(Var_1)) * sqrt(r(Var_2)) )
03       scalar `obs_sameyear'=r(N)
03       }
03     - scalar `var_class' = `var_total' - `var_ind' - `cov_sameyear'
       = scalar __000008 = __000005 - __000007 - __00000C
03     - if (`var_class'<0) {
       = if (__000008<0) {
03       if ("`varclasszero'"!="varclasszero") {
03       di as error "Note: var_class has been computed as being less than 0."
03       di "var_class is defined as = var_total - var_ind - cov_sameyear."
03       di "Computed variances: var_total, var_ind, cov_sameyear, var_class"
03       di `var_total',`var_ind',`cov_sameyear',`var_class'
03       di "This negative variance can occur because cov_sameyear is calculate
> d using only the subsample of observations that teach multiple classes per ye
> ar (in the same by-group)."
03       }
03       else if ("`varclasszero'"=="varclasszero") {
03       scalar `var_class' = 0
03       }
03       }
03     - tempvar weight
03     - qui g `weight'=1/(`var_class' + `var_ind'/`n_tested')
       = qui g __00000F=1/(__000008 + __000007/__000002)
03     - tempvar excess_weight
03     - qui gen `excess_weight'=(missing(`weight'))
       = qui gen __00000G=(missing(__00000F))
03     - qui replace `weight'=1 if missing(`weight')
       = qui replace __00000F=1 if missing(__00000F)
03     - collapse (mean) `class_mean' (rawsum) `weight' `n_tested' `excess_weig
> ht' [aw=`weight'], by(`teacher' `year' `by') fast
       = collapse (mean) __000003 (rawsum) __00000F __000002 __00000G [aw=__000
> 00F], by(school_id year ) fast
03     - qui replace `weight'=`weight'-`excess_weight'
       = qui replace __00000F=__00000F-__00000G
03     - qui tsset `teacher' `year'
       = qui tsset school_id year
03     - tempvar minyear maxyear diff validyear minvalidyear maxvalidyear diffv
> alid
03     - qui bys `teacher': egen `minyear'=min(`year')
       = qui bys school_id: egen __00000H=min(year)
03     - qui by `teacher': egen `maxyear'=max(`year')
       = qui by school_id: egen __00000I=max(year)
03     - qui g `diff'=`maxyear'-`minyear'
       = qui g __00000J=__00000I-__00000H
03     - qui sum `diff'
       = qui sum __00000J
03     - local maxspan=`r(max)'
       = local maxspan=3
03     - qui gen `validyear'=`year' if !missing(`class_mean')
       = qui gen __00000K=year if !missing(__000003)
03     - qui by `teacher': egen `minvalidyear'=min(`validyear')
       = qui by school_id: egen __00000L=min(__00000K)
03     - qui by `teacher': egen `maxvalidyear'=max(`validyear')
       = qui by school_id: egen __00000M=max(__00000K)
03     - qui g `diffvalid'=`maxvalidyear'-`minvalidyear'
       = qui g __00000N=__00000M-__00000L
03     - qui sum `diffvalid'
       = qui sum __00000N
03     - local maxscorespan=`r(max)'
       = local maxscorespan=3
03     - if (`maxscorespan'<`maxspan') & (`driftlimit'<=0) {
       = if (3<3) & (2<=0) {
03       di as error _n "error: The maximum lags of teacher data is `maxspan', 
> but the maximum lags of teacher data with class scores is `maxscorespan'."
03       di as error "       You must either set driftlimit() <= `maxscorespan'
> , or drop observations so that the spans are no longer mismatched."
03       exit 499
03       }
03     - if (`driftlimit'>`maxscorespan') {
       = if (2>3) {
03       di as error "error: driftlimit(`driftlimit') was specified, which is g
> reater than the number of lags (`maxscorespan') in the data."
03       exit 499
03       }
03     - mata:CC=compute_cov_corr("`class_mean'","`n_tested'",`maxscorespan',"`
> teacher'")
       = mata:CC=compute_cov_corr("__000003","__000002",3,"school_id")
03     - if (`driftlimit'>0) mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyea
> r'"),`maxspan',`driftlimit')
       = if (2>0) mata:m=create_m(CC[.,1],st_numscalar("__00000C"),3,2)
03     - else mata:m=create_m(CC[.,1],st_numscalar("`cov_sameyear'"))
       = else mata:m=create_m(CC[.,1],st_numscalar("__00000C"))
03     - di "Standard deviations: total, classes, students, teachers same year"
Standard deviations: total, classes, students, teachers same year
03     - if (`missing_sameyear'==0) di sqrt(`var_total'),sqrt(`var_class'),sqrt
> (`var_ind'),sqrt(`cov_sameyear')
       = if (1==0) di sqrt(__000005),sqrt(__000008),sqrt(__000007),sqrt(__00000
> C)
03     - else di sqrt(`var_total'),sqrt(`var_class'),sqrt(`var_ind'),.
       = else di sqrt(__000005),sqrt(__000008),sqrt(__000007),.
.54778322 .16371553 .52274629 .
03     - di "Covariances (left), correlations (middle), observations (right).  
> Row i indicates the relation between year t and t+i:"
Covariances (left), correlations (middle), observations (right).  Row i indicat
> es the relation between year t and t+i:
03     - mata:CC[.,1..3]
                 1             2             3
    +-------------------------------------------+
  1 |  .0194140802   .6779384445          3534  |
  2 |   .015356176   .5457502346          2296  |
  3 |  .0097630068   .3626400715          1105  |
    +-------------------------------------------+
03     - if (`driftlimit'>0) {
       = if (2>0) {
03     - di "Drift limit specified:"
Drift limit specified:
03     - di `driftlimit'
       = di 2
2
03     - di "Covariances used for VA computations:"
Covariances used for VA computations:
03     - mata: m[2..length(m)]'
                 1
    +---------------+
  1 |  .0194140802  |
  2 |   .015356176  |
  3 |   .015356176  |
    +---------------+
03     - }
03     - mata:check_m_nomissing(m)
03     - if (`firstloop'==1) {
       = if (1==1) {
03     - mata:cov_lag_accum= CC[.,1]
03     - mata:corr_lag_accum= CC[.,2]
03     - mata:obs_lag_accum= CC[.,3]
03     - mata:cov_se_lag_accum= CC[.,4]
03     - mata:var_total_accum= st_numscalar("`var_total'")
       = mata:var_total_accum= st_numscalar("__000005")
03     - mata:var_class_accum= st_numscalar("`var_class'")
       = mata:var_class_accum= st_numscalar("__000008")
03     - mata:var_ind_accum= st_numscalar("`var_ind'")
       = mata:var_ind_accum= st_numscalar("__000007")
03     - if (`missing_sameyear'==1) {
       = if (1==1) {
03     - mata:cov_sameyear_accum=.
03     - mata:corr_sameyear_accum=.
03     - mata:obs_sameyear_accum=0
03     - }
03     - else {
03       mata:cov_sameyear_accum=st_numscalar("`cov_sameyear'")
03       mata:corr_sameyear_accum=st_numscalar("`corr_sameyear'")
03       mata:obs_sameyear_accum=st_numscalar("`obs_sameyear'")
03       }
03     - }
03     - else {
03       mata:cov_lag_accum= rightAppendMatrices(cov_lag_accum,CC[.,1])
03       mata:corr_lag_accum= rightAppendMatrices(corr_lag_accum,CC[.,2])
03       mata:obs_lag_accum= rightAppendMatrices(obs_lag_accum,CC[.,3])
03       mata:cov_se_lag_accum= rightAppendMatrices(cov_se_lag_accum,CC[.,4])
03       mata:var_total_accum= var_total_accum,st_numscalar("`var_total'")
03       mata:var_class_accum= var_class_accum,st_numscalar("`var_class'")
03       mata:var_ind_accum= var_ind_accum,st_numscalar("`var_ind'")
03       if (`missing_sameyear'==1) {
03       mata:cov_sameyear_accum= cov_sameyear_accum,.
03       mata:corr_sameyear_accum= corr_sameyear_accum,.
03       mata:obs_sameyear_accum= obs_sameyear_accum,.
03       }
03       else {
03       mata:cov_sameyear_accum=cov_sameyear_accum,st_numscalar("`cov_sameyear
> '")
03       mata:corr_sameyear_accum=corr_sameyear_accum,st_numscalar("`corr_samey
> ear'")
03       mata:obs_sameyear_accum=obs_sameyear_accum,st_numscalar("`obs_sameyear
> '")
03       }
03       }
03     - sort `teacher' `year'
       = sort school_id year
03     - tempvar obs_teacher
03     - by `teacher': egen `obs_teacher'=count(`teacher')
       = by school_id: egen __00000O=count(school_id)
03     - qui gen float tv=.
03     - if "`quasiexperiment'"!="" {
       = if ""!="" {
03       qui gen float tv_2yr_l=.
03       qui gen float tv_2yr_f=.
03       qui gen float tv_ss=.
03       mata: driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", "`cl
> ass_mean'", "`weight'", "`obs_teacher'", "tv", "tv_2yr_l", "tv_2yr_f", "tv_ss
> ")
03       }
03     - else mata:driftcalclist(vectorToStripeDiag(m), "`teacher'", "`year'", 
> "`class_mean'", "`weight'", "`obs_teacher'", "tv")
       = else mata:driftcalclist(vectorToStripeDiag(m), "school_id", "year", "_
> _000003", "__00000F", "__00000O", "tv")
03     - if ("`quasiexperiment'"=="") keep `teacher' `year' `by' tv
       = if (""=="") keep school_id year  tv
03     - else keep `teacher' `year' `by' tv tv_2yr_l tv_2yr_f tv_ss
       = else keep school_id year  tv tv_2yr_l tv_2yr_f tv_ss
03     - if (`firstloop'!=1) append using `"`output'"', nolabel
       = if (1!=1) append using `"/home/tmp/St192370.000002"', nolabel
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - local firstloop=0
03     - }
03     - di "{txt}{hline}"
-------------------------------------------------------------------------------
03     - if "`output_addvars'"!="" quietly {
       = if ""!="" quietly {
03       restore, preserve
03       keep `teacher' `year' `by' `output_addvars'
03       bys `teacher' `year' `by' `output_addvars': keep if _n==1
03       merge m:1 `teacher' `year' `by' using `"`output'"', nogen nolabel
03       }
03     - sort `teacher' `year' `by'
       = sort school_id year 
03     - qui save `"`output'"', replace
       = qui save `"/home/tmp/St192370.000002"', replace
03     - if ("`by'"!="") {
       = if (""!="") {
03       local bylabels=""
03       forvalues i=1/`by_vals' {
03       local bylabel : label `byvar' `i', strict
03       local bylabel=subinstr("`bylabel'"," ","_",.)
03       local bylabels `bylabels' _`bylabel'
03       }
03       mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_lag_acc
> um, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, cov_sa
> meyear_accum, corr_sameyear_accum, obs_sameyear_accum, tokens(st_local("bylab
> els")))
03       }
03     - else mata:saveVariancesToDataset(cov_lag_accum, corr_lag_accum, obs_la
> g_accum, cov_se_lag_accum, var_total_accum, var_class_accum, var_ind_accum, c
> ov_sameyear_accum, corr_sameyear_accum, obs_sameyear_accum, "")
03     - if (`nooutput'!=1) qui outsheet using `"`output'_variance.csv"', comma
>  replace
       = if (1!=1) qui outsheet using `"/home/tmp/St192370.000002_variance.csv"
> ', comma replace
03     - tokenize "`data'"
       = tokenize "merge tv score_r"
03     - if inlist("`1'","preserve","merge") {
       = if inlist("merge","preserve","merge") {
03     - restore
03     - if (`merge_resid'==1) {
       = if (1==1) {
03     - if ("`byvar'"!="") qui keep if missing(`teacher',`year',`class',`byvar
> ')
       = if (""!="") qui keep if missing(school_id,year,school_id,)
03     - else qui keep if missing(`teacher',`year',`class')
       = else qui keep if missing(school_id,year,school_id)
03     - forvalues l=1/`by_vals' {
       = forvalues l=1/1 {
03     - append using `"`resid_data_`l''"', nolabel
       = append using `"/home/tmp/St192370.000004"', nolabel
03     - }
03     - }
03     - if (`merge_tv'==1) qui merge m:1 `teacher' `year' `by' `output_addvars
> ' using `"`output'"', nogen nolabel
       = if (1==1) qui merge m:1 school_id year   using `"/home/tmp/St192370.00
> 0002"', nogen nolabel
03     - }
03     - else {
03       restore, not
03       if ("`data'"=="tv") use `"`output'"', clear
03       }
       ------------------------------------------------------------ end vam ---
02   - rename tv va_cfr_g11_`subject'
     = rename tv va_cfr_g11_math
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename score_r sbac_g11_`subject'_r
     = rename score_r sbac_g11_math_r
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_math_r va_cfr_g11_math, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_math_r va_cfr_g11_math, cluster(school_id)

Linear regression                               Number of obs     =    672,870
                                                F(1, 1273)        =    4234.93
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0477
                                                Root MSE          =     .53449

                          (Std. err. adjusted for 1,274 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_m~r | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~h |   .9686532   .0148849    65.08   0.000     .9394516    .9978548
       _cons |  -.0008575   .0008948    -0.96   0.338    -.0026129     .000898
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/spec_test_va_cfr
> _g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/spec_test_va_cfr_g11_math_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/spec_test_v
> a_cfr_g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/spec_test_va_cfr_g11_math_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/spec_test_va_cfr_g11_math_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - label var va_cfr_g11_`subject' "`subject' VA with family FE without TFX"
     = label var va_cfr_g11_math "math VA with family FE without TFX"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var va_cfr_g11_math "math VA with family F
> E without TFX"
03     - }
       ---------------------------------------------------------- end label ---
02   - label var sbac_g11_`subject'_r "`subject' score residual with family FE 
> without TFX"
     = label var sbac_g11_math_r "math score residual with family FE without TF
> X"
       -------------------------------------------------------- begin label ---
03     - version 10.0
03     - local vv : display "version " string(_caller()) ", missing:"
03     - gettoken val : 0
03     - if (strpos("`val'", "val") > 0 ) {
       = if (strpos("var", "val") > 0 ) {
03       gettoken val 0 : 0
03       syntax anything [, nofix]
03       if "`fix'" != "" {
03       local fix ", nofix"
03       }
03       gettoken var rest : anything
03       while `"`rest'"' != "" {
03       gettoken lab rest : rest
03       local label "`lab'"
03       }
03       local vlist : list anything - lab
03       if "`lab'" == "." {
03       local lab ""
03       }
03       foreach var of varlist `vlist' {
03       `vv' _label `val' `var' `lab' `fix'
03       }
03       }
03     - else {
03     - `vv' _label `macval(0)'
       = version 17, missing: _label var sbac_g11_math_r "math score residual w
> ith family FE without TFX"
03     - }
       ---------------------------------------------------------- end label ---
02   - gen sbac_g11_`subject'_r_d = sbac_g11_`subject'_r_nosibctrl - sbac_g11_`
> subject'_r
     = gen sbac_g11_math_r_d = sbac_g11_math_r_nosibctrl - sbac_g11_math_r
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_temp
     = rename va_cfr_g11_math va_cfr_g11_math_temp
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename va_cfr_g11_`subject'_nosibctrl va_cfr_g11_`subject'
     = rename va_cfr_g11_math_nosibctrl va_cfr_g11_math
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - reg sbac_g11_`subject'_r_d va_cfr_g11_`subject', cluster(school_id)
     = reg sbac_g11_math_r_d va_cfr_g11_math, cluster(school_id)
       ---------------------------------------------------------- begin reg ---
03     - if _by() {
03       local by "by `_byvars'`_byrc0':"
03       }
03     - `by' regress `0'
       =  regress sbac_g11_math_r_d va_cfr_g11_math, cluster(school_id)

Linear regression                               Number of obs     =    672,870
                                                F(1, 1273)        =      16.31
                                                Prob > F          =     0.0001
                                                R-squared         =     0.0001
                                                Root MSE          =     .01644

                          (Std. err. adjusted for 1,274 clusters in school_id)
------------------------------------------------------------------------------
             |               Robust
sbac_g11_m~d | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
va_cfr_g11~h |   .0014631   .0003623     4.04   0.000     .0007523    .0021739
       _cons |  -1.99e-06    .000046    -0.04   0.965    -.0000922    .0000882
------------------------------------------------------------------------------
       ------------------------------------------------------------ end reg ---
02   - estimates save $projdir/est/siblingvaregs/test_score_va/fb_test_va_cfr_g
> 11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sib
> lingvaregs/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibling
> varegs/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
file /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/siblingvaregs/test_s
> core_va/fb_test_va_cfr_g11_math_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/users/chesun/gsr/caschls/est/sibli
> ngvaregs/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - estimates save $vaprojdir/estimates/sibling_va/test_score_va/fb_test_va_
> cfr_g11_`subject'_sibling.ster, replace
     = estimates save /home/research/ca_ed_lab/projects/common_core_va/estimate
> s/sibling_va/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
       ---------------------------------------------------- begin estimates ---
03     - version 8
03     - local vv : di "version " string(_caller()) ", missing:"
03     - gettoken key 0 : 0, parse(" ,:")
03     - local lkey = length(`"`key'"')
       = local lkey = length(`"save"')
03     - local is_bayesmh = ("`e(cmd)'"=="bayesmh" || "`e(prefix)'"=="bayes")
       = local is_bayesmh = ("regress"=="bayesmh" || ""=="bayes")
03     - local is_stintcox = ("`e(cmd)'"=="stintcox")
       = local is_stintcox = ("regress"=="stintcox")
03     - local is_stxer `e(stxer)'
       = local is_stxer 
03     - local changeab 6
03     - local tabab 3
03     - local forab 3
03     - local statsab 4
03     - local dirab 3
03     - if _caller() < 10 {
03       local changeab 2
03       local tabab 1
03       local forab 1
03       local statsab 2
03       local dirab 1
03       }
03     - if `"`key'"' == "" {
       = if `"save"' == "" {
03       if "`e(cmd)'" != "" {
03       `vv' Replay "."
03       }
03       }
03     - else if `"`key'"' == bsubstr("query", 1, `lkey') {
       = else if `"save"' == bsubstr("query", 1, 4) {
03       Query `0'
03       }
03     - else if `"`key'"' == bsubstr("store", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("store", 1, max(3,4)) {
03       if `is_stintcox' {
03       _stintcox_saved `is_stintcox' "store"
03       }
03       else {
03       _bayesmh_saved `is_bayesmh' "store"
03       }
03       Store `0'
03       StxerStore, is_stxer(`is_stxer') zero(`"`0'"')
03       }
03     - else if `"`key'"' == bsubstr("restore", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("restore", 1, max(3,4)) {
03       Restore `0'
03       StxerRestore `0'
03       }
03     - else if `"`key'"' == bsubstr("change", 1, max(`changeab',`lkey')) {
       = else if `"save"' == bsubstr("change", 1, max(6,4)) {
03       Change `0'
03       }
03     - else if `"`key'"' == bsubstr("for", 1, max(`forab', `lkey')) {
       = else if `"save"' == bsubstr("for", 1, max(3, 4)) {
03       `vv' For `0'
03       }
03     - else if `"`key'"' == bsubstr("dir", 1, max(`dirab', `lkey')) {
       = else if `"save"' == bsubstr("dir", 1, max(3, 4)) {
03       Dir `0'
03       }
03     - else if `"`key'"' == bsubstr("stats",1,max(`statsab',max(2,`lkey'))) {
       = else if `"save"' == bsubstr("stats",1,max(4,max(2,4))) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "stats"
03       }
03       }
03       Stats `0'
03       }
03     - else if `"`key'"' == bsubstr("table", 1, max(`tabab', `lkey')) {
       = else if `"save"' == bsubstr("table", 1, max(3, 4)) {
03       if (`is_bayesmh') {
03       _parse comma lhs rhs : 0
03       if (`"`lhs'"'=="" | `"`lhs'"'==".") {
03       _bayesmh_notallowed `is_bayesmh' "table"
03       }
03       }
03       `vv' est_table `0'
03       }
03     - else if `"`key'"' == bsubstr("selected", 1, max(3, `lkey')) {
       = else if `"save"' == bsubstr("selected", 1, max(3, 4)) {
03       `vv' est_selected `0'
03       }
03     - else if `"`key'"' == bsubstr("replay", 1, `lkey') {
       = else if `"save"' == bsubstr("replay", 1, 4) {
03       `vv' Replay `0'
03       }
03     - else if `"`key'"' == "drop" {
       = else if `"save"' == "drop" {
03       Drop `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == bsubstr("notes", 1, max(4,`lkey')) {
       = else if `"save"' == bsubstr("notes", 1, max(4,4)) {
03       estimates_notes `0'
03       }
03     - else if `"`key'"' == "title" {
       = else if `"save"' == "title" {
03       Title `0'
03       }
03     - else if `"`key'"' == "clear" {
       = else if `"save"' == "clear" {
03       Clear `0'
03       local droplist `s(droplist)'
03       StxerDrop , droplist(`droplist')
03       }
03     - else if `"`key'"' == "esample" {
       = else if `"save"' == "esample" {
03       estimates_sample `0'
03       }
03     - else if `"`key'"' == bsubstr("describe", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("describe", 1, max(3,4)) {
03       Describe `0'
03       }
03     - else if `"`key'"' == "save" {
       = else if `"save"' == "save" {
03     - if `is_stintcox' {
       = if 0 {
03       _stintcox_saved `is_stintcox' "save"
03       }
03     - else {
03     - _bayesmh_saved `is_bayesmh' "save"
       = _bayesmh_saved 0 "save"
03     - }
03     - EstSave `macval(0)'
       = EstSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/si
> bling_va/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
file /home/research/ca_ed_lab/projects/common_core_va/estimates/sibling_va/test
> _score_va/fb_test_va_cfr_g11_math_sibling.ster saved
03     - StxerSave `0'
       = StxerSave  /home/research/ca_ed_lab/projects/common_core_va/estimates/
> sibling_va/test_score_va/fb_test_va_cfr_g11_math_sibling.ster, replace
03     - }
03     - else if `"`key'"' == "use" {
       = else if `"save"' == "use" {
03       EstUse `macval(0)'
03       StxerUse `0'
03       }
03     - else if `"`key'"' == bsubstr("local", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("local", 1, max(3,4)) {
03       SubcmdMoved "local" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("scalar", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("scalar", 1, max(3,4)) {
03       SubcmdMoved "scalar" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("matrix", 1, max(3,`lkey')) {
       = else if `"save"' == bsubstr("matrix", 1, max(3,4)) {
03       SubcmdMoved "matrix" "ereturn"
03       }
03     - else if `"`key'"' == "post" {
       = else if `"save"' == "post" {
03       SubcmdMoved "post" "ereturn"
03       }
03     - else if `"`key'"' == "repost" {
       = else if `"save"' == "repost" {
03       SubcmdMoved "repost" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("display", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("display", 1, max(2,4)) {
03       SubcmdMoved "display" "ereturn"
03       }
03     - else if `"`key'"' == bsubstr("hold", 1, `lkey') {
       = else if `"save"' == bsubstr("hold", 1, 4) {
03       SubcmdMoved "hold" " _estimates"
03       }
03     - else if `"`key'"' == bsubstr("unhold", 1, `lkey') {
       = else if `"save"' == bsubstr("unhold", 1, 4) {
03       SubcmdMoved "unhold" "_estimates"
03       }
03     - else if `"`key'"' == bsubstr("list", 1, max(2,`lkey')) {
       = else if `"save"' == bsubstr("list", 1, max(2,4)) {
03       SubcmdMoved "list" "ereturn"
03       }
03     - else {
03       di as err `"subcommand {bf:estimates} {bf:`key'} is unrecognized"'
03       exit 198
03       }
       ------------------------------------------------------ end estimates ---
02   - rename va_cfr_g11_`subject' va_cfr_g11_`subject'_nosibctrl
     = rename va_cfr_g11_math va_cfr_g11_math_nosibctrl
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - rename va_cfr_g11_`subject'_temp va_cfr_g11_`subject'
     = rename va_cfr_g11_math_temp va_cfr_g11_math
       ------------------------------------------------------- begin rename ---
03     - version 12
03     - mata: rename_cmd("`3'")
       = mata: rename_cmd("")
       --------------------------------------------------------- end rename ---
02   - collapse (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_`subject' = touse_g
> 11_`subject' if sibling_full_sample == 1 & sibling_out_sample == 1 , by(schoo
> l_id cdscode grade year)
     = collapse (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_math = touse_g11_ma
> th if sibling_full_sample == 1 & sibling_out_sample == 1 , by(school_id cdsco
> de grade year)
       ----------------------------------------------------- begin collapse ---
03     - version 8, missing
03     - if _caller() < 5 {
03       collaps4 `0'
03       exit
03       }
03     - collapse_17 `0'
       = collapse_17 (firstnm) va_* (mean) sbac_*_r* (sum) n_g11_math = touse_g
> 11_math if sibling_full_sample == 1 & sibling_out_sample == 1 , by(school_id 
> cdscode grade year)
03     - if "`col17_graphbar'" != "" {
       = if "" != "" {
03       c_local `col17_graphbar' "``col17_graphbar''"
03       }
       ------------------------------------------------------- end collapse ---
02   - save $projdir/dta/common_core_va/test_score_va/va_g11_`subject'_sibling.
> dta, replace
     = save /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_core_v
> a/test_score_va/va_g11_math_sibling.dta, replace
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/common_core_va/test
    > _score_va/va_g11_math_sibling.dta saved
02   - save $vaprojdir/data/sibling_va/test_score_va/va_g11_`subject'_sibling.d
> ta, replace
     = save /home/research/ca_ed_lab/projects/common_core_va/data/sibling_va/te
> st_score_va/va_g11_math_sibling.dta, replace
file
    /home/research/ca_ed_lab/projects/common_core_va/data/sibling_va/test_sco
    > re_va/va_g11_math_sibling.dta saved
02   - }

. 
. 
. 
. 
. 
. 
. set trace off

. 
. timer off 1

. timer list
   1:     33.12 /        1 =      33.1190

. log close
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/share/siblin
> gvaregs/va_sibling.smcl
  log type:  smcl
 closed on:   9 Apr 2022, 03:43:25
-------------------------------------------------------------------------------
