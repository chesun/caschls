-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/share/siblin
> gxwalk/siblingpairxwalk.smcl
  log type:  smcl
 opened on:   7 Apr 2022, 16:33:21

. 
. use $projdir/dta/siblingxwalk/uniquelinkedfamilyclean, clear
(CST data siblings crosswalk matching on same year, last name, and address)

. 
. /* make tempfile for merging with joinby command */
. drop year numsiblings street_address_line_one street_address_line_two city st
> ate zip_code

. rename state_student_id sibling_state_student_id

. rename first_name sibling_first_name

. rename last_name sibling_last_name

. rename birth_date sibling_birth_date

. rename middle_intl sibling_middle_intl

. 
. label var sibling_state_student_id "Sibling State Student ID"

. label var sibling_first_name "Sibling First Name"

. label var sibling_last_name "Sibling Last Name"

. label var sibling_birth_date "Sibling Birth Date"

. label var sibling_middle_intl "Sibling Middle Initial"

. 
. tempfile formerge

. save `formerge'
file /home/tmp/St192370.000001 saved as .dta format

. 
. use $projdir/dta/siblingxwalk/uniquelinkedfamilyclean, clear
(CST data siblings crosswalk matching on same year, last name, and address)

. drop year numsiblings street_address_line_one street_address_line_two city st
> ate zip_code

. joinby ufamilyid using `formerge'

. 
. /* drop observations where self joins on self */
. drop if state_student_id == sibling_state_student_id
(4,095,244 observations deleted)

. 
. order ufamilyid state_student_id sibling_state_student_id

. 
. 
. save $projdir/dta/siblingxwalk/siblingpairxwalk, replace
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/siblingxwalk/siblin
    > gpairxwalk.dta saved

. 
. 
. 
. 
. *******create unique sibling pairs by dropping permutations
. //load the pairwise combination of siblings dataset
. use $projdir/dta/siblingxwalk/siblingpairxwalk, clear
(CST data siblings crosswalk matching on same year, last name, and address)

. egen pairorder1 = concat(state_student_id sibling_state_student_id)

. egen pairorder2 = concat(sibling_state_student_id state_student_id)

. 
. //pairorder1 has pairs in ascending order
. replace pairorder1 = pairorder2 if state_student_id > sibling_state_student_i
> d
(3,373,719 real changes made)

. 
. //remove duplicate permutations within family
. bysort ufamilyid pairorder1: gen i = _n

. keep if i==1
(3,373,719 observations deleted)

. 
. drop pairorder1 pairorder2 i

. 
. 
. //distance between birth dates for sibling pairs
. gen birth_date_distance = abs(birth_date - sibling_birth_date)
(224 missing values generated)

. 
. bysort ufamilyid: egen avg_birth_date_distance_family = mean(birth_date_dista
> nce)
(85 missing values generated)

. 
. replace avg_birth_date_distance_family = avg_birth_date_distance_family/365
(3,319,952 real changes made)

. label var avg_birth_date_distance_family "Average distance of birth dates in 
> family in years"

. 
. 
. label data "Unique sibling pairs after dropping duplicate permutations"

. 
. save $projdir/dta/siblingxwalk/uniquesiblingpairxwalk, replace
file
    /home/research/ca_ed_lab/users/chesun/gsr/caschls/dta/siblingxwalk/unique
    > siblingpairxwalk.dta saved

. 
. 
. log close
      name:  <unnamed>
       log:  /home/research/ca_ed_lab/users/chesun/gsr/caschls/log/share/siblin
> gxwalk/siblingpairxwalk.smcl
  log type:  smcl
 closed on:   7 Apr 2022, 16:34:08
-------------------------------------------------------------------------------
